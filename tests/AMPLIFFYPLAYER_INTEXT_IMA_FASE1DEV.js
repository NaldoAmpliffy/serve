!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";exports.byteLength=function(b64){var b64=getLens(b64),validLen=b64[0],b64=b64[1];return 3*(validLen+b64)/4-b64},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],lens=lens[1],arr=new Arr(function(validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(validLen,lens)),curByte=0,len=0<lens?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===lens&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===lens&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(function(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(function(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}(tmp));return output.join("")}(uint8,i,len2<i+16383?len2:i+16383));1==extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2==extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(0<len%4)throw new Error("Invalid string. Length must be a multiple of 4");b64=b64.indexOf("="),len=(b64=-1===b64?len:b64)===len?0:4-b64%4;return[b64,len]}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],2:[function(require,module,exports){},{}],3:[function(require,module,exports){arguments[4][2][0].apply(exports,arguments)},{dup:2}],4:[function(require,module,exports){!function(global){!function(){var root=this,freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule="object"==typeof module&&module&&!module.nodeType&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMax=26,skew=38,damp=700,regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-1,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="",parts=(1<parts.length&&(result=parts[0]+"@",string=parts[1]),(string=string.replace(regexSeparators,".")).split("."));return result+map(parts,fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)55296<=(value=string.charCodeAt(counter++))&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return 65535<value&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);baseMinusTMin*tMax>>1<delta;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,j,index,oldi,w,k,codePoint,output=[],inputLength=input.length,i=0,n=128,bias=72,basic=input.lastIndexOf("-");for(basic<0&&(basic=0),j=0;j<basic;++j)128<=input.charCodeAt(j)&&error("not-basic"),output.push(input.charCodeAt(j));for(index=0<basic?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;inputLength<=index&&error("invalid-input"),codePoint=input.charCodeAt(index++),(base<=(codePoint=codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base)||codePoint>floor((maxInt-i)/w))&&error("overflow"),i+=codePoint*w,!(codePoint<(codePoint=k<=bias?1:bias+tMax<=k?tMax:k-bias));k+=base)w>floor(maxInt/(codePoint=base-codePoint))&&error("overflow"),w*=codePoint;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){for(var delta,handledCPCount,basicLength,m,q,k,currentValue,handledCPCountPlusOne,t,qMinusT,output=[],inputLength=(input=ucs2decode(input)).length,n=128,bias=72,j=delta=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push("-");handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)n<=(currentValue=input[j])&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;!(q<(t=k<=bias?1:bias+tMax<=k?tMax:k-bias));k+=base)output.push(stringFromCharCode(digitToBasic(t+(qMinusT=q-t)%(t=base-t),0))),q=floor(qMinusT/t);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}if(punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})},toUnicode:function(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(require,module,exports){!function(Buffer){!function(){"use strict";var base64=require("base64-js"),ieee754=require("ieee754"),K_MAX_LENGTH=(exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,2147483647);function createBuffer(length){if(K_MAX_LENGTH<length)throw new RangeError('The value "'+length+'" is invalid for option "size"');length=new Uint8Array(length);return length.__proto__=Buffer.prototype,length}function Buffer(arg,encodingOrOffset,length){if("number"!=typeof arg)return from(arg,encodingOrOffset,length);if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}function from(value,encodingOrOffset,length){if("string"==typeof value)return function(string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),string=buf.write(string,encoding);string!==length&&(buf=buf.slice(0,string));return buf}(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return function(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);return array.__proto__=Buffer.prototype,array}(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);valueOf=function(obj){{var len,buf;if(Buffer.isBuffer(obj))return len=0|checked(obj.length),0!==(buf=createBuffer(len)).length&&obj.copy(buf,0,0,len),buf}if(void 0!==obj.length)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}(value);if(valueOf)return valueOf;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(K_MAX_LENGTH<=length)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=2<arguments.length&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((start=void 0===start||start<0?0:start)>this.length)return"";if((end=void 0===end||end>this.length?this.length:end)<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding=encoding||"utf8";;)switch(encoding){case"hex":return function(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0);(!end||end<0||len<end)&&(end=len);for(var out="",i=start;i<end;++i)out+=function(n){return n<16?"0"+n.toString(16):n.toString(16)}(buf[i]);return out}(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}(this,start,end);case"latin1":case"binary":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}(this,start,end);case"base64":return function(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):2147483647<byteOffset?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),(byteOffset=(byteOffset=numberIsNaN(byteOffset=+byteOffset)?dir?0:buffer.length-1:byteOffset)<0?buffer.length+byteOffset:byteOffset)>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?(dir?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;arrLength/=indexSize=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir)for(var foundIndex=-1,i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(i-(foundIndex=-1===foundIndex?i:foundIndex)+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1;else for(i=byteOffset=arrLength<byteOffset+valLength?arrLength-valLength:byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,byteArray.push(c%256),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&127<(tempCodePoint=(31&firstByte)<<6|63&secondByte)&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&2047<(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)&&(tempCodePoint<55296||57343<tempCodePoint)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&65535<(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):65535<codePoint&&(res.push((codePoint-=65536)>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.kMaxLength=K_MAX_LENGTH,(Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=from,Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return assertSize(size),!(size<=0)&&void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)},Buffer.allocUnsafe=allocUnsafe,Buffer.allocUnsafeSlow=allocUnsafe,Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=Buffer.allocUnsafe(length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toLocaleString=Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(Buffer.isBuffer(b))return this===b||0===Buffer.compare(this,b);throw new TypeError("Argument must be a Buffer")},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES,str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();return this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),(start=void 0===start?0:start)<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisEnd<=thisStart&&end<=start)return 0;if(thisEnd<=thisStart)return-1;if(end<=start)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding=encoding||"utf8";for(var loweredCase=!1;;)switch(encoding){case"hex":return function(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;(!length||remaining<(length=Number(length)))&&(length=remaining),(remaining=string.length)/2<length&&(length=remaining/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}(this,string,offset,length);case"utf8":case"utf-8":return function(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return function(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(length<offset+ext)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(max<value||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var len=this.length,len=((start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):len<end&&(end=len),end<start&&(end=start),this.subarray(start,end));return len.__proto__=Buffer.prototype,len},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;0<byteLength&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];0<i&&(mul*=256);)val+=this[offset+--i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);noAssert=this[offset]|this[offset+1]<<8;return 32768&noAssert?4294901760|noAssert:noAssert},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);noAssert=this[offset+1]|this[offset]<<8;return 32768&noAssert?4294901760|noAssert:noAssert},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,byteLength,(noAssert=Math.pow(2,8*byteLength-1))-1,-noAssert);var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,byteLength,(noAssert=Math.pow(2,8*byteLength-1))-1,-noAssert);var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),this[offset]=255&(value=value<0?255+value+1:value),offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=(value=value<0?4294967295+value+1:value)>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var code;1===val.length&&(code=val.charCodeAt(0),"utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");var i;if(!(end<=start))if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}}.call(this)}.call(this,require("buffer").Buffer)},{"base64-js":1,buffer:5,ieee754:10}],6:[function(require,module,exports){module.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],7:[function(require,module,exports){var objectCreate=Object.create||function(proto){function F(){}return F.prototype=proto,new F},objectKeys=Object.keys||function(obj){var k,keys=[];for(k in obj)Object.prototype.hasOwnProperty.call(obj,k)&&keys.push(k);return k},bind=Function.prototype.bind||function(context){var fn=this;return function(){return fn.apply(context,arguments)}};function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((module.exports=EventEmitter).EventEmitter=EventEmitter).prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(err){hasDefineProperty=!1}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var events,existing;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return(events=target._events)?(events.newListener&&(target.emit("newListener",type,listener.listener||listener),events=target._events),existing=events[type]):(events=target._events=objectCreate(null),target._eventsCount=0),existing?("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),existing.warned||(prepend=$getMaxListeners(target))&&0<prepend&&existing.length>prepend&&(existing.warned=!0,(prepend=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",prepend.emitter=target,prepend.type=type,prepend.count=existing.length,"object"==typeof console)&&console.warn&&console.warn("%s: %s",prepend.name,prepend.message)):(existing=events[type]=listener,++target._eventsCount),target}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}function _onceWrap(target,type,listener){target={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},type=bind.call(onceWrapper,target);return type.listener=listener,target.wrapFn=type}function _listeners(target,type,unwrap){target=target._events;if(!target)return[];target=target[type];if(!target)return[];if("function"==typeof target)return unwrap?[target.listener||target]:[target];if(unwrap){for(var arr=target,ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}return arrayClone(target,target.length)}function listenerCount(type){var events=this._events;if(events){events=events[type];if("function"==typeof events)return 1;if(events)return events.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||arg!=arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(type){var er,handler,args,i,doError="error"===type,events=this._events;if(events)doError=doError&&null==events.error;else if(!doError)return!1;if(doError)throw(er=1<arguments.length?arguments[1]:er)instanceof Error?er:((doError=new Error('Unhandled "error" event. ('+er+")")).context=er,doError);if(!(handler=events[type]))return!1;var len,isFn="function"==typeof handler;switch(len=arguments.length){case 1:!function(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self)}(handler,isFn,this);break;case 2:!function(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1)}(handler,isFn,this,arguments[1]);break;case 3:!function(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}(handler,isFn,this,arguments[1],arguments[2]);break;case 4:!function(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];!function(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].apply(self,args)}(handler,isFn,this,args)}return!0},EventEmitter.prototype.on=EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if((events=this._events)&&(list=events[type]))if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=objectCreate(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;0<=i;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var listeners,events=this._events;if(events)if(events.removeListener){if(0===arguments.length){for(var key,keys=objectKeys(events),i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0}else if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(listeners)for(i=listeners.length-1;0<=i;i--)this.removeListener(type,listeners[i])}else 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):events[type]&&(0==--this._eventsCount?this._events=objectCreate(null):delete events[type]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],8:[function(require,module,exports){!function(global){!function(){var win="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};module.exports=win}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(require,module,exports){var key,http=require("http"),url=require("url"),https=module.exports;for(key in http)http.hasOwnProperty(key)&&(https[key]=http[key]);function validateParams(params){if((params="string"==typeof params?url.parse(params):params).protocol||(params.protocol="https:"),"https:"!==params.protocol)throw new Error('Protocol "'+params.protocol+'" not supported. Expected "https:"');return params}https.request=function(params,cb){return params=validateParams(params),http.request.call(this,params,cb)},https.get=function(params,cb){return params=validateParams(params),http.get.call(this,params,cb)}},{http:17,url:37}],10:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,nBytes=buffer[offset+i];for(i+=d,e=nBytes&(1<<-nBits)-1,nBytes>>=-nBits,nBits+=eLen;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(nBytes?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(nBytes?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,nBytes=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(isLE=Math.pow(2,-e))<1&&(e--,isLE*=2),2<=(value+=1<=e+eBias?rt/isLE:rt*Math.pow(2,1-eBias))*isLE&&(e++,isLE/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(value*isLE-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*nBytes}},{}],11:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){superCtor&&(ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function(ctor,superCtor){var TempCtor;superCtor&&(ctor.super_=superCtor,(TempCtor=function(){}).prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor)}},{}],12:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,module=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return(cachedSetTimeout=setTimeout)(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length)&&drainQueue()}function drainQueue(){if(!draining){for(var timeout=runTimeout(cleanUpNextTick),len=(draining=!0,queue.length);len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,!function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return(cachedClearTimeout=clearTimeout)(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}module.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},module.title="browser",module.browser=!0,module.env={},module.argv=[],module.version="",module.versions={},module.on=noop,module.addListener=noop,module.once=noop,module.off=noop,module.removeListener=noop,module.removeAllListeners=noop,module.emit=noop,module.prependListener=noop,module.prependOnceListener=noop,module.listeners=function(name){return[]},module.binding=function(name){throw new Error("process.binding is not supported")},module.cwd=function(){return"/"},module.chdir=function(dir){throw new Error("process.chdir is not supported")},module.umask=function(){return 0}},{}],13:[function(require,module,exports){"use strict";module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"==typeof qs&&0!==qs.length){var regexp=/\+/g,sep=(qs=qs.split(sep),1e3),len=(options&&"number"==typeof options.maxKeys&&(sep=options.maxKeys),qs.length);0<sep&&sep<len&&(len=sep);for(var i=0;i<len;++i){var kstr,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),idx=0<=idx?(kstr=x.substr(0,idx),x.substr(idx+1)):(kstr=x,""),x=decodeURIComponent(kstr),idx=decodeURIComponent(idx);!function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}(obj,x)?obj[x]=idx:isArray(obj[x])?obj[x].push(idx):obj[x]=[obj[x],idx]}}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],14:[function(require,module,exports){"use strict";function stringifyPrimitive(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}}module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=","object"==typeof(obj=null===obj?void 0:obj)?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)};function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var objectKeys=Object.keys||function(obj){var key,res=[];for(key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],15:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":13,"./encode":14}],16:[function(require,module,exports){var buffer=require("buffer"),Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src)dst[key]=src[key]}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=buffer:(copyProps(buffer,exports),exports.Buffer=SafeBuffer),SafeBuffer.prototype=Object.create(Buffer.prototype),copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(arg,encodingOrOffset,length){if("number"==typeof arg)throw new TypeError("Argument must not be a number");return Buffer(arg,encodingOrOffset,length)},SafeBuffer.alloc=function(size,fill,encoding){if("number"!=typeof size)throw new TypeError("Argument must be a number");size=Buffer(size);return void 0!==fill?"string"==typeof encoding?size.fill(fill,encoding):size.fill(fill):size.fill(0),size},SafeBuffer.allocUnsafe=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return Buffer(size)},SafeBuffer.allocUnsafeSlow=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return buffer.SlowBuffer(size)}},{buffer:5}],17:[function(require,module,exports){!function(global){!function(){var ClientRequest=require("./lib/request"),response=require("./lib/response"),extend=require("xtend"),statusCodes=require("builtin-status-codes"),url=require("url"),http=exports;http.request=function(opts,cb){opts="string"==typeof opts?url.parse(opts):extend(opts);var defaultProtocol=-1===global.location.protocol.search(/^https?:$/)?"http:":"",defaultProtocol=opts.protocol||defaultProtocol,host=opts.hostname||opts.host,port=opts.port,path=opts.path||"/",defaultProtocol=(host&&-1!==host.indexOf(":")&&(host="["+host+"]"),opts.url=(host?defaultProtocol+"//"+host:"")+(port?":"+port:"")+path,opts.method=(opts.method||"GET").toUpperCase(),opts.headers=opts.headers||{},new ClientRequest(opts));return cb&&defaultProtocol.on("response",cb),defaultProtocol},http.get=function(opts,cb){opts=http.request(opts,cb);return opts.end(),opts},http.ClientRequest=ClientRequest,http.IncomingMessage=response.IncomingMessage,http.Agent=function(){},http.Agent.defaultMaxSockets=4,http.globalAgent=new http.Agent,http.STATUS_CODES=statusCodes,http.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/request":19,"./lib/response":20,"builtin-status-codes":6,url:37,xtend:44}],18:[function(require,module,exports){!function(global){!function(){var xhr;function getXHR(){if(void 0===xhr)if(global.XMLHttpRequest){xhr=new global.XMLHttpRequest;try{xhr.open("GET",global.XDomainRequest?"/":"https://example.com")}catch(e){xhr=null}}else xhr=null;return xhr}function checkTypeSupport(type){var xhr=getXHR();if(xhr)try{return xhr.responseType=type,xhr.responseType===type}catch(e){}return!1}function isFunction(value){return"function"==typeof value}exports.fetch=isFunction(global.fetch)&&isFunction(global.ReadableStream),exports.writableStream=isFunction(global.WritableStream),exports.abortController=isFunction(global.AbortController),exports.arraybuffer=exports.fetch||checkTypeSupport("arraybuffer"),exports.msstream=!exports.fetch&&checkTypeSupport("ms-stream"),exports.mozchunkedarraybuffer=!exports.fetch&&checkTypeSupport("moz-chunked-arraybuffer"),exports.overrideMimeType=exports.fetch||!!getXHR()&&isFunction(getXHR().overrideMimeType),xhr=null}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(require,module,exports){!function(process,global,Buffer){!function(){var capability=require("./capability"),inherits=require("inherits"),response=require("./response"),stream=require("readable-stream"),IncomingMessage=response.IncomingMessage,rStates=response.readyStates;response=module.exports=function(opts){var preferBinary,self=this,useFetch=(stream.Writable.call(self),self._opts=opts,self._body=[],self._headers={},opts.auth&&self.setHeader("Authorization","Basic "+Buffer.from(opts.auth).toString("base64")),Object.keys(opts.headers).forEach(function(name){self.setHeader(name,opts.headers[name])}),!0);if("disable-fetch"===opts.mode||"requestTimeout"in opts&&!capability.abortController)preferBinary=!(useFetch=!1);else if("prefer-streaming"===opts.mode)preferBinary=!1;else if("allow-wrong-content-type"===opts.mode)preferBinary=!capability.overrideMimeType;else{if(opts.mode&&"default"!==opts.mode&&"prefer-fast"!==opts.mode)throw new Error("Invalid value for opts.mode");preferBinary=!0}self._mode=function(preferBinary,useFetch){return capability.fetch&&useFetch?"fetch":capability.mozchunkedarraybuffer?"moz-chunked-arraybuffer":capability.msstream?"ms-stream":capability.arraybuffer&&preferBinary?"arraybuffer":"text"}(preferBinary,useFetch),self._fetchTimer=null,self._socketTimeout=null,self._socketTimer=null,self.on("finish",function(){self._onFinish()})};inherits(response,stream.Writable),response.prototype.setHeader=function(name,value){var lowerName=name.toLowerCase();-1===unsafeHeaders.indexOf(lowerName)&&(this._headers[lowerName]={name:name,value:value})},response.prototype.getHeader=function(name){name=this._headers[name.toLowerCase()];return name?name.value:null},response.prototype.removeHeader=function(name){delete this._headers[name.toLowerCase()]},response.prototype._onFinish=function(){var self=this;if(!self._destroyed){var opts=self._opts,headersObj=("timeout"in opts&&0!==opts.timeout&&self.setTimeout(opts.timeout),self._headers),body=null,headersList=("GET"!==opts.method&&"HEAD"!==opts.method&&(body=new Blob(self._body,{type:(headersObj["content-type"]||{}).value||""})),[]);if(Object.keys(headersObj).forEach(function(keyName){var name=headersObj[keyName].name,keyName=headersObj[keyName].value;Array.isArray(keyName)?keyName.forEach(function(v){headersList.push([name,v])}):headersList.push([name,keyName])}),"fetch"===self._mode){var controller,signal=null;capability.abortController&&(signal=(controller=new AbortController).signal,self._fetchAbortController=controller,"requestTimeout"in opts)&&0!==opts.requestTimeout&&(self._fetchTimer=global.setTimeout(function(){self.emit("requestTimeout"),self._fetchAbortController&&self._fetchAbortController.abort()},opts.requestTimeout)),global.fetch(self._opts.url,{method:self._opts.method,headers:headersList,body:body||void 0,mode:"cors",credentials:opts.withCredentials?"include":"same-origin",signal:signal}).then(function(response){self._fetchResponse=response,self._resetTimers(!1),self._connect()},function(reason){self._resetTimers(!0),self._destroyed||self.emit("error",reason)})}else{var xhr=self._xhr=new global.XMLHttpRequest;try{xhr.open(self._opts.method,self._opts.url,!0)}catch(err){return void process.nextTick(function(){self.emit("error",err)})}"responseType"in xhr&&(xhr.responseType=self._mode),"withCredentials"in xhr&&(xhr.withCredentials=!!opts.withCredentials),"text"===self._mode&&"overrideMimeType"in xhr&&xhr.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in opts&&(xhr.timeout=opts.requestTimeout,xhr.ontimeout=function(){self.emit("requestTimeout")}),headersList.forEach(function(header){xhr.setRequestHeader(header[0],header[1])}),self._response=null,xhr.onreadystatechange=function(){switch(xhr.readyState){case rStates.LOADING:case rStates.DONE:self._onXHRProgress()}},"moz-chunked-arraybuffer"===self._mode&&(xhr.onprogress=function(){self._onXHRProgress()}),xhr.onerror=function(){self._destroyed||(self._resetTimers(!0),self.emit("error",new Error("XHR error")))};try{xhr.send(body)}catch(err){process.nextTick(function(){self.emit("error",err)})}}}},response.prototype._onXHRProgress=function(){this._resetTimers(!1),function(xhr){try{var status=xhr.status;return null!==status&&0!==status}catch(e){}}(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress(this._resetTimers.bind(this)))},response.prototype._connect=function(){var self=this;self._destroyed||(self._response=new IncomingMessage(self._xhr,self._fetchResponse,self._mode,self._resetTimers.bind(self)),self._response.on("error",function(err){self.emit("error",err)}),self.emit("response",self._response))},response.prototype._write=function(chunk,encoding,cb){this._body.push(chunk),cb()},response.prototype._resetTimers=function(done){var self=this;global.clearTimeout(self._socketTimer),self._socketTimer=null,done?(global.clearTimeout(self._fetchTimer),self._fetchTimer=null):self._socketTimeout&&(self._socketTimer=global.setTimeout(function(){self.emit("timeout")},self._socketTimeout))},response.prototype.abort=response.prototype.destroy=function(err){this._destroyed=!0,this._resetTimers(!0),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort(),err&&this.emit("error",err)},response.prototype.end=function(data,encoding,cb){"function"==typeof data&&(cb=data,data=void 0),stream.Writable.prototype.end.call(this,data,encoding,cb)},response.prototype.setTimeout=function(timeout,cb){cb&&this.once("timeout",cb),this._socketTimeout=timeout,this._resetTimers(!1)},response.prototype.flushHeaders=function(){},response.prototype.setNoDelay=function(){},response.prototype.setSocketKeepAlive=function(){};var unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}.call(this)}.call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{"./capability":18,"./response":20,_process:12,buffer:5,inherits:11,"readable-stream":35}],20:[function(require,module,exports){!function(process,global,Buffer){!function(){var capability=require("./capability"),inherits=require("inherits"),stream=require("readable-stream"),rStates=exports.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},IncomingMessage=exports.IncomingMessage=function(xhr,response,mode,resetTimers){var self=this;if(stream.Readable.call(self),self._mode=mode,self.headers={},self.rawHeaders=[],self.trailers={},self.rawTrailers=[],self.on("end",function(){process.nextTick(function(){self.emit("close")})}),"fetch"===mode){if(self._fetchResponse=response,self.url=response.url,self.statusCode=response.status,self.statusMessage=response.statusText,response.headers.forEach(function(header,key){self.headers[key.toLowerCase()]=header,self.rawHeaders.push(key,header)}),capability.writableStream){var mode=new WritableStream({write:function(chunk){return resetTimers(!1),new Promise(function(resolve,reject){self._destroyed?reject():self.push(Buffer.from(chunk))?resolve():self._resumeFetch=resolve})},close:function(){resetTimers(!0),self._destroyed||self.push(null)},abort:function(err){resetTimers(!0),self._destroyed||self.emit("error",err)}});try{return void response.body.pipeTo(mode).catch(function(err){resetTimers(!0),self._destroyed||self.emit("error",err)})}catch(e){}}var reader=response.body.getReader();!function read(){reader.read().then(function(result){self._destroyed||(resetTimers(result.done),result.done?self.push(null):(self.push(Buffer.from(result.value)),read()))}).catch(function(err){resetTimers(!0),self._destroyed||self.emit("error",err)})}()}else self._xhr=xhr,self._pos=0,self.url=xhr.responseURL,self.statusCode=xhr.status,self.statusMessage=xhr.statusText,xhr.getAllResponseHeaders().split(/\r?\n/).forEach(function(header){var key,header=header.match(/^([^:]+):\s*(.*)/);header&&("set-cookie"===(key=header[1].toLowerCase())?(void 0===self.headers[key]&&(self.headers[key]=[]),self.headers[key].push(header[2])):void 0!==self.headers[key]?self.headers[key]+=", "+header[2]:self.headers[key]=header[2],self.rawHeaders.push(header[1],header[2]))}),self._charset="x-user-defined",capability.overrideMimeType||((mode=self.rawHeaders["mime-type"])&&(response=mode.match(/;\s*charset=([^;])(;|$)/))&&(self._charset=response[1].toLowerCase()),self._charset)||(self._charset="utf-8")};inherits(IncomingMessage,stream.Readable),IncomingMessage.prototype._read=function(){var resolve=this._resumeFetch;resolve&&(this._resumeFetch=null,resolve())},IncomingMessage.prototype._onXHRProgress=function(resetTimers){var self=this,xhr=self._xhr,response=null;switch(self._mode){case"text":if((response=xhr.responseText).length>self._pos){var newData=response.substr(self._pos);if("x-user-defined"===self._charset){for(var buffer=Buffer.alloc(newData.length),i=0;i<newData.length;i++)buffer[i]=255&newData.charCodeAt(i);self.push(buffer)}else self.push(newData,self._charset);self._pos=response.length}break;case"arraybuffer":xhr.readyState===rStates.DONE&&xhr.response&&(response=xhr.response,self.push(Buffer.from(new Uint8Array(response))));break;case"moz-chunked-arraybuffer":response=xhr.response,xhr.readyState===rStates.LOADING&&response&&self.push(Buffer.from(new Uint8Array(response)));break;case"ms-stream":var reader,response=xhr.response;xhr.readyState===rStates.LOADING&&((reader=new global.MSStreamReader).onprogress=function(){reader.result.byteLength>self._pos&&(self.push(Buffer.from(new Uint8Array(reader.result.slice(self._pos)))),self._pos=reader.result.byteLength)},reader.onload=function(){resetTimers(!0),self.push(null)},reader.readAsArrayBuffer(response))}self._xhr.readyState===rStates.DONE&&"ms-stream"!==self._mode&&(resetTimers(!0),self.push(null))}}.call(this)}.call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{"./capability":18,_process:12,buffer:5,inherits:11,"readable-stream":35}],21:[function(require,module,exports){"use strict";var codes={};function createErrorType(code,message,Base){var NodeError=function(_Base){var subClass,superClass;function NodeError(arg1,arg2,arg3){return _Base.call(this,function(arg1,arg2,arg3){return"string"==typeof message?message:message(arg1,arg2,arg3)}(arg1,arg2,arg3))||this}return superClass=_Base,(subClass=NodeError).prototype=Object.create(superClass.prototype),(subClass.prototype.constructor=subClass).__proto__=superClass,NodeError}(Base=Base||Error);NodeError.prototype.name=Base.name,NodeError.prototype.code=code,codes[code]=NodeError}function oneOf(expected,thing){var len;return Array.isArray(expected)?(len=expected.length,expected=expected.map(function(i){return String(i)}),2<len?"one of ".concat(thing," ").concat(expected.slice(0,len-1).join(", "),", or ")+expected[len-1]:2===len?"one of ".concat(thing," ").concat(expected[0]," or ").concat(expected[1]):"of ".concat(thing," ").concat(expected[0])):"of ".concat(thing," ").concat(String(expected))}createErrorType("ERR_INVALID_OPT_VALUE",function(name,value){return'The value "'+value+'" is invalid for option "'+name+'"'},TypeError),createErrorType("ERR_INVALID_ARG_TYPE",function(name,expected,actual){var determiner,pos,search;return"string"==typeof expected&&(search="not ",expected.substr(!pos||pos<0?0:+pos,search.length)===search)?(determiner="must not be",expected=expected.replace(/^not /,"")):determiner="must be",search=(function(str,search,this_len){return(void 0===this_len||this_len>str.length)&&(this_len=str.length),str.substring(this_len-search.length,this_len)===search}(name," argument")?"The ".concat(name," "):(pos=function(str,search,start){return!((start="number"!=typeof start?0:start)+search.length>str.length)&&-1!==str.indexOf(search,start)}(name,".")?"property":"argument",'The "'.concat(name,'" ').concat(pos," "))).concat(determiner," ").concat(oneOf(expected,"type")),search+=". Received type ".concat(typeof actual)},TypeError),createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),createErrorType("ERR_METHOD_NOT_IMPLEMENTED",function(name){return"The "+name+" method is not implemented"}),createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close"),createErrorType("ERR_STREAM_DESTROYED",function(name){return"Cannot call "+name+" after a stream was destroyed"}),createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end"),createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),createErrorType("ERR_UNKNOWN_ENCODING",function(arg){return"Unknown encoding: "+arg},TypeError),createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),module.exports.codes=codes},{}],22:[function(require,module,exports){!function(process){!function(){"use strict";var objectKeys=Object.keys||function(obj){var key,keys=[];for(key in obj)keys.push(key);return keys},Readable=(module.exports=Duplex,require("./_stream_readable")),Writable=require("./_stream_writable");require("inherits")(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),this.allowHalfOpen=!0,options&&(!1===options.readable&&(this.readable=!1),!1===options.writable&&(this.writable=!1),!1===options.allowHalfOpen)&&(this.allowHalfOpen=!1,this.once("end",onend))}function onend(){this._writableState.ended||process.nextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Duplex.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(Duplex.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(value){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=value,this._writableState.destroyed=value)}})}.call(this)}.call(this,require("_process"))},{"./_stream_readable":24,"./_stream_writable":26,_process:12,inherits:11}],23:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}require("inherits")(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":25,inherits:11}],24:[function(require,module,exports){!function(process,global){!function(){"use strict";function EElistenerCount(emitter,type){return emitter.listeners(type).length}(module.exports=Readable).ReadableState=ReadableState,require("events").EventEmitter;var Duplex,Stream=require("./internal/streams/stream"),Buffer=require("buffer").Buffer,OurUint8Array=(void 0!==global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var StringDecoder,createReadableStreamAsyncIterator,from,debugUtil=require("util"),debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){},BufferList=require("./internal/streams/buffer_list"),debugUtil=require("./internal/streams/destroy"),getHighWaterMark=require("./internal/streams/state").getHighWaterMark,_require$codes=require("../errors").codes,ERR_INVALID_ARG_TYPE=_require$codes.ERR_INVALID_ARG_TYPE,ERR_STREAM_PUSH_AFTER_EOF=_require$codes.ERR_STREAM_PUSH_AFTER_EOF,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_STREAM_UNSHIFT_AFTER_END_EVENT=_require$codes.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,errorOrDestroy=(require("inherits")(Readable,Stream),debugUtil.errorOrDestroy),kProxyEvents=["error","close","destroy","pause","resume"];function ReadableState(options,stream,isDuplex){Duplex=Duplex||require("./_stream_duplex"),options=options||{},"boolean"!=typeof isDuplex&&(isDuplex=stream instanceof Duplex),this.objectMode=!!options.objectMode,isDuplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode),this.highWaterMark=getHighWaterMark(this,options,"readableHighWaterMark",isDuplex),this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==options.emitClose,this.autoDestroy=!!options.autoDestroy,this.destroyed=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder=StringDecoder||require("string_decoder/").StringDecoder,this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Readable))return new Readable(options);var isDuplex=this instanceof Duplex;this._readableState=new ReadableState(options,this,isDuplex),this.readable=!0,options&&("function"==typeof options.read&&(this._read=options.read),"function"==typeof options.destroy)&&(this._destroy=options.destroy),Stream.call(this)}function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){debug("readableAddChunk",chunk);var er,state=stream._readableState;if(null===chunk)state.reading=!1,!function(stream,state){var chunk;debug("onEofChunk"),state.ended||(state.decoder&&(chunk=state.decoder.end())&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length),state.ended=!0,state.sync?emitReadable(stream):(state.needReadable=!1,state.emittedReadable||(state.emittedReadable=!0,emitReadable_(stream))))}(stream,state);else if(er=skipChunkCheck?er:function(state,chunk){var er;!function(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}(chunk)&&"string"!=typeof chunk&&void 0!==chunk&&!state.objectMode&&(er=new ERR_INVALID_ARG_TYPE("chunk",["string","Buffer","Uint8Array"],chunk));return er}(state,chunk))errorOrDestroy(stream,er);else if(state.objectMode||chunk&&0<chunk.length)if("string"==typeof chunk||state.objectMode||Object.getPrototypeOf(chunk)===Buffer.prototype||(chunk=function(chunk){return Buffer.from(chunk)}(chunk)),addToFront)state.endEmitted?errorOrDestroy(stream,new ERR_STREAM_UNSHIFT_AFTER_END_EVENT):addChunk(stream,state,chunk,!0);else if(state.ended)errorOrDestroy(stream,new ERR_STREAM_PUSH_AFTER_EOF);else{if(state.destroyed)return!1;state.reading=!1,!state.decoder||encoding||(chunk=state.decoder.write(chunk),state.objectMode)||0!==chunk.length?addChunk(stream,state,chunk,!1):maybeReadMore(stream,state)}else addToFront||(state.reading=!1,maybeReadMore(stream,state));return!state.ended&&(state.length<state.highWaterMark||0===state.length)}function addChunk(stream,state,chunk,addToFront){state.flowing&&0===state.length&&!state.sync?(state.awaitDrain=0,stream.emit("data",chunk)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state)}Object.defineProperty(Readable.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(value){this._readableState&&(this._readableState.destroyed=value)}}),Readable.prototype.destroy=debugUtil.destroy,Readable.prototype._undestroy=debugUtil.undestroy,Readable.prototype._destroy=function(err,cb){cb(err)},Readable.prototype.push=function(chunk,encoding){var skipChunkCheck,state=this._readableState;return state.objectMode?skipChunkCheck=!0:"string"==typeof chunk&&((encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=""),skipChunkCheck=!0),readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){for(var decoder=new(StringDecoder=StringDecoder||require("string_decoder/").StringDecoder)(enc),p=(this._readableState.decoder=decoder,this._readableState.encoding=this._readableState.decoder.encoding,this._readableState.buffer.head),content="";null!==p;)content+=decoder.write(p.data),p=p.next;return this._readableState.buffer.clear(),""!==content&&this._readableState.buffer.push(content),this._readableState.length=content.length,this};var MAX_HWM=1073741824;function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!=n?(state.flowing&&state.length?state.buffer.head.data:state).length:(n>state.highWaterMark&&(state.highWaterMark=function(n){return MAX_HWM<=n?n=MAX_HWM:(n--,n=(n=(n=(n=(n|=n>>>1)|n>>>2)|n>>>4)|n>>>8)|n>>>16,n++),n}(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function emitReadable(stream){var state=stream._readableState;debug("emitReadable",state.needReadable,state.emittedReadable),state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,process.nextTick(emitReadable_,stream))}function emitReadable_(stream){var state=stream._readableState;debug("emitReadable_",state.destroyed,state.length,state.ended),state.destroyed||!state.length&&!state.ended||(stream.emit("readable"),state.emittedReadable=!1),state.needReadable=!state.flowing&&!state.ended&&state.length<=state.highWaterMark,flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,process.nextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(;!state.reading&&!state.ended&&(state.length<state.highWaterMark||state.flowing&&0===state.length);){var len=state.length;if(debug("maybeReadMore read 0"),stream.read(0),len===state.length)break}state.readingMore=!1}function updateReadableListening(self){var state=self._readableState;state.readableListening=0<self.listenerCount("readable"),state.resumeScheduled&&!state.paused?state.flowing=!0:0<self.listenerCount("data")&&self.resume()}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume_(stream,state){debug("resume",state.reading),state.reading||stream.read(0),state.resumeScheduled=!1,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){var ret;return 0===state.length?null:(state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.first():state.buffer.concat(state.length),state.buffer.clear()):ret=state.buffer.consume(n,state.decoder),ret)}function endReadable(stream){var state=stream._readableState;debug("endReadable",state.endEmitted),state.endEmitted||(state.ended=!0,process.nextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){debug("endReadableNT",state.endEmitted,state.length),state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"),state.autoDestroy&&(!(state=stream._writableState)||state.autoDestroy&&state.finished)&&stream.destroy())}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var doRead,state=this._readableState,nOrig=n;return 0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&((0!==state.highWaterMark?state.length>=state.highWaterMark:0<state.length)||state.ended)?(debug("read: emitReadable",state.length,state.ended),(0===state.length&&state.ended?endReadable:emitReadable)(this),null):0===(n=howMuchToRead(n,state))&&state.ended?(0===state.length&&endReadable(this),null):(doRead=state.needReadable,debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&debug("length less than watermark",doRead=!0),state.ended||state.reading?debug("reading or ended",doRead=!1):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state))),null===(doRead=0<n?fromList(n,state):null)?(state.needReadable=state.length<=state.highWaterMark,n=0):(state.length-=n,state.awaitDrain=0),0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n)&&state.ended&&endReadable(this),null!==doRead&&this.emit("data",doRead),doRead)},Readable.prototype._read=function(n){errorOrDestroy(this,new ERR_METHOD_NOT_IMPLEMENTED("_read()"))},Readable.prototype.pipe=function(dest,pipeOpts){var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);pipeOpts=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr?onend:unpipe;function onunpipe(readable,unpipeInfo){debug("onunpipe"),readable===src&&unpipeInfo&&!1===unpipeInfo.hasUnpiped&&(unpipeInfo.hasUnpiped=!0,debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",unpipe),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain())}function onend(){debug("onend"),dest.end()}state.endEmitted?process.nextTick(pipeOpts):src.once("end",pipeOpts),dest.on("unpipe",onunpipe);var ondrain=function(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}(src),cleanedUp=(dest.on("drain",ondrain),!1);function ondata(chunk){debug("ondata");chunk=dest.write(chunk);debug("dest.write",chunk),!1===chunk&&((1===state.pipesCount&&state.pipes===dest||1<state.pipesCount&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",state.awaitDrain),state.awaitDrain++),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&errorOrDestroy(dest,er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}return src.on("data",ondata),function(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?Array.isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState,unpipeInfo={hasUnpiped:!1};if(0!==state.pipesCount)if(1===state.pipesCount)dest&&dest!==state.pipes||(dest=dest||state.pipes,state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this,unpipeInfo));else if(dest){var index=indexOf(state.pipes,dest);-1!==index&&(state.pipes.splice(index,1),--state.pipesCount,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this,unpipeInfo))}else{var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;i<len;i++)dests[i].emit("unpipe",this,{hasUnpiped:!1})}return this},Readable.prototype.addListener=Readable.prototype.on=function(ev,fn){var fn=Stream.prototype.on.call(this,ev,fn),state=this._readableState;return"data"===ev?(state.readableListening=0<this.listenerCount("readable"),!1!==state.flowing&&this.resume()):"readable"!==ev||state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.flowing=!1,state.emittedReadable=!1,debug("on readable",state.length,state.reading),state.length?emitReadable(this):state.reading||process.nextTick(nReadingNextTick,this)),fn},Readable.prototype.removeListener=function(ev,fn){fn=Stream.prototype.removeListener.call(this,ev,fn);return"readable"===ev&&process.nextTick(updateReadableListening,this),fn},Readable.prototype.removeAllListeners=function(ev){var res=Stream.prototype.removeAllListeners.apply(this,arguments);return"readable"!==ev&&void 0!==ev||process.nextTick(updateReadableListening,this),res},Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!state.readableListening,function(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,process.nextTick(resume_,stream,state))}(this,state)),state.paused=!1,this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},Readable.prototype.wrap=function(stream){var i,_this=this,state=this._readableState,paused=!1;for(i in stream.on("end",function(){var chunk;debug("wrapped end"),state.decoder&&!state.ended&&(chunk=state.decoder.end())&&chunk.length&&_this.push(chunk),_this.push(null)}),stream.on("data",function(chunk){debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),state.objectMode&&null==chunk||(state.objectMode||chunk&&chunk.length)&&!_this.push(chunk)&&(paused=!0,stream.pause())}),stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));for(var n=0;n<kProxyEvents.length;n++)stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]));return this._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},this},"function"==typeof Symbol&&(Readable.prototype[Symbol.asyncIterator]=function(){return(createReadableStreamAsyncIterator=void 0===createReadableStreamAsyncIterator?require("./internal/streams/async_iterator"):createReadableStreamAsyncIterator)(this)}),Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Readable.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Readable.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(state){this._readableState&&(this._readableState.flowing=state)}}),Readable._fromList=fromList,Object.defineProperty(Readable.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(Readable.from=function(iterable,opts){return(from=void 0===from?require("./internal/streams/from"):from)(Readable,iterable,opts)})}.call(this)}.call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":21,"./_stream_duplex":22,"./internal/streams/async_iterator":27,"./internal/streams/buffer_list":28,"./internal/streams/destroy":29,"./internal/streams/from":31,"./internal/streams/state":33,"./internal/streams/stream":34,_process:12,buffer:5,events:7,inherits:11,"string_decoder/":36,util:2}],25:[function(require,module,exports){"use strict";module.exports=Transform;var module=require("../errors").codes,ERR_METHOD_NOT_IMPLEMENTED=module.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=module.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=module.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=module.ERR_TRANSFORM_WITH_LENGTH_0,Duplex=require("./_stream_duplex");function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState={afterTransform:function(er,data){var ts=this._transformState,cb=(ts.transforming=!1,ts.writecb);if(null===cb)return this.emit("error",new ERR_MULTIPLE_CALLBACK);ts.writechunk=null,(ts.writecb=null)!=data&&this.push(data),cb(er),(ts=this._readableState).reading=!1,(ts.needReadable||ts.length<ts.highWaterMark)&&this._read(ts.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush)&&(this._flush=options.flush),this.on("prefinish",prefinish)}function prefinish(){var _this=this;"function"!=typeof this._flush||this._readableState.destroyed?done(this,null,null):this._flush(function(er,data){done(_this,er,data)})}function done(stream,er,data){if(er)return stream.emit("error",er);if(null!=data&&stream.push(data),stream._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0;if(stream._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING;stream.push(null)}require("inherits")(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){cb(new ERR_METHOD_NOT_IMPLEMENTED("_transform()"))},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming&&(cb=this._readableState,ts.needTransform||cb.needReadable||cb.length<cb.highWaterMark)&&this._read(cb.highWaterMark)},Transform.prototype._read=function(n){var ts=this._transformState;null===ts.writechunk||ts.transforming?ts.needTransform=!0:(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform))},Transform.prototype._destroy=function(err,cb){Duplex.prototype._destroy.call(this,err,function(err2){cb(err2)})}},{"../errors":21,"./_stream_duplex":22,inherits:11}],26:[function(require,module,exports){!function(process,global){!function(){"use strict";function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(){!function(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;for(;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree.next=corkReq}(_this,state)}}(module.exports=Writable).WritableState=WritableState;var Duplex,internalUtil={deprecate:require("util-deprecate")},Stream=require("./internal/streams/stream"),Buffer=require("buffer").Buffer,OurUint8Array=(void 0!==global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var realHasInstance,destroyImpl=require("./internal/streams/destroy"),getHighWaterMark=require("./internal/streams/state").getHighWaterMark,_require$codes=require("../errors").codes,ERR_INVALID_ARG_TYPE=_require$codes.ERR_INVALID_ARG_TYPE,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes.ERR_MULTIPLE_CALLBACK,ERR_STREAM_CANNOT_PIPE=_require$codes.ERR_STREAM_CANNOT_PIPE,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED,ERR_STREAM_NULL_VALUES=_require$codes.ERR_STREAM_NULL_VALUES,ERR_STREAM_WRITE_AFTER_END=_require$codes.ERR_STREAM_WRITE_AFTER_END,ERR_UNKNOWN_ENCODING=_require$codes.ERR_UNKNOWN_ENCODING,errorOrDestroy=destroyImpl.errorOrDestroy;function nop(){}function WritableState(options,stream,isDuplex){Duplex=Duplex||require("./_stream_duplex"),options=options||{},"boolean"!=typeof isDuplex&&(isDuplex=stream instanceof Duplex),this.objectMode=!!options.objectMode,isDuplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode),this.highWaterMark=getHighWaterMark(this,options,"writableHighWaterMark",isDuplex),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;isDuplex=(this.destroyed=!1)===options.decodeStrings;this.decodeStrings=!isDuplex,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){!function(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if("function"!=typeof cb)throw new ERR_MULTIPLE_CALLBACK;(function(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0})(state),er?function(stream,state,sync,er,cb){--state.pendingcb,sync?(process.nextTick(cb,er),process.nextTick(finishMaybe,stream,state),stream._writableState.errorEmitted=!0,errorOrDestroy(stream,er)):(cb(er),stream._writableState.errorEmitted=!0,errorOrDestroy(stream,er),finishMaybe(stream,state))}(stream,state,sync,er,cb):((er=needFinish(state)||stream.destroyed)||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?process.nextTick(afterWrite,stream,state,er,cb):afterWrite(stream,state,er,cb))}(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==options.emitClose,this.autoDestroy=!!options.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}require("inherits")(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out};try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(_){}function Writable(options){var isDuplex=this instanceof(Duplex=Duplex||require("./_stream_duplex"));if(!isDuplex&&!realHasInstance.call(Writable,this))return new Writable(options);this._writableState=new WritableState(options,this,isDuplex),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev),"function"==typeof options.destroy&&(this._destroy=options.destroy),"function"==typeof options.final)&&(this._final=options.final),Stream.call(this)}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,state.destroyed?state.onwrite(new ERR_STREAM_DESTROYED("write")):writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function afterWrite(stream,state,finished,cb){finished||!function(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){for(var l=state.bufferedRequestCount,buffer=new Array(l),l=state.corkedRequestsFree,count=(l.entry=entry,0),allBuffers=!0;entry;)(buffer[count]=entry).isBuf||(allBuffers=!1),entry=entry.next,count+=1;buffer.allBuffers=allBuffers,doWrite(stream,state,!0,state.length,buffer,"",l.finish),state.pendingcb++,state.lastBufferedRequest=null,l.next?(state.corkedRequestsFree=l.next,l.next=null):state.corkedRequestsFree=new CorkedRequest(state),state.bufferedRequestCount=0}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.bufferedRequestCount--,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--,err&&errorOrDestroy(stream,err),state.prefinished=!0,stream.emit("prefinish"),finishMaybe(stream,state)})}function finishMaybe(stream,state){var need=needFinish(state);return need&&(function(stream,state){state.prefinished||state.finalCalled||("function"!=typeof stream._final||state.destroyed?(state.prefinished=!0,stream.emit("prefinish")):(state.pendingcb++,state.finalCalled=!0,process.nextTick(callFinal,stream,state)))}(stream,state),0===state.pendingcb)&&(state.finished=!0,stream.emit("finish"),state.autoDestroy)&&(!(state=stream._readableState)||state.autoDestroy&&state.endEmitted)&&stream.destroy(),need}"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){return!!realHasInstance.call(this,object)||this===Writable&&object&&object._writableState instanceof WritableState}})):realHasInstance=function(object){return object instanceof this},Writable.prototype.pipe=function(){errorOrDestroy(this,new ERR_STREAM_CANNOT_PIPE)},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1,obj=!state.objectMode&&(obj=chunk,Buffer.isBuffer(obj)||obj instanceof OurUint8Array);return obj&&!Buffer.isBuffer(chunk)&&(chunk=function(chunk){return Buffer.from(chunk)}(chunk)),"function"==typeof encoding&&(cb=encoding,encoding=null),encoding=obj?"buffer":encoding||state.defaultEncoding,"function"!=typeof cb&&(cb=nop),state.ending?function(stream,cb){var er=new ERR_STREAM_WRITE_AFTER_END;errorOrDestroy(stream,er),process.nextTick(cb,er)}(this,cb):(obj||function(stream,state,chunk,cb){var er;if(null===chunk?er=new ERR_STREAM_NULL_VALUES:"string"==typeof chunk||state.objectMode||(er=new ERR_INVALID_ARG_TYPE("chunk",["string","Buffer"],chunk)),!er)return 1;errorOrDestroy(stream,er),process.nextTick(cb,er)}(this,state,chunk,cb))&&(state.pendingcb++,ret=function(stream,state,isBuf,chunk,encoding,cb){isBuf||(newChunk=function(state,chunk,encoding){state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=Buffer.from(chunk,encoding));return chunk}(state,chunk,encoding),chunk!==newChunk&&(isBuf=!0,encoding="buffer",chunk=newChunk));var newChunk=state.objectMode?1:chunk.length,ret=(state.length+=newChunk,state.length<state.highWaterMark);ret||(state.needDrain=!0);{var last;state.writing||state.corked?(last=state.lastBufferedRequest,state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null},last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1):doWrite(stream,state,!1,newChunk,chunk,encoding,cb)}return ret}(this,state,obj,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase()))return this._writableState.defaultEncoding=encoding,this;throw new ERR_UNKNOWN_ENCODING(encoding)},Object.defineProperty(Writable.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(chunk,encoding,cb){cb(new ERR_METHOD_NOT_IMPLEMENTED("_write()"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;return"function"==typeof chunk?(cb=chunk,encoding=chunk=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!=chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||function(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?process.nextTick(cb):stream.once("finish",cb));state.ended=!0,stream.writable=!1}(this,state,cb),this},Object.defineProperty(Writable.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(Writable.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(value){this._writableState&&(this._writableState.destroyed=value)}}),Writable.prototype.destroy=destroyImpl.destroy,Writable.prototype._undestroy=destroyImpl.undestroy,Writable.prototype._destroy=function(err,cb){cb(err)}}.call(this)}.call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":21,"./_stream_duplex":22,"./internal/streams/destroy":29,"./internal/streams/state":33,"./internal/streams/stream":34,_process:12,buffer:5,inherits:11,"util-deprecate":39}],27:[function(require,module,exports){!function(process){!function(){"use strict";var _Object$setPrototypeO;function _defineProperty(obj,key,value){(key=function(arg){arg=function(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!=typeof prim)return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"==typeof arg?arg:String(arg)}(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}var finished=require("./end-of-stream"),kLastResolve=Symbol("lastResolve"),kLastReject=Symbol("lastReject"),kError=Symbol("error"),kEnded=Symbol("ended"),kLastPromise=Symbol("lastPromise"),kHandlePromise=Symbol("handlePromise"),kStream=Symbol("stream");function readAndResolve(iter){var data,resolve=iter[kLastResolve];null!==resolve&&null!==(data=iter[kStream].read())&&(iter[kLastPromise]=null,iter[kLastResolve]=null,iter[kLastReject]=null,resolve({value:data,done:!1}))}var AsyncIteratorPrototype=Object.getPrototypeOf(function(){}),ReadableStreamAsyncIteratorPrototype=Object.setPrototypeOf((_defineProperty(_Object$setPrototypeO={get stream(){return this[kStream]},next:function(){var _this=this,error=this[kError];if(null!==error)return Promise.reject(error);if(this[kEnded])return Promise.resolve({value:void 0,done:!0});if(this[kStream].destroyed)return new Promise(function(resolve,reject){process.nextTick(function(){_this[kError]?reject(_this[kError]):resolve({value:void 0,done:!0})})});var promise,error=this[kLastPromise];if(error)promise=new Promise(function(lastPromise,iter){return function(resolve,reject){lastPromise.then(function(){iter[kEnded]?resolve({value:void 0,done:!0}):iter[kHandlePromise](resolve,reject)},reject)}}(error,this));else{error=this[kStream].read();if(null!==error)return Promise.resolve({value:error,done:!1});promise=new Promise(this[kHandlePromise])}return this[kLastPromise]=promise}},Symbol.asyncIterator,function(){return this}),_defineProperty(_Object$setPrototypeO,"return",function(){var _this2=this;return new Promise(function(resolve,reject){_this2[kStream].destroy(null,function(err){err?reject(err):resolve({value:void 0,done:!0})})})}),_Object$setPrototypeO),AsyncIteratorPrototype);module.exports=function(stream){var _Object$create,iterator=Object.create(ReadableStreamAsyncIteratorPrototype,(_defineProperty(_Object$create={},kStream,{value:stream,writable:!0}),_defineProperty(_Object$create,kLastResolve,{value:null,writable:!0}),_defineProperty(_Object$create,kLastReject,{value:null,writable:!0}),_defineProperty(_Object$create,kError,{value:null,writable:!0}),_defineProperty(_Object$create,kEnded,{value:stream._readableState.endEmitted,writable:!0}),_defineProperty(_Object$create,kHandlePromise,{value:function(resolve,reject){var data=iterator[kStream].read();data?(iterator[kLastPromise]=null,iterator[kLastResolve]=null,iterator[kLastReject]=null,resolve({value:data,done:!1})):(iterator[kLastResolve]=resolve,iterator[kLastReject]=reject)},writable:!0}),_Object$create));return iterator[kLastPromise]=null,finished(stream,function(err){var reject;err&&"ERR_STREAM_PREMATURE_CLOSE"!==err.code?(null!==(reject=iterator[kLastReject])&&(iterator[kLastPromise]=null,iterator[kLastResolve]=null,iterator[kLastReject]=null,reject(err)),iterator[kError]=err):(null!==(reject=iterator[kLastResolve])&&(iterator[kLastPromise]=null,iterator[kLastResolve]=null,reject({value:void 0,done:!(iterator[kLastReject]=null)})),iterator[kEnded]=!0)}),stream.on("readable",function(iter){process.nextTick(readAndResolve,iter)}.bind(null,iterator)),iterator}}.call(this)}.call(this,require("_process"))},{"./end-of-stream":30,_process:12}],28:[function(require,module,exports){"use strict";function ownKeys(object,enumerableOnly){var symbols,keys=Object.keys(object);return Object.getOwnPropertySymbols&&(symbols=Object.getOwnPropertySymbols(object),enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)),keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){!function(obj,key,value){(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _toPropertyKey(arg){arg=function(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!=typeof prim)return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"==typeof arg?arg:String(arg)}var Buffer=require("buffer").Buffer,inspect=require("util").inspect,custom=inspect&&inspect.custom||"inspect";module.exports=function(){function BufferList(){if(!(this instanceof BufferList))throw new TypeError("Cannot call a class as a function");this.head=null,this.tail=null,this.length=0}var Constructor,protoProps,staticProps;return Constructor=BufferList,(protoProps=[{key:"push",value:function(v){v={data:v,next:null};0<this.length?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(v){v={data:v,next:this.head};0===this.length&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){var ret;if(0!==this.length)return ret=this.head.data,1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret}},{key:"concat",value:function(n){if(0===this.length)return Buffer.alloc(0);for(var src,offset,ret=Buffer.allocUnsafe(n>>>0),p=this.head,i=0;p;)src=p.data,offset=i,Buffer.prototype.copy.call(src,ret,offset),i+=p.data.length,p=p.next;return ret}},{key:"consume",value:function(n,hasStrings){var ret;return n<this.head.data.length?(ret=this.head.data.slice(0,n),this.head.data=this.head.data.slice(n)):ret=n===this.head.data.length?this.shift():hasStrings?this._getString(n):this._getBuffer(n),ret}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(n){var p=this.head,c=1,ret=p.data;for(n-=ret.length;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?this.head=p.next:this.head=this.tail=null):(this.head=p).data=str.slice(nb);break}++c}return this.length-=c,ret}},{key:"_getBuffer",value:function(n){var ret=Buffer.allocUnsafe(n),p=this.head,c=1;for(p.data.copy(ret),n-=p.data.length;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?this.head=p.next:this.head=this.tail=null):(this.head=p).data=buf.slice(nb);break}++c}return this.length-=c,ret}},{key:custom,value:function(_,options){return inspect(this,_objectSpread(_objectSpread({},options),{},{depth:0,customInspect:!1}))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),BufferList}()},{buffer:5,util:2}],29:[function(require,module,exports){!function(process){!function(){"use strict";function emitErrorAndCloseNT(self,err){emitErrorNT(self,err),emitCloseNT(self)}function emitCloseNT(self){self._writableState&&!self._writableState.emitClose||self._readableState&&!self._readableState.emitClose||self.emit("close")}function emitErrorNT(self,err){self.emit("error",err)}module.exports={destroy:function(err,cb){var _this=this,readableDestroyed=this._readableState&&this._readableState.destroyed,writableDestroyed=this._writableState&&this._writableState.destroyed;return readableDestroyed||writableDestroyed?cb?cb(err):err&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(emitErrorNT,this,err)):process.nextTick(emitErrorNT,this,err)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(err||null,function(err){!cb&&err?_this._writableState?_this._writableState.errorEmitted?process.nextTick(emitCloseNT,_this):(_this._writableState.errorEmitted=!0,process.nextTick(emitErrorAndCloseNT,_this,err)):process.nextTick(emitErrorAndCloseNT,_this,err):cb?(process.nextTick(emitCloseNT,_this),cb(err)):process.nextTick(emitCloseNT,_this)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(stream,err){var rState=stream._readableState,wState=stream._writableState;rState&&rState.autoDestroy||wState&&wState.autoDestroy?stream.destroy(err):stream.emit("error",err)}}}.call(this)}.call(this,require("_process"))},{_process:12}],30:[function(require,module,exports){"use strict";var ERR_STREAM_PREMATURE_CLOSE=require("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function noop(){}module.exports=function eos(stream,opts,callback){if("function"==typeof opts)return eos(stream,null,opts);callback=function(callback){var called=!1;return function(){if(!called){called=!0;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];callback.apply(this,args)}}}(callback||noop);function onlegacyfinish(){stream.writable||onfinish()}function onfinish(){writableEnded=!(writable=!1),readable||callback.call(stream)}function onend(){readableEnded=!(readable=!1),writable||callback.call(stream)}function onerror(err){callback.call(stream,err)}function onclose(){var err;return readable&&!readableEnded?(stream._readableState&&stream._readableState.ended||(err=new ERR_STREAM_PREMATURE_CLOSE),callback.call(stream,err)):writable&&!writableEnded?(stream._writableState&&stream._writableState.ended||(err=new ERR_STREAM_PREMATURE_CLOSE),callback.call(stream,err)):void 0}function onrequest(){stream.req.on("finish",onfinish)}var readable=(opts=opts||{}).readable||!1!==opts.readable&&stream.readable,writable=opts.writable||!1!==opts.writable&&stream.writable,writableEnded=stream._writableState&&stream._writableState.finished,readableEnded=stream._readableState&&stream._readableState.endEmitted;return function(stream){return stream.setHeader&&"function"==typeof stream.abort}(stream)?(stream.on("complete",onfinish),stream.on("abort",onclose),stream.req?onrequest():stream.on("request",onrequest)):writable&&!stream._writableState&&(stream.on("end",onlegacyfinish),stream.on("close",onlegacyfinish)),stream.on("end",onend),stream.on("finish",onfinish),!1!==opts.error&&stream.on("error",onerror),stream.on("close",onclose),function(){stream.removeListener("complete",onfinish),stream.removeListener("abort",onclose),stream.removeListener("request",onrequest),stream.req&&stream.req.removeListener("finish",onfinish),stream.removeListener("end",onlegacyfinish),stream.removeListener("close",onlegacyfinish),stream.removeListener("finish",onfinish),stream.removeListener("end",onend),stream.removeListener("error",onerror),stream.removeListener("close",onclose)}}},{"../../../errors":21}],31:[function(require,module,exports){module.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],32:[function(require,module,exports){"use strict";var eos;var _require$codes=require("../../../errors").codes,ERR_MISSING_ARGS=_require$codes.ERR_MISSING_ARGS,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED;function noop(err){if(err)throw err}function destroyer(stream,reading,writing,callback){callback=function(callback){var called=!1;return function(){called||(called=!0,callback.apply(void 0,arguments))}}(callback);var closed=!1,destroyed=(stream.on("close",function(){closed=!0}),(eos=void 0===eos?require("./end-of-stream"):eos)(stream,{readable:reading,writable:writing},function(err){if(err)return callback(err);closed=!0,callback()}),!1);return function(err){if(!closed&&!destroyed)return destroyed=!0,function(stream){return stream.setHeader&&"function"==typeof stream.abort}(stream)?stream.abort():"function"==typeof stream.destroy?stream.destroy():void callback(err||new ERR_STREAM_DESTROYED("pipe"))}}function call(fn){fn()}function pipe(from,to){return from.pipe(to)}module.exports=function(){for(var _len=arguments.length,streams=new Array(_len),_key=0;_key<_len;_key++)streams[_key]=arguments[_key];var error,callback=function(streams){return!streams.length||"function"!=typeof streams[streams.length-1]?noop:streams.pop()}(streams);if((streams=Array.isArray(streams[0])?streams[0]:streams).length<2)throw new ERR_MISSING_ARGS("streams");var destroys=streams.map(function(stream,i){var reading=i<streams.length-1;return destroyer(stream,reading,0<i,function(err){error=error||err,err&&destroys.forEach(call),reading||(destroys.forEach(call),callback(error))})});return streams.reduce(pipe)}},{"../../../errors":21,"./end-of-stream":30}],33:[function(require,module,exports){"use strict";var ERR_INVALID_OPT_VALUE=require("../../../errors").codes.ERR_INVALID_OPT_VALUE;module.exports={getHighWaterMark:function(state,options,duplexKey,isDuplex){if(null==(options=function(options,isDuplex,duplexKey){return null!=options.highWaterMark?options.highWaterMark:isDuplex?options[duplexKey]:null}(options,isDuplex,duplexKey)))return state.objectMode?16:16384;if(!isFinite(options)||Math.floor(options)!==options||options<0)throw new ERR_INVALID_OPT_VALUE(isDuplex?duplexKey:"highWaterMark",options);return Math.floor(options)}}},{"../../../errors":21}],34:[function(require,module,exports){module.exports=require("events").EventEmitter},{events:7}],35:[function(require,module,exports){(((exports=module.exports=require("./lib/_stream_readable.js")).Stream=exports).Readable=exports).Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js"),exports.finished=require("./lib/internal/streams/end-of-stream.js"),exports.pipeline=require("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":22,"./lib/_stream_passthrough.js":23,"./lib/_stream_readable.js":24,"./lib/_stream_transform.js":25,"./lib/_stream_writable.js":26,"./lib/internal/streams/end-of-stream.js":30,"./lib/internal/streams/pipeline.js":32}],36:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,isEncoding=Buffer.isEncoding||function(encoding){switch((encoding=""+encoding)&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function normalizeEncoding(enc){var nenc=function(enc){if(!enc)return"utf8";for(var retried;;)switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase(),retried=!0}}(enc);if("string"==typeof nenc||Buffer.isEncoding!==isEncoding&&isEncoding(enc))return nenc||enc;throw new Error("Unknown encoding: "+enc)}function StringDecoder(encoding){var nb;switch(this.encoding=normalizeEncoding(encoding),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,nb=4;break;case"utf8":this.fillLast=utf8FillLast,nb=4;break;case"base64":this.text=base64Text,this.end=base64End,nb=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(nb)}function utf8CheckByte(byte){return byte<=127?0:byte>>5==6?2:byte>>4==14?3:byte>>3==30?4:byte>>6==2?-1:-2}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed,r=function(self,buf){return 128!=(192&buf[0])?(self.lastNeed=0,"�"):1<self.lastNeed&&1<buf.length?128!=(192&buf[1])?(self.lastNeed=1,"�"):2<self.lastNeed&&2<buf.length&&128!=(192&buf[2])?(self.lastNeed=2,"�"):void 0:void 0}(this,buf);return void 0!==r?r:this.lastNeed<=buf.length?(buf.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(buf.copy(this.lastChar,p,0,buf.length),void(this.lastNeed-=buf.length))}function utf16Text(buf,i){if((buf.length-i)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=buf[buf.length-1],buf.toString("utf16le",i,buf.length-1);i=buf.toString("utf16le",i);if(i){var c=i.charCodeAt(i.length-1);if(55296<=c&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1],i.slice(0,-1)}return i}function utf16End(buf){var end,buf=buf&&buf.length?this.write(buf):"";return this.lastNeed?(end=this.lastTotal-this.lastNeed,buf+this.lastChar.toString("utf16le",0,end)):buf}function base64Text(buf,i){var n=(buf.length-i)%3;return 0==n?buf.toString("base64",i):(this.lastNeed=3-n,this.lastTotal=3,1==n?this.lastChar[0]=buf[buf.length-1]:(this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1]),buf.toString("base64",i,buf.length-n))}function base64End(buf){buf=buf&&buf.length?this.write(buf):"";return this.lastNeed?buf+this.lastChar.toString("base64",0,3-this.lastNeed):buf}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}(exports.StringDecoder=StringDecoder).prototype.write=function(buf){if(0===buf.length)return"";var r,i;if(this.lastNeed){if(void 0===(r=this.fillLast(buf)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<buf.length?r?r+this.text(buf,i):this.text(buf,i):r||""},StringDecoder.prototype.end=function(buf){buf=buf&&buf.length?this.write(buf):"";return this.lastNeed?buf+"�":buf},StringDecoder.prototype.text=function(buf,i){var total=function(self,buf,i){var j=buf.length-1;if(!(j<i)){var nb=utf8CheckByte(buf[j]);if(0<=nb)return 0<nb&&(self.lastNeed=nb-1),nb;if(!(--j<i||-2===nb)){if(0<=(nb=utf8CheckByte(buf[j])))return 0<nb&&(self.lastNeed=nb-2),nb;if(!(--j<i||-2===nb)&&0<=(nb=utf8CheckByte(buf[j])))return 0<nb&&(2===nb?nb=0:self.lastNeed=nb-3),nb}}return 0}(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;total=buf.length-(total-this.lastNeed);return buf.copy(this.lastChar,0,total),buf.toString("utf8",i,total)},StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length)return buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length),this.lastNeed-=buf.length}},{"safe-buffer":16}],37:[function(require,module,exports){"use strict";var punycode=require("punycode"),util=require("./util");function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.parse=urlParse,exports.resolve=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.resolveObject=function(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative},exports.format=function(obj){util.isString(obj)&&(obj=urlParse(obj));return obj instanceof Url?obj.format():Url.prototype.format.call(obj)},exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,exports=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(exports),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){var u;return url&&util.isObject(url)&&url instanceof Url?url:((u=new Url).parse(url,parseQueryString,slashesDenoteHost),u)}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),queryIndex=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(queryIndex);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=(rest=url=uSplit.join(queryIndex)).trim();if(!slashesDenoteHost&&1===url.split("#").length){uSplit=simplePathPattern.exec(rest);if(uSplit)return this.path=rest,this.href=rest,this.pathname=uSplit[1],uSplit[2]?(this.search=uSplit[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var lowerProto,queryIndex=protocolPattern.exec(rest);if(queryIndex&&(lowerProto=(queryIndex=queryIndex[0]).toLowerCase(),this.protocol=lowerProto,rest=rest.substr(queryIndex.length)),!(slashesDenoteHost||queryIndex||rest.match(/^\/\/[^@\/]+@[^@\/]+/))||!(slashes="//"===rest.substr(0,2))||queryIndex&&hostlessProtocol[queryIndex]||(rest=rest.substr(2),this.slashes=!0),!hostlessProtocol[queryIndex]&&(slashes||queryIndex&&!slashedProtocol[queryIndex])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++)-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec);-1!==(url=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(uSplit=rest.slice(0,url),rest=rest.slice(url+1),this.auth=decodeURIComponent(uSplit));for(var hec,hostEnd=-1,i=0;i<nonHostChars.length;i++)-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec);-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";slashesDenoteHost="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!slashesDenoteHost)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)127<part.charCodeAt(j)?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),slashesDenoteHost||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",slashes=this.hostname||"";this.host=slashes+p,this.href+=this.host,slashesDenoteHost&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0])&&(rest="/"+rest)}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var esc,ae=autoEscape[i];-1!==rest.indexOf(ae)&&((esc=encodeURIComponent(ae))===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc))}queryIndex=rest.indexOf("#"),-1!==queryIndex&&(this.hash=rest.substr(queryIndex),rest=rest.slice(0,queryIndex)),url=rest.indexOf("?");return-1!==url?(this.search=rest.substr(url),this.query=rest.substr(url+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,url)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(p=this.pathname||"",uSplit=this.search||"",this.path=p+uSplit),this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"",protocol=(auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@"),this.protocol||""),pathname=this.pathname||"",hash=this.hash||"",host=!1,query="",auth=(this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port)&&(host+=":"+this.port),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query)),this.search||query&&"?"+query||"");return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host=host||"",hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),auth&&"?"!==auth.charAt(0)&&(auth="?"+auth),protocol+host+(pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}))+(auth=auth.replace("#","%23"))+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){util.isString(relative)&&((rel=new Url).parse(relative,!1,!0),relative=rel);for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""!==relative.href)if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/")}else if(relative.protocol&&relative.protocol!==result.protocol)if(slashedProtocol[relative.protocol]){if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,(result.pathname||result.search)&&(rel=result.pathname||"",s=result.search||"",result.path=rel+s),result.slashes=result.slashes||relative.slashes}else for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}else{var rel=result.pathname&&"/"===result.pathname.charAt(0),s=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),rel=s||rel||result.host&&relative.pathname,removeAllDots=rel,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),rel=rel&&(""===relPath[0]||""===srcPath[0])),s)result.host=(relative.host||""===relative.host?relative:result).host,result.hostname=(relative.hostname||""===relative.hostname?relative:result).hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)(srcPath=srcPath||[]).pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search))return psychotic&&(result.hostname=result.host=srcPath.shift(),authInHost=!!(result.host&&0<result.host.indexOf("@"))&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()),result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname||"")+(result.search||"")),result.href=result.format(),result;if(srcPath.length){for(var last=srcPath.slice(-1)[0],s=(result.host||relative.host||1<srcPath.length)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;0<=i;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!rel&&!removeAllDots)for(;up--;)srcPath.unshift("..");!rel||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),s&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var authInHost,removeAllDots=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);psychotic&&(result.hostname=result.host=!removeAllDots&&srcPath.length?srcPath.shift():"",authInHost=!!(result.host&&0<result.host.indexOf("@"))&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()),(rel=rel||result.host&&srcPath.length)&&!removeAllDots&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname||"")+(result.search||"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes}else result.pathname=null,result.search?result.path="/"+result.search:result.path=null}return result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{"./util":38,punycode:4,querystring:15}],38:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},{}],39:[function(require,module,exports){!function(global){!function(){function config(name){try{if(!global.localStorage)return}catch(_){return}name=global.localStorage[name];return null!=name&&"true"===String(name).toLowerCase()}module.exports=function(fn,msg){if(config("noDeprecation"))return fn;var warned=!1;return function(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function AdExtension(){classCallCheck(this,AdExtension),this.attributes={},this.children=[]}function AdExtensionChild(){classCallCheck(this,AdExtensionChild),this.name=null,this.value=null,this.attributes={}}function CompanionAd(){classCallCheck(this,CompanionAd),this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}}function Creative(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,Creative),this.id=t.id||null,this.adId=t.adId||null,this.sequence=t.sequence||null,this.apiFramework=t.apiFramework||null,this.trackingEvents={}}var events=require("events"),classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t},Ad=function e(){classCallCheck(this,e),this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]},CreativeCompanion=(inherits(t,Creative),t);function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)));return e.type="companion",e.variations=[],e}function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function resolveURLTemplates(e){var a,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=[];for(a in t.ASSETURI&&(t.ASSETURI=encodeURIComponentRFC3986(t.ASSETURI)),t.CONTENTPLAYHEAD&&(t.CONTENTPLAYHEAD=encodeURIComponentRFC3986(t.CONTENTPLAYHEAD)),!t.ERRORCODE||r.isCustomCode||/^[0-9]{3}$/.test(t.ERRORCODE)||(t.ERRORCODE=900),t.CACHEBUSTING=leftpad(Math.round(1e8*Math.random()).toString()),t.TIMESTAMP=encodeURIComponentRFC3986((new Date).toISOString()),t.RANDOM=t.random=t.CACHEBUSTING,e)if("string"==typeof(n=e[a])){for(var s in t)var o=t[s],c="%%"+s+"%%",n=(n=n.replace("["+s+"]",o)).replace(c,o);i.push(n)}return i}function encodeURIComponentRFC3986(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function leftpad(e){return e.length<8?range(0,8-e.length,!1).map(function(){return"0"}).join("")+e:e}function range(e,t,r){for(var i=[],a=e<t,n=r?a?t+1:t-1:t,s=e;a?s<n:n<s;a?s++:s--)i.push(s);return i}var util={track:function(e,t,r){resolveURLTemplates(e,t,r).forEach(function(e){"undefined"!=typeof window&&null!==window&&((new Image).src=e)})},resolveURLTemplates:resolveURLTemplates,encodeURIComponentRFC3986:encodeURIComponentRFC3986,leftpad:leftpad,range:range,isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},flatten:function flatten(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?flatten(t):t)},[])}};var parserUtils={childByName:function(e,t){var i,r=e.childNodes;for(i in r){var a=r[i];if(a.nodeName===t)return a}},childrenByName:function(e,t){var a,r=[],i=e.childNodes;for(a in i){var n=i[a];n.nodeName===t&&r.push(n)}return r},resolveVastAdTagURI:function(e,t){return t?0===e.indexOf("//")?""+location.protocol+e:-1===e.indexOf("://")?t.slice(0,t.lastIndexOf("/"))+"/"+e:e:e},parseBoolean:function(e){return-1!==["true","TRUE","1"].indexOf(e)},parseNodeText:function(e){return e&&(e.textContent||e.text||"").trim()},copyNodeAttribute:function(e,t,r){(t=t.getAttribute(e))&&r.setAttribute(e,t)},parseDuration:function(e){var i,r;return null==e?-1:util.isNumeric(e)?parseInt(e):3!==(e=e.split(":")).length||(r=e[2].split("."),i=parseInt(r[0]),2===r.length&&(i+=parseFloat("0."+r[1])),r=parseInt(60*e[1]),e=parseInt(60*e[0]*60),isNaN(e))||isNaN(r)||isNaN(i)||3600<r||60<i?-1:e+r+i},splitVAST:function(e){var t=[],r=null;return e.forEach(function(i,a){if(i.sequence&&(i.sequence=parseInt(i.sequence,10)),1<i.sequence){a=e[a-1];if(a&&a.sequence===i.sequence-1)return void(r&&r.push(i));delete i.sequence}r=[i],t.push(r)}),t},mergeWrapperAdData:function(e,t){e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),e.creatives.forEach(function(e){if(t.trackingEvents&&t.trackingEvents[e.type])for(var r in t.trackingEvents[e.type]){var i=t.trackingEvents[e.type][r];Array.isArray(e.trackingEvents[r])||(e.trackingEvents[r]=[]),e.trackingEvents[r]=e.trackingEvents[r].concat(i)}}),t.videoClickTrackingURLTemplates&&t.videoClickTrackingURLTemplates.length&&e.creatives.forEach(function(e){"linear"===e.type&&(e.videoClickTrackingURLTemplates=e.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates))}),t.videoCustomClickURLTemplates&&t.videoCustomClickURLTemplates.length&&e.creatives.forEach(function(e){"linear"===e.type&&(e.videoCustomClickURLTemplates=e.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates))}),t.videoClickThroughURLTemplate&&e.creatives.forEach(function(e){"linear"!==e.type||null!==e.videoClickThroughURLTemplate&&void 0!==e.videoClickThroughURLTemplate||(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate)})}};function Icon(){classCallCheck(this,Icon),this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null}function MediaFile(){classCallCheck(this,MediaFile),this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}var CreativeLinear=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)));return e.type="linear",e.duration=0,e.skipDelay=null,e.mediaFiles=[],e.videoClickThroughURLTemplate=null,e.videoClickTrackingURLTemplates=[],e.videoCustomClickURLTemplates=[],e.adParameters=null,e.icons=[],e}return inherits(t,Creative),t}();function parseCreativeLinear(e,t){var r=void 0,i=new CreativeLinear(t),t=(i.duration=parserUtils.parseDuration(parserUtils.parseNodeText(parserUtils.childByName(e,"Duration"))),e.getAttribute("skipoffset")),n=(null==t?i.skipDelay=null:"%"===t.charAt(t.length-1)&&-1!==i.duration?(n=parseInt(t,10),i.skipDelay=i.duration*(n/100)):i.skipDelay=parserUtils.parseDuration(t),parserUtils.childByName(e,"VideoClicks")),t=(n&&(i.videoClickThroughURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(n,"ClickThrough")),parserUtils.childrenByName(n,"ClickTracking").forEach(function(e){i.videoClickTrackingURLTemplates.push(parserUtils.parseNodeText(e))}),parserUtils.childrenByName(n,"CustomClick").forEach(function(e){i.videoCustomClickURLTemplates.push(parserUtils.parseNodeText(e))})),parserUtils.childByName(e,"AdParameters")),n=(t&&(i.adParameters=parserUtils.parseNodeText(t)),parserUtils.childrenByName(e,"TrackingEvents").forEach(function(e){parserUtils.childrenByName(e,"Tracking").forEach(function(e){var t=e.getAttribute("event"),a=parserUtils.parseNodeText(e);if(t&&a){if("progress"===t){if(!(r=e.getAttribute("offset")))return;t="%"===r.charAt(r.length-1)?"progress-"+r:"progress-"+Math.round(parserUtils.parseDuration(r))}Array.isArray(i.trackingEvents[t])||(i.trackingEvents[t]=[]),i.trackingEvents[t].push(a)}})}),parserUtils.childrenByName(e,"MediaFiles").forEach(function(e){parserUtils.childrenByName(e,"MediaFile").forEach(function(e){var t=new MediaFile,r=(t.id=e.getAttribute("id"),t.fileURL=parserUtils.parseNodeText(e),t.deliveryType=e.getAttribute("delivery"),t.codec=e.getAttribute("codec"),t.mimeType=e.getAttribute("type"),t.apiFramework=e.getAttribute("apiFramework"),t.bitrate=parseInt(e.getAttribute("bitrate")||0),t.minBitrate=parseInt(e.getAttribute("minBitrate")||0),t.maxBitrate=parseInt(e.getAttribute("maxBitrate")||0),t.width=parseInt(e.getAttribute("width")||0),t.height=parseInt(e.getAttribute("height")||0),e.getAttribute("scalable")),r=(r&&"string"==typeof r&&("true"===(r=r.toLowerCase())?t.scalable=!0:"false"===r&&(t.scalable=!1)),e.getAttribute("maintainAspectRatio"));r&&"string"==typeof r&&("true"===(r=r.toLowerCase())?t.maintainAspectRatio=!0:"false"===r&&(t.maintainAspectRatio=!1)),i.mediaFiles.push(t)})}),parserUtils.childByName(e,"Icons"));return n&&parserUtils.childrenByName(n,"Icon").forEach(function(e){var t=new Icon,r=(t.program=e.getAttribute("program"),t.height=parseInt(e.getAttribute("height")||0),t.width=parseInt(e.getAttribute("width")||0),t.xPosition=function(e){return-1!==["left","right"].indexOf(e)?e:parseInt(e||0)}(e.getAttribute("xPosition")),t.yPosition=function(e){return-1!==["top","bottom"].indexOf(e)?e:parseInt(e||0)}(e.getAttribute("yPosition")),t.apiFramework=e.getAttribute("apiFramework"),t.offset=parserUtils.parseDuration(e.getAttribute("offset")),t.duration=parserUtils.parseDuration(e.getAttribute("duration")),parserUtils.childrenByName(e,"HTMLResource").forEach(function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,"IFrameResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,"StaticResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.staticResource=parserUtils.parseNodeText(e)}),parserUtils.childByName(e,"IconClicks"));r&&(t.iconClickThroughURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(r,"IconClickThrough")),parserUtils.childrenByName(r,"IconClickTracking").forEach(function(e){t.iconClickTrackingURLTemplates.push(parserUtils.parseNodeText(e))})),t.iconViewTrackingURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(e,"IconViewTracking")),i.icons.push(t)}),i}function NonLinearAd(){classCallCheck(this,NonLinearAd),this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null}var CreativeNonLinear=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)));return e.type="nonlinear",e.variations=[],e}return inherits(t,Creative),t}();function parseAd(e){var r,t=e.childNodes;for(r in t){var i=t[r];if(-1!==["Wrapper","InLine"].indexOf(i.nodeName)){if(parserUtils.copyNodeAttribute("id",e,i),parserUtils.copyNodeAttribute("sequence",e,i),"Wrapper"===i.nodeName)return function(e){var t=parseInLine(e),r=parserUtils.childByName(e,"VASTAdTagURI");if(r?t.nextWrapperURL=parserUtils.parseNodeText(r):(r=parserUtils.childByName(e,"VASTAdTagURL"))&&(t.nextWrapperURL=parserUtils.parseNodeText(parserUtils.childByName(r,"URL"))),t.creatives.forEach(function(e){if(-1!==["linear","nonlinear"].indexOf(e.type)){if(e.trackingEvents){t.trackingEvents||(t.trackingEvents={}),t.trackingEvents[e.type]||(t.trackingEvents[e.type]={});for(var i in e.trackingEvents)!function(r){var i=e.trackingEvents[r];Array.isArray(t.trackingEvents[e.type][r])||(t.trackingEvents[e.type][r]=[]),i.forEach(function(i){t.trackingEvents[e.type][r].push(i)})}(i)}e.videoClickTrackingURLTemplates&&(Array.isArray(t.videoClickTrackingURLTemplates)||(t.videoClickTrackingURLTemplates=[]),e.videoClickTrackingURLTemplates.forEach(function(e){t.videoClickTrackingURLTemplates.push(e)})),e.videoClickThroughURLTemplate&&(t.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate),e.videoCustomClickURLTemplates&&(Array.isArray(t.videoCustomClickURLTemplates)||(t.videoCustomClickURLTemplates=[]),e.videoCustomClickURLTemplates.forEach(function(e){t.videoCustomClickURLTemplates.push(e)}))}}),t.nextWrapperURL)return t}(i);if("InLine"===i.nodeName)return parseInLine(i)}}}function parseInLine(e){var i,t=e.childNodes,r=new Ad;for(i in r.id=e.getAttribute("id")||null,r.sequence=e.getAttribute("sequence")||null,t){var a=t[i];switch(a.nodeName){case"Error":r.errorURLTemplates.push(parserUtils.parseNodeText(a));break;case"Impression":r.impressionURLTemplates.push(parserUtils.parseNodeText(a));break;case"Creatives":parserUtils.childrenByName(a,"Creative").forEach(function(e){var i,t={id:e.getAttribute("id")||null,adId:function(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null}(e),sequence:e.getAttribute("sequence")||null,apiFramework:e.getAttribute("apiFramework")||null};for(i in e.childNodes){var a=e.childNodes[i],n=void 0;switch(a.nodeName){case"Linear":(n=parseCreativeLinear(a,t))&&r.creatives.push(n);break;case"NonLinearAds":(n=function(e,t){var r=new CreativeNonLinear(t);return parserUtils.childrenByName(e,"TrackingEvents").forEach(function(e){var t,i;parserUtils.childrenByName(e,"Tracking").forEach(function(e){t=e.getAttribute("event"),i=parserUtils.parseNodeText(e),t&&i&&(Array.isArray(r.trackingEvents[t])||(r.trackingEvents[t]=[]),r.trackingEvents[t].push(i))})}),parserUtils.childrenByName(e,"NonLinear").forEach(function(e){var t=new NonLinearAd,i=(t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.expandedWidth=e.getAttribute("expandedWidth"),t.expandedHeight=e.getAttribute("expandedHeight"),t.scalable=parserUtils.parseBoolean(e.getAttribute("scalable")),t.maintainAspectRatio=parserUtils.parseBoolean(e.getAttribute("maintainAspectRatio")),t.minSuggestedDuration=parserUtils.parseDuration(e.getAttribute("minSuggestedDuration")),t.apiFramework=e.getAttribute("apiFramework"),parserUtils.childrenByName(e,"HTMLResource").forEach(function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,"IFrameResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,"StaticResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.staticResource=parserUtils.parseNodeText(e)}),parserUtils.childByName(e,"AdParameters"));i&&(t.adParameters=parserUtils.parseNodeText(i)),t.nonlinearClickThroughURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(e,"NonLinearClickThrough")),parserUtils.childrenByName(e,"NonLinearClickTracking").forEach(function(e){t.nonlinearClickTrackingURLTemplates.push(parserUtils.parseNodeText(e))}),r.variations.push(t)}),r}(a,t))&&r.creatives.push(n);break;case"CompanionAds":(n=function(e,t){var r=new CreativeCompanion(t);return parserUtils.childrenByName(e,"Companion").forEach(function(e){var t=new CompanionAd;t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.companionClickTrackingURLTemplates=[],parserUtils.childrenByName(e,"HTMLResource").forEach(function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,"IFrameResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,"StaticResource").forEach(function(r){t.type=r.getAttribute("creativeType")||0,parserUtils.childrenByName(e,"AltText").forEach(function(e){t.altText=parserUtils.parseNodeText(e)}),t.staticResource=parserUtils.parseNodeText(r)}),parserUtils.childrenByName(e,"TrackingEvents").forEach(function(e){parserUtils.childrenByName(e,"Tracking").forEach(function(e){var r=e.getAttribute("event"),e=parserUtils.parseNodeText(e);r&&e&&(Array.isArray(t.trackingEvents[r])||(t.trackingEvents[r]=[]),t.trackingEvents[r].push(e))})}),parserUtils.childrenByName(e,"CompanionClickTracking").forEach(function(e){t.companionClickTrackingURLTemplates.push(parserUtils.parseNodeText(e))}),t.companionClickThroughURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(e,"CompanionClickThrough")),t.companionClickTrackingURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(e,"CompanionClickTracking")),r.variations.push(t)}),r}(a,t))&&r.creatives.push(n)}}});break;case"Extensions":!function(e,t){t.forEach(function(t){var o,r=new AdExtension,i=t.attributes,a=t.childNodes;if(t.attributes)for(var n in i){n=i[n];n.nodeName&&n.nodeValue&&(r.attributes[n.nodeName]=n.nodeValue)}for(o in a){var l=a[o],c=parserUtils.parseNodeText(l);if("#comment"!==l.nodeName&&""!==c){var u=new AdExtensionChild;if(u.name=l.nodeName,u.value=c,l.attributes){var h,p=l.attributes;for(h in p){var d=p[h];u.attributes[d.nodeName]=d.nodeValue}}r.children.push(u)}}e.push(r)})}(r.extensions,parserUtils.childrenByName(a,"Extension"));break;case"AdSystem":r.system={value:parserUtils.parseNodeText(a),version:a.getAttribute("version")||null};break;case"AdTitle":r.title=parserUtils.parseNodeText(a);break;case"Description":r.description=parserUtils.parseNodeText(a);break;case"Advertiser":r.advertiser=parserUtils.parseNodeText(a);break;case"Pricing":r.pricing={value:parserUtils.parseNodeText(a),model:a.getAttribute("model")||null,currency:a.getAttribute("currency")||null};break;case"Survey":r.survey=parserUtils.parseNodeText(a)}}return r}function xdr(){var e=void 0;return e=window.XDomainRequest?new XDomainRequest:e}var flashURLHandler={get:function(e,t,r){var i="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0;if(!i)return r(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"));i.async=!1;var a=xdr();a.open("GET",e),a.timeout=t.timeout||0,a.withCredentials=t.withCredentials||!1,a.send(),a.onprogress=function(){},a.onload=function(){i.loadXML(a.responseText),r(null,i)}},supported:function(){return!!xdr()}},uri=require("url"),fs=require("fs"),http=require("http"),https=require("https"),DOMParser=require("xmldom").DOMParser;var nodeURLHandler={get:function(e,t,r){var n,o,a,i="https:"===(e=uri.parse(e)).protocol?https:http;"file:"===e.protocol?fs.readFile(e.pathname,"utf8",function(e,t){if(e)return r(e);e=(new DOMParser).parseFromString(t);r(null,e)}):(a=void 0,n="",(i=i.get(e.href,function(e){e.on("data",function(e){n+=e,clearTimeout(a),a=setTimeout(o,t.timeout||12e4)}),e.on("end",function(){clearTimeout(a);var e=(new DOMParser).parseFromString(n);r(null,e)})})).on("error",function(e){clearTimeout(a),r(e)}),o=function(e){return function(){return e.abort()}}(i),a=setTimeout(o,t.timeout||12e4))}};function xhr(){try{var e=new window.XMLHttpRequest;return"withCredentials"in e?e:null}catch(e){return null}}var XHRURLHandler={get:function(e,t,r){if("https:"===window.location.protocol&&0===e.indexOf("http://"))return r(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{var i=xhr();i.open("GET",e),i.timeout=t.timeout||0,i.withCredentials=t.withCredentials||!1,i.overrideMimeType&&i.overrideMimeType("text/xml"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?r(null,i.responseXML):r(new Error("XHRURLHandler: "+i.statusText)))},i.send()}catch(e){r(new Error("XHRURLHandler: Unexpected error"))}},supported:function(){return!!xhr()}};function VASTResponse(){classCallCheck(this,VASTResponse),this.ads=[],this.errorURLTemplates=[],this.version=null}var urlHandler={get:function(e,t,r){return r||("function"==typeof t&&(r=t),t={}),"undefined"==typeof window||null===window?nodeURLHandler.get(e,t,r):XHRURLHandler.supported()?XHRURLHandler.get(e,t,r):flashURLHandler.supported()?flashURLHandler.get(e,t,r):r(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))}},DEFAULT_EVENT_DATA={ERRORCODE:900,extensions:[]},VASTParser=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.remainingAds=[],e.parentURLs=[],e.errorURLTemplates=[],e.rootErrorURLTemplates=[],e.maxWrapperDepth=null,e.URLTemplateFilters=[],e.fetchingOptions={},e}return inherits(t,e),createClass(t,[{key:"addURLTemplateFilter",value:function(e){"function"==typeof e&&this.URLTemplateFilters.push(e)}},{key:"removeURLTemplateFilter",value:function(){this.URLTemplateFilters.pop()}},{key:"countURLTemplateFilters",value:function(){return this.URLTemplateFilters.length}},{key:"clearURLTemplateFilters",value:function(){this.URLTemplateFilters=[]}},{key:"trackVastError",value:function(e,t){for(var r=arguments.length,i=Array(2<r?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];this.emit("VAST-error",Object.assign.apply(Object,[{},DEFAULT_EVENT_DATA,t].concat(i))),util.track(e,t)}},{key:"getErrorURLTemplates",value:function(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}},{key:"fetchVAST",value:function(e,t,r){var i=this;return new Promise(function(a,n){i.URLTemplateFilters.forEach(function(t){e=t(e)}),i.parentURLs.push(e),i.emit("VAST-resolving",{url:e,wrapperDepth:t,originalUrl:r}),i.urlHandler.get(e,i.fetchingOptions,function(t,r){i.emit("VAST-resolved",{url:e,error:t}),t?n(t):a(r)})})}},{key:"initParsingStatus",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.rootURL="",this.remainingAds=[],this.parentURLs=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.maxWrapperDepth=e.wrapperLimit||10,this.fetchingOptions={timeout:e.timeout,withCredentials:e.withCredentials},this.urlHandler=e.urlHandler||e.urlhandler||urlHandler,this.vastVersion=null}},{key:"getRemainingAds",value:function(e){var t=this;return 0===this.remainingAds.length?Promise.reject(new Error("No more ads are available for the given VAST")):(e=e?util.flatten(this.remainingAds):this.remainingAds.shift(),this.errorURLTemplates=[],this.parentURLs=[],this.resolveAds(e,{wrapperDepth:0,originalUrl:this.rootURL}).then(function(e){return t.buildVASTResponse(e)}))}},{key:"getAndParseVAST",value:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),this.rootURL=e,this.fetchVAST(e).then(function(i){return r.originalUrl=e,r.isRootVAST=!0,t.parse(i,r).then(function(e){return t.buildVASTResponse(e)})})}},{key:"parseVAST",value:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),r.isRootVAST=!0,this.parse(e,r).then(function(e){return t.buildVASTResponse(e)})}},{key:"buildVASTResponse",value:function(e){var t=new VASTResponse;return t.ads=e,t.errorURLTemplates=this.getErrorURLTemplates(),t.version=this.vastVersion,this.completeWrapperResolving(t),t}},{key:"parseVastXml",value:function(e,t){var t=t.isRootVAST,i=void 0!==t&&t;if(!e||!e.documentElement||"VAST"!==e.documentElement.nodeName)throw new Error("Invalid VAST XMLDocument");var o,a=[],n=e.documentElement.childNodes;for(o in i&&(t=e.documentElement.getAttribute("version"))&&(this.vastVersion=t),n){var c,l=n[o];"Error"===l.nodeName&&(c=parserUtils.parseNodeText(l),(i?this.rootErrorURLTemplates:this.errorURLTemplates).push(c)),"Ad"===l.nodeName&&((c=parseAd(l))?a.push(c):this.trackVastError(this.getErrorURLTemplates(),{ERRORCODE:101}))}return a}},{key:"parse",value:function(e,t){var r=t.resolveAll,r=void 0===r||r,a=t.wrapperSequence,a=void 0===a?null:a,s=t.originalUrl,s=void 0===s?null:s,l=t.wrapperDepth,l=void 0===l?0:l,t=t.isRootVAST,t=void 0!==t&&t,h=[];try{h=this.parseVastXml(e,{isRootVAST:t})}catch(e){return Promise.reject(e)}var t=h.length,v=h[t-1];return 1===t&&null!=a&&v&&!v.sequence&&(v.sequence=a),!1===r&&(this.remainingAds=parserUtils.splitVAST(h),h=this.remainingAds.shift()),this.resolveAds(h,{wrapperDepth:l,originalUrl:s})}},{key:"resolveAds",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1],i=r.wrapperDepth,a=r.originalUrl,n=[];return t.forEach(function(t){t=e.resolveWrappers(t,i,a);n.push(t)}),Promise.all(n).then(function(t){var n,t=util.flatten(t);return!t&&0<e.remainingAds.length?(n=e.remainingAds.shift(),e.resolveAds(n,{wrapperDepth:i,originalUrl:a})):t})}},{key:"resolveWrappers",value:function(e,t,r){var i=this;return new Promise(function(a){if(t++,!e.nextWrapperURL)return delete e.nextWrapperURL,a(e);if(t>=i.maxWrapperDepth||-1!==i.parentURLs.indexOf(e.nextWrapperURL))return e.errorCode=302,delete e.nextWrapperURL,a(e);e.nextWrapperURL=parserUtils.resolveVastAdTagURI(e.nextWrapperURL,r);var n=e.sequence;r=e.nextWrapperURL,i.fetchVAST(e.nextWrapperURL,t,r).then(function(s){return i.parse(s,{originalUrl:r,wrapperSequence:n,wrapperDepth:t}).then(function(t){if(delete e.nextWrapperURL,0===t.length)return e.creatives=[],a(e);t.forEach(function(t){t&&parserUtils.mergeWrapperAdData(t,e)}),a(t)})}).catch(function(t){e.errorCode=301,e.errorMessage=t.message,a(e)})})}},{key:"completeWrapperResolving",value:function(e){if(0===e.ads.length)this.trackVastError(e.errorURLTemplates,{ERRORCODE:303});else for(var t=e.ads.length-1;0<=t;t--){var r=e.ads[t];!r.errorCode&&0!==r.creatives.length||(this.trackVastError(r.errorURLTemplates.concat(e.errorURLTemplates),{ERRORCODE:r.errorCode||303},{ERRORMESSAGE:r.errorMessage||""},{extensions:r.extensions},{system:r.system}),e.ads.splice(t,1))}}}]),t}(events.EventEmitter),storage=null,DEFAULT_STORAGE={data:{},length:0,getItem:function(e){return this.data[e]},setItem:function(e,t){this.data[e]=t,this.length=Object.keys(this.data).length},removeItem:function(e){delete this.data[e],this.length=Object.keys(this.data).length},clear:function(){this.data={},this.length=0}},Storage=function(){function e(){classCallCheck(this,e),this.storage=this.initStorage()}return createClass(e,[{key:"initStorage",value:function(){if(!storage){try{storage="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){storage=null}storage&&!this.isStorageDisabled(storage)||(storage=DEFAULT_STORAGE).clear()}return storage}},{key:"isStorageDisabled",value:function(e){var t="__VASTStorage__";try{if(e.setItem(t,t),e.getItem(t)!==t)return e.removeItem(t),!0}catch(e){return!0}return e.removeItem(t),!1}},{key:"getItem",value:function(e){return this.storage.getItem(e)}},{key:"setItem",value:function(e,t){return this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){return this.storage.removeItem(e)}},{key:"clear",value:function(){return this.storage.clear()}}]),e}(),require=function(){function e(t,r,i){classCallCheck(this,e),this.cappingFreeLunch=t||0,this.cappingMinimumTimeInterval=r||0,this.defaultOptions={withCredentials:!1,timeout:0},this.vastParser=new VASTParser,this.storage=i||new Storage,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}return createClass(e,[{key:"getParser",value:function(){return this.vastParser}},{key:"hasRemainingAds",value:function(){return 0<this.vastParser.remainingAds.length}},{key:"getNextAds",value:function(e){return this.vastParser.getRemainingAds(e)}},{key:"get",value:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=Date.now();return(r=Object.assign({},this.defaultOptions,r)).hasOwnProperty("resolveAll")||(r.resolveAll=!1),this.totalCallsTimeout<i?(this.totalCalls=1,this.totalCallsTimeout=i+36e5):this.totalCalls++,new Promise(function(a,n){if(t.cappingFreeLunch>=t.totalCalls)return n(new Error("VAST call canceled – FreeLunch capping not reached yet "+t.totalCalls+"/"+t.cappingFreeLunch));var s=i-t.lastSuccessfulAd;if(s<0)t.lastSuccessfulAd=0;else if(s<t.cappingMinimumTimeInterval)return n(new Error("VAST call canceled – ("+t.cappingMinimumTimeInterval+")ms minimum interval reached"));t.vastParser.getAndParseVAST(e,r).then(function(e){return a(e)}).catch(function(e){return n(e)})})}},{key:"lastSuccessfulAd",get:function(){return this.storage.getItem("vast-client-last-successful-ad")},set:function(e){this.storage.setItem("vast-client-last-successful-ad",e)}},{key:"totalCalls",get:function(){return this.storage.getItem("vast-client-total-calls")},set:function(e){this.storage.setItem("vast-client-total-calls",e)}},{key:"totalCallsTimeout",get:function(){return this.storage.getItem("vast-client-total-calls-timeout")},set:function(e){this.storage.setItem("vast-client-total-calls-timeout",e)}}]),e}(),events=function(e){function t(e,r,i){var s,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,n=(classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)));for(s in n.ad=r,n.creative=i,n.variation=a,n.muted=!1,n.impressed=!1,n.skippable=!1,n.trackingEvents={},n._alreadyTriggeredQuartiles={},n.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],n.creative.trackingEvents){var o=n.creative.trackingEvents[s];n.trackingEvents[s]=o.slice(0)}return n.creative instanceof CreativeLinear?n._initLinearTracking():n._initVariationTracking(),e&&n.on("start",function(){e.lastSuccessfulAd=Date.now()}),n}return inherits(t,e),createClass(t,[{key:"_initLinearTracking",value:function(){this.linear=!0,this.skipDelay=this.creative.skipDelay,this.setDuration(this.creative.duration),this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates}},{key:"_initVariationTracking",value:function(){if(this.linear=!1,this.skipDelay=-1,this.variation){for(var e in this.variation.trackingEvents){var t=this.variation.trackingEvents[e];this.trackingEvents[e]?this.trackingEvents[e]=this.trackingEvents[e].concat(t.slice(0)):this.trackingEvents[e]=t.slice(0)}this.variation instanceof NonLinearAd?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates,this.setDuration(this.variation.minSuggestedDuration)):this.variation instanceof CompanionAd&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates)}}},{key:"setDuration",value:function(e){this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}}},{key:"setProgress",value:function(e){var t=this,r=this.skipDelay||-1;if(-1===r||this.skippable||(e<r?this.emit("skip-countdown",r-e):(this.skippable=!0,this.emit("skip-countdown",0))),0<this.assetDuration){var i=[];if(0<e){var n,r=Math.round(e/this.assetDuration*100);for(n in i.push("start"),i.push("progress-"+r+"%"),i.push("progress-"+Math.round(e)),this.quartiles)this.isQuartileReached(n,this.quartiles[n],e)&&(i.push(n),this._alreadyTriggeredQuartiles[n]=!0)}i.forEach(function(e){t.track(e,!0)}),e<this.progress&&this.track("rewind")}this.progress=e}},{key:"isQuartileReached",value:function(e,t,r){var i=!1;return i=t<=r&&!this._alreadyTriggeredQuartiles[e]?!0:i}},{key:"setMuted",value:function(e){this.muted!==e&&this.track(e?"mute":"unmute"),this.muted=e}},{key:"setPaused",value:function(e){this.paused!==e&&this.track(e?"pause":"resume"),this.paused=e}},{key:"setFullscreen",value:function(e){this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen"),this.fullscreen=e}},{key:"setExpand",value:function(e){this.expanded!==e&&this.track(e?"expand":"collapse"),this.expanded=e}},{key:"setSkipDelay",value:function(e){"number"==typeof e&&(this.skipDelay=e)}},{key:"trackImpression",value:function(){this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView"))}},{key:"errorWithCode",value:function(e){this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:e},{isCustomCode:1<arguments.length&&void 0!==arguments[1]&&arguments[1]})}},{key:"complete",value:function(){this.track("complete")}},{key:"close",value:function(){this.track(this.linear?"closeLinear":"close")}},{key:"skip",value:function(){this.track("skip")}},{key:"click",value:function(){var r,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=(this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates),this.clickThroughURLTemplate||e);e&&(r=this.linear?{CONTENTPLAYHEAD:this.progressFormatted()}:{},e=util.resolveURLTemplates([e],r)[0],this.emit("clickthrough",e))}},{key:"track",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=("closeLinear"===e&&!this.trackingEvents[e]&&this.trackingEvents.close&&(e="close"),this.trackingEvents[e]),i=-1<this.emitAlwaysEvents.indexOf(e);r?(this.emit(e,""),this.trackURLs(r)):i&&this.emit(e,""),t&&(delete this.trackingEvents[e],i)&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(e),1)}},{key:"trackURLs",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(t.ASSETURI=this.creative.mediaFiles[0].fileURL),t.CONTENTPLAYHEAD=this.progressFormatted()),util.track(e,t,r)}},{key:"progressFormatted",value:function(){var e=parseInt(this.progress),t=e/3600,r=e/60%60,i=e%60;return(t=t.length<2?"0"+t:t)+":"+(r=r.length<2?"0"+r:r)+":"+(i=i.length<2?"0"+r:i)+"."+parseInt(100*(this.progress-e))}}]),t}(events.EventEmitter);exports.VASTClient=require,exports.VASTParser=VASTParser,exports.VASTTracker=events},{events:7,fs:3,http:17,https:9,url:37,xmldom:41}],41:[function(require,module,exports){function DOMParser(options){this.options=options||{locator:{}}}function DOMHandler(){this.cdata=!1}function position(locator,node){node.lineNumber=locator.lineNumber,node.columnNumber=locator.columnNumber}function _locator(l){if(l)return"\n@"+(l.systemId||"")+"#[line:"+l.lineNumber+",col:"+l.columnNumber+"]"}function _toString(chars,start,length){return"string"==typeof chars?chars.substr(start,length):chars.length>=start+length||start?new java.lang.String(chars,start,length)+"":chars}function appendElement(hander,node){(hander.currentElement||hander.doc).appendChild(node)}DOMParser.prototype.parseFromString=function(source,mimeType){var options=this.options,sax=new XMLReader,domBuilder=options.domBuilder||new DOMHandler,errorHandler=options.errorHandler,locator=options.locator,defaultNSMap=options.xmlns||{},entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return locator&&domBuilder.setDocumentLocator(locator),sax.errorHandler=function(errorImpl,domBuilder,locator){if(!errorImpl){if(domBuilder instanceof DOMHandler)return domBuilder;errorImpl=domBuilder}var errorHandler={},isCallback=errorImpl instanceof Function;function build(key){var fn=errorImpl[key];!fn&&isCallback&&(fn=2==errorImpl.length?function(msg){errorImpl(key,msg)}:errorImpl),errorHandler[key]=fn?function(msg){fn("[xmldom "+key+"]\t"+msg+_locator(locator))}:function(){}}return locator=locator||{},build("warning"),build("error"),build("fatalError"),errorHandler}(errorHandler,domBuilder,locator),sax.domBuilder=options.domBuilder||domBuilder,/\/x?html?$/.test(mimeType)&&(entityMap.nbsp=" ",entityMap.copy="©",defaultNSMap[""]="http://www.w3.org/1999/xhtml"),defaultNSMap.xml=defaultNSMap.xml||"http://www.w3.org/XML/1998/namespace",source?sax.parse(source,defaultNSMap,entityMap):sax.errorHandler.error("invalid doc source"),domBuilder.doc},DOMHandler.prototype={startDocument:function(){this.doc=(new DOMImplementation).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(namespaceURI,localName,qName,attrs){var doc=this.doc,el=doc.createElementNS(namespaceURI,qName||localName),len=attrs.length;appendElement(this,el),this.currentElement=el,this.locator&&position(this.locator,el);for(var i=0;i<len;i++){var namespaceURI=attrs.getURI(i),value=attrs.getValue(i),qName=attrs.getQName(i),attr=doc.createAttributeNS(namespaceURI,qName);this.locator&&position(attrs.getLocator(i),attr),attr.value=attr.nodeValue=value,el.setAttributeNode(attr)}},endElement:function(namespaceURI,localName,qName){var current=this.currentElement;current.tagName;this.currentElement=current.parentNode},startPrefixMapping:function(prefix,uri){},endPrefixMapping:function(prefix){},processingInstruction:function(target,data){target=this.doc.createProcessingInstruction(target,data);this.locator&&position(this.locator,target),appendElement(this,target)},ignorableWhitespace:function(ch,start,length){},characters:function(chars,start,length){var charNode;(chars=_toString.apply(this,arguments))&&(charNode=this.cdata?this.doc.createCDATASection(chars):this.doc.createTextNode(chars),this.currentElement?this.currentElement.appendChild(charNode):/^\s*$/.test(chars)&&this.doc.appendChild(charNode),this.locator)&&position(this.locator,charNode)},skippedEntity:function(name){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(locator){(this.locator=locator)&&(locator.lineNumber=0)},comment:function(chars,start,length){chars=_toString.apply(this,arguments);var comm=this.doc.createComment(chars);this.locator&&position(this.locator,comm),appendElement(this,comm)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(name,publicId,systemId){var impl=this.doc.implementation;impl&&impl.createDocumentType&&(impl=impl.createDocumentType(name,publicId,systemId),this.locator&&position(this.locator,impl),appendElement(this,impl))},warning:function(error){console.warn("[xmldom warning]\t"+error,_locator(this.locator))},error:function(error){console.error("[xmldom error]\t"+error,_locator(this.locator))},fatalError:function(error){throw console.error("[xmldom fatalError]\t"+error,_locator(this.locator)),error}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){DOMHandler.prototype[key]=function(){return null}});var XMLReader=require("./sax").XMLReader,DOMImplementation=exports.DOMImplementation=require("./dom").DOMImplementation;exports.XMLSerializer=require("./dom").XMLSerializer,exports.DOMParser=DOMParser},{"./dom":42,"./sax":43}],42:[function(require,module,exports){function copy(src,dest){for(var p in src)dest[p]=src[p]}function _extends(Class,Super){var ppt,pt=Class.prototype;function t(){}Object.create&&(ppt=Object.create(Super.prototype),pt.__proto__=ppt),pt instanceof Super||(t.prototype=Super.prototype,copy(pt,t=new t),Class.prototype=pt=t),pt.constructor!=Class&&("function"!=typeof Class&&console.error("unknow Class:"+Class),pt.constructor=Class)}var NodeType={},ExceptionCode=(NodeType.ELEMENT_NODE=1,NodeType.ATTRIBUTE_NODE=2,NodeType.TEXT_NODE=3,NodeType.CDATA_SECTION_NODE=4,NodeType.ENTITY_REFERENCE_NODE=5,NodeType.ENTITY_NODE=6,NodeType.PROCESSING_INSTRUCTION_NODE=7,NodeType.COMMENT_NODE=8,NodeType.DOCUMENT_NODE=9,NodeType.DOCUMENT_TYPE_NODE=10,NodeType.DOCUMENT_FRAGMENT_NODE=11,NodeType.NOTATION_NODE=12,{}),ExceptionMessage={};ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2),ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3),ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7),ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8),ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9),ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10),ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(code,message){var error;return message instanceof Error?error=message:(error=this,Error.call(this,ExceptionMessage[code]),this.message=ExceptionMessage[code],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException)),error.code=code,message&&(this.message=this.message+": "+message),error}function NodeList(){}function LiveNodeList(node,refresh){this._node=node,this._refresh=refresh,_updateLiveList(this)}function _updateLiveList(list){var ls,inc=list._node._inc||list._node.ownerDocument._inc;list._inc!=inc&&(ls=list._refresh(list._node),__set__(list,"length",ls.length),copy(ls,list),list._inc=inc)}function NamedNodeMap(){}function _findNodeIndex(list,node){for(var i=list.length;i--;)if(list[i]===node)return i}function _addNamedNode(el,list,newAttr,oldAttr){oldAttr?list[_findNodeIndex(list,oldAttr)]=newAttr:list[list.length++]=newAttr,el&&(list=(newAttr.ownerElement=el).ownerDocument)&&(oldAttr&&_onRemoveAttribute(list,el,oldAttr),function(doc,el,newAttr){doc&&doc._inc++,"http://www.w3.org/2000/xmlns/"==newAttr.namespaceURI&&(el._nsMap[newAttr.prefix?newAttr.localName:""]=newAttr.value)}(list,el,newAttr))}function _removeNamedNode(el,list,attr){var i=_findNodeIndex(list,attr);if(!(0<=i))throw DOMException(8,new Error(el.tagName+"@"+attr));for(var doc,lastIndex=list.length-1;i<lastIndex;)list[i]=list[++i];list.length=lastIndex,el&&(doc=el.ownerDocument)&&(_onRemoveAttribute(doc,el,attr),attr.ownerElement=null)}function DOMImplementation(features){if(this._features={},features)for(var feature in features)this._features=features[feature]}function Node(){}function _xmlEncoder(c){return("<"==c?"&lt;":">"==c&&"&gt;")||("&"==c?"&amp;":'"'==c&&"&quot;")||"&#"+c.charCodeAt()+";"}function _visitNode(node,callback){if(callback(node))return 1;if(node=node.firstChild)do{if(_visitNode(node,callback))return 1}while(node=node.nextSibling)}function Document(){}function _onRemoveAttribute(doc,el,newAttr){doc&&doc._inc++,"http://www.w3.org/2000/xmlns/"==newAttr.namespaceURI&&delete el._nsMap[newAttr.prefix?newAttr.localName:""]}function _onUpdateChild(doc,el,newChild){if(doc&&doc._inc){doc._inc++;var cs=el.childNodes;if(newChild)cs[cs.length++]=newChild;else{for(var child=el.firstChild,i=0;child;)child=(cs[i++]=child).nextSibling;cs.length=i}}}function _removeChild(parentNode,child){var previous=child.previousSibling,next=child.nextSibling;return previous?previous.nextSibling=next:parentNode.firstChild=next,next?next.previousSibling=previous:parentNode.lastChild=previous,_onUpdateChild(parentNode.ownerDocument,parentNode),child}function _insertBefore(parentNode,newChild,nextChild){var cp=newChild.parentNode;if(cp&&cp.removeChild(newChild),11===newChild.nodeType){var newFirst=newChild.firstChild;if(null==newFirst)return newChild;var newLast=newChild.lastChild}else newFirst=newLast=newChild;cp=nextChild?nextChild.previousSibling:parentNode.lastChild;for(newFirst.previousSibling=cp,newLast.nextSibling=nextChild,cp?cp.nextSibling=newFirst:parentNode.firstChild=newFirst,null==nextChild?parentNode.lastChild=newLast:nextChild.previousSibling=newLast;newFirst.parentNode=parentNode,newFirst!==newLast&&(newFirst=newFirst.nextSibling););return _onUpdateChild(parentNode.ownerDocument||parentNode,parentNode),11==newChild.nodeType&&(newChild.firstChild=newChild.lastChild=null),newChild}function Element(){this._nsMap={}}function Attr(){}function CharacterData(){}function Text(){}function Comment(){}function CDATASection(){}function DocumentType(){}function Notation(){}function Entity(){}function EntityReference(){}function DocumentFragment(){}function ProcessingInstruction(){}function XMLSerializer(){}function nodeSerializeToString(isHtml,nodeFilter){var visibleNamespaces,buf=[],refNode=9==this.nodeType?this.documentElement:this,prefix=refNode.prefix,uri=refNode.namespaceURI;return serializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces=uri&&null==prefix&&null==refNode.lookupPrefix(uri)?[{namespace:uri,prefix:null}]:visibleNamespaces),buf.join("")}function needNamespaceDefine(node,isHTML,visibleNamespaces){var prefix=node.prefix||"",uri=node.namespaceURI;if((prefix||uri)&&("xml"!==prefix||"http://www.w3.org/XML/1998/namespace"!==uri)&&"http://www.w3.org/2000/xmlns/"!=uri){for(var i=visibleNamespaces.length;i--;){var ns=visibleNamespaces[i];if(ns.prefix==prefix)return ns.namespace!=uri}return 1}}function serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){if(nodeFilter){if(!(node=nodeFilter(node)))return;if("string"==typeof node)return void buf.push(node)}switch(node.nodeType){case 1:visibleNamespaces=visibleNamespaces||[];var attrs=node.attributes,len=attrs.length,child=node.firstChild,nodeName=node.tagName;isHTML="http://www.w3.org/1999/xhtml"===node.namespaceURI||isHTML,buf.push("<",nodeName);for(var i=0;i<len;i++)"xmlns"==(attr=attrs.item(i)).prefix?visibleNamespaces.push({prefix:attr.localName,namespace:attr.value}):"xmlns"==attr.nodeName&&visibleNamespaces.push({prefix:"",namespace:attr.value});for(var attr,prefix,uri,i=0;i<len;i++)needNamespaceDefine(attr=attrs.item(i),0,visibleNamespaces)&&(prefix=attr.prefix||"",uri=attr.namespaceURI,buf.push(prefix?" xmlns:"+prefix:" xmlns",'="',uri,'"'),visibleNamespaces.push({prefix:prefix,namespace:uri})),serializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);if(needNamespaceDefine(node,0,visibleNamespaces)&&(prefix=node.prefix||"",uri=node.namespaceURI,buf.push(prefix?" xmlns:"+prefix:" xmlns",'="',uri,'"'),visibleNamespaces.push({prefix:prefix,namespace:uri})),child||isHTML&&!/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){if(buf.push(">"),isHTML&&/^script$/i.test(nodeName))for(;child;)child.data?buf.push(child.data):serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces),child=child.nextSibling;else for(;child;)serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces),child=child.nextSibling;buf.push("</",nodeName,">")}else buf.push("/>");return;case 9:case 11:for(child=node.firstChild;child;)serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces),child=child.nextSibling;return;case 2:return buf.push(" ",node.name,'="',node.value.replace(/[<&"]/g,_xmlEncoder),'"');case 3:return buf.push(node.data.replace(/[<&]/g,_xmlEncoder));case 4:return buf.push("<![CDATA[",node.data,"]]>");case 8:return buf.push("\x3c!--",node.data,"--\x3e");case 10:var nodeName=node.publicId,sysid=node.systemId;return buf.push("<!DOCTYPE ",node.name),void(nodeName?(buf.push(' PUBLIC "',nodeName),sysid&&"."!=sysid&&buf.push('" "',sysid),buf.push('">')):sysid&&"."!=sysid?buf.push(' SYSTEM "',sysid,'">'):((nodeName=node.internalSubset)&&buf.push(" [",nodeName,"]"),buf.push(">")));case 7:return buf.push("<?",node.target," ",node.data,"?>");case 5:return buf.push("&",node.nodeName,";");default:buf.push("??",node.nodeName)}}function __set__(object,key,value){object[key]=value}DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException),NodeList.prototype={length:0,item:function(index){return this[index]||null},toString:function(isHTML,nodeFilter){for(var buf=[],i=0;i<this.length;i++)serializeToString(this[i],buf,isHTML,nodeFilter);return buf.join("")}},LiveNodeList.prototype.item=function(i){return _updateLiveList(this),this[i]},_extends(LiveNodeList,NodeList),NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(key){for(var i=this.length;i--;){var attr=this[i];if(attr.nodeName==key)return attr}},setNamedItem:function(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement)throw new DOMException(10);el=this.getNamedItem(attr.nodeName);return _addNamedNode(this._ownerElement,this,attr,el),el},setNamedItemNS:function(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement)throw new DOMException(10);return el=this.getNamedItemNS(attr.namespaceURI,attr.localName),_addNamedNode(this._ownerElement,this,attr,el),el},removeNamedItem:function(key){key=this.getNamedItem(key);return _removeNamedNode(this._ownerElement,this,key),key},removeNamedItemNS:function(namespaceURI,localName){namespaceURI=this.getNamedItemNS(namespaceURI,localName);return _removeNamedNode(this._ownerElement,this,namespaceURI),namespaceURI},getNamedItemNS:function(namespaceURI,localName){for(var i=this.length;i--;){var node=this[i];if(node.localName==localName&&node.namespaceURI==namespaceURI)return node}return null}},DOMImplementation.prototype={hasFeature:function(feature,version){feature=this._features[feature.toLowerCase()];return!(!feature||version&&!(version in feature))},createDocument:function(namespaceURI,qualifiedName,doctype){var doc=new Document;return doc.implementation=this,doc.childNodes=new NodeList,(doc.doctype=doctype)&&doc.appendChild(doctype),qualifiedName&&(doctype=doc.createElementNS(namespaceURI,qualifiedName),doc.appendChild(doctype)),doc},createDocumentType:function(qualifiedName,publicId,systemId){var node=new DocumentType;return node.name=qualifiedName,node.nodeName=qualifiedName,node.publicId=publicId,node.systemId=systemId,node}},Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(newChild,refChild){return _insertBefore(this,newChild,refChild)},replaceChild:function(newChild,oldChild){this.insertBefore(newChild,oldChild),oldChild&&this.removeChild(oldChild)},removeChild:function(oldChild){return _removeChild(this,oldChild)},appendChild:function(newChild){return this.insertBefore(newChild,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(deep){return function cloneNode(doc,node,deep){var node2=new node.constructor;for(var n in node){var v=node[n];"object"!=typeof v&&v!=node2[n]&&(node2[n]=v)}node.childNodes&&(node2.childNodes=new NodeList);node2.ownerDocument=doc;switch(node2.nodeType){case 1:var attrs=node.attributes,attrs2=node2.attributes=new NamedNodeMap,len=attrs.length;attrs2._ownerElement=node2;for(var i=0;i<len;i++)node2.setAttributeNode(cloneNode(doc,attrs.item(i),!0));break;case 2:deep=!0}if(deep)for(var child=node.firstChild;child;)node2.appendChild(cloneNode(doc,child,deep)),child=child.nextSibling;return node2}(this.ownerDocument||this,this,deep)},normalize:function(){for(var child=this.firstChild;child;){var next=child.nextSibling;next&&3==next.nodeType&&3==child.nodeType?(this.removeChild(next),child.appendData(next.data)):(child.normalize(),child=next)}},isSupported:function(feature,version){return this.ownerDocument.implementation.hasFeature(feature,version)},hasAttributes:function(){return 0<this.attributes.length},lookupPrefix:function(namespaceURI){for(var el=this;el;){var map=el._nsMap;if(map)for(var n in map)if(map[n]==namespaceURI)return n;el=2==el.nodeType?el.ownerDocument:el.parentNode}return null},lookupNamespaceURI:function(prefix){for(var el=this;el;){var map=el._nsMap;if(map&&prefix in map)return map[prefix];el=2==el.nodeType?el.ownerDocument:el.parentNode}return null},isDefaultNamespace:function(namespaceURI){return null==this.lookupPrefix(namespaceURI)}},copy(NodeType,Node),copy(NodeType,Node.prototype),Document.prototype={nodeName:"#document",nodeType:9,doctype:null,documentElement:null,_inc:1,insertBefore:function(newChild,refChild){if(11==newChild.nodeType)for(var child=newChild.firstChild;child;){var next=child.nextSibling;this.insertBefore(child,refChild),child=next}else null==this.documentElement&&1==newChild.nodeType&&(this.documentElement=newChild),_insertBefore(this,newChild,refChild),newChild.ownerDocument=this;return newChild},removeChild:function(oldChild){return this.documentElement==oldChild&&(this.documentElement=null),_removeChild(this,oldChild)},importNode:function(importedNode,deep){return function importNode(doc,node,deep){var node2;switch(node.nodeType){case 1:(node2=node.cloneNode(!1)).ownerDocument=doc;case 11:break;case 2:deep=!0}node2=node2||node.cloneNode(!1);node2.ownerDocument=doc;node2.parentNode=null;if(deep)for(var child=node.firstChild;child;)node2.appendChild(importNode(doc,child,deep)),child=child.nextSibling;return node2}(this,importedNode,deep)},getElementById:function(id){var rtv=null;return _visitNode(this.documentElement,function(node){if(1==node.nodeType&&node.getAttribute("id")==id)return rtv=node,!0}),rtv},createElement:function(tagName){var node=new Element;return node.ownerDocument=this,node.nodeName=tagName,node.tagName=tagName,node.childNodes=new NodeList,(node.attributes=new NamedNodeMap)._ownerElement=node},createDocumentFragment:function(){var node=new DocumentFragment;return node.ownerDocument=this,node.childNodes=new NodeList,node},createTextNode:function(data){var node=new Text;return node.ownerDocument=this,node.appendData(data),node},createComment:function(data){var node=new Comment;return node.ownerDocument=this,node.appendData(data),node},createCDATASection:function(data){var node=new CDATASection;return node.ownerDocument=this,node.appendData(data),node},createProcessingInstruction:function(target,data){var node=new ProcessingInstruction;return node.ownerDocument=this,node.tagName=node.target=target,node.nodeValue=node.data=data,node},createAttribute:function(name){var node=new Attr;return node.ownerDocument=this,node.name=name,node.nodeName=name,node.localName=name,node.specified=!0,node},createEntityReference:function(name){var node=new EntityReference;return node.ownerDocument=this,node.nodeName=name,node},createElementNS:function(namespaceURI,qualifiedName){var node=new Element,pl=qualifiedName.split(":"),attrs=node.attributes=new NamedNodeMap;return node.childNodes=new NodeList,node.ownerDocument=this,node.nodeName=qualifiedName,node.tagName=qualifiedName,node.namespaceURI=namespaceURI,2==pl.length?(node.prefix=pl[0],node.localName=pl[1]):node.localName=qualifiedName,attrs._ownerElement=node},createAttributeNS:function(namespaceURI,qualifiedName){var node=new Attr,pl=qualifiedName.split(":");return node.ownerDocument=this,node.nodeName=qualifiedName,node.name=qualifiedName,node.namespaceURI=namespaceURI,node.specified=!0,2==pl.length?(node.prefix=pl[0],node.localName=pl[1]):node.localName=qualifiedName,node}},_extends(Document,Node),Document.prototype.getElementsByTagName=(Element.prototype={nodeType:1,hasAttribute:function(name){return null!=this.getAttributeNode(name)},getAttribute:function(name){name=this.getAttributeNode(name);return name&&name.value||""},getAttributeNode:function(name){return this.attributes.getNamedItem(name)},setAttribute:function(name,value){name=this.ownerDocument.createAttribute(name);name.value=name.nodeValue=""+value,this.setAttributeNode(name)},removeAttribute:function(name){name=this.getAttributeNode(name);name&&this.removeAttributeNode(name)},appendChild:function(newChild){return 11===newChild.nodeType?this.insertBefore(newChild,null):function(parentNode,newChild){var cp=newChild.parentNode,pre=(cp&&(pre=parentNode.lastChild,cp.removeChild(newChild),pre=parentNode.lastChild),parentNode.lastChild);return newChild.parentNode=parentNode,newChild.previousSibling=pre,newChild.nextSibling=null,pre?pre.nextSibling=newChild:parentNode.firstChild=newChild,parentNode.lastChild=newChild,_onUpdateChild(parentNode.ownerDocument,parentNode,newChild),newChild}(this,newChild)},setAttributeNode:function(newAttr){return this.attributes.setNamedItem(newAttr)},setAttributeNodeNS:function(newAttr){return this.attributes.setNamedItemNS(newAttr)},removeAttributeNode:function(oldAttr){return this.attributes.removeNamedItem(oldAttr.nodeName)},removeAttributeNS:function(namespaceURI,localName){namespaceURI=this.getAttributeNodeNS(namespaceURI,localName);namespaceURI&&this.removeAttributeNode(namespaceURI)},hasAttributeNS:function(namespaceURI,localName){return null!=this.getAttributeNodeNS(namespaceURI,localName)},getAttributeNS:function(namespaceURI,localName){namespaceURI=this.getAttributeNodeNS(namespaceURI,localName);return namespaceURI&&namespaceURI.value||""},setAttributeNS:function(namespaceURI,qualifiedName,value){namespaceURI=this.ownerDocument.createAttributeNS(namespaceURI,qualifiedName);namespaceURI.value=namespaceURI.nodeValue=""+value,this.setAttributeNode(namespaceURI)},getAttributeNodeNS:function(namespaceURI,localName){return this.attributes.getNamedItemNS(namespaceURI,localName)},getElementsByTagName:function(tagName){return new LiveNodeList(this,function(base){var ls=[];return _visitNode(base,function(node){node===base||1!=node.nodeType||"*"!==tagName&&node.tagName!=tagName||ls.push(node)}),ls})},getElementsByTagNameNS:function(namespaceURI,localName){return new LiveNodeList(this,function(base){var ls=[];return _visitNode(base,function(node){node===base||1!==node.nodeType||"*"!==namespaceURI&&node.namespaceURI!==namespaceURI||"*"!==localName&&node.localName!=localName||ls.push(node)}),ls})}}).getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node),Attr.prototype.nodeType=2,_extends(Attr,Node),CharacterData.prototype={data:"",substringData:function(offset,count){return this.data.substring(offset,offset+count)},appendData:function(text){text=this.data+text,this.nodeValue=this.data=text,this.length=text.length},insertData:function(offset,text){this.replaceData(offset,0,text)},appendChild:function(newChild){throw new Error(ExceptionMessage[3])},deleteData:function(offset,count){this.replaceData(offset,count,"")},replaceData:function(offset,count,text){var start=this.data.substring(0,offset),offset=this.data.substring(offset+count);this.nodeValue=this.data=text=start+text+offset,this.length=text.length}},_extends(CharacterData,Node),Text.prototype={nodeName:"#text",nodeType:3,splitText:function(offset){var newText=(text=this.data).substring(offset),text=text.substring(0,offset),offset=(this.data=this.nodeValue=text,this.length=text.length,this.ownerDocument.createTextNode(newText));return this.parentNode&&this.parentNode.insertBefore(offset,this.nextSibling),offset}},_extends(Text,CharacterData),Comment.prototype={nodeName:"#comment",nodeType:8},_extends(Comment,CharacterData),CDATASection.prototype={nodeName:"#cdata-section",nodeType:4},_extends(CDATASection,CharacterData),DocumentType.prototype.nodeType=10,_extends(DocumentType,Node),Notation.prototype.nodeType=12,_extends(Notation,Node),Entity.prototype.nodeType=6,_extends(Entity,Node),EntityReference.prototype.nodeType=5,_extends(EntityReference,Node),DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=11,_extends(DocumentFragment,Node),ProcessingInstruction.prototype.nodeType=7,_extends(ProcessingInstruction,Node),XMLSerializer.prototype.serializeToString=function(node,isHtml,nodeFilter){return nodeSerializeToString.call(node,isHtml,nodeFilter)},Node.prototype.toString=nodeSerializeToString;try{Object.defineProperty&&(Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return function getTextContent(node){switch(node.nodeType){case 1:case 11:var buf=[];for(node=node.firstChild;node;)7!==node.nodeType&&8!==node.nodeType&&buf.push(getTextContent(node)),node=node.nextSibling;return buf.join("");default:return node.nodeValue}}(this)},set:function(data){switch(this.nodeType){case 1:case 11:for(;this.firstChild;)this.removeChild(this.firstChild);(data||String(data))&&this.appendChild(this.ownerDocument.createTextNode(data));break;default:this.data=data,this.value=data,this.nodeValue=data}}}),__set__=function(object,key,value){object["$$"+key]=value})}catch(e){}exports.DOMImplementation=DOMImplementation,exports.XMLSerializer=XMLSerializer},{}],43:[function(require,module,exports){var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function XMLReader(){}function copyLocator(f,t){return t.lineNumber=f.lineNumber,t.columnNumber=f.columnNumber,t}function appendElement(el,domBuilder,currentNSMap){for(var tagName=el.tagName,localNSMap=null,i=el.length;i--;){var a=el[i],qName=a.qName,value=a.value,qName=0<(nsp=qName.indexOf(":"))?(prefix=a.prefix=qName.slice(0,nsp),localName=qName.slice(nsp+1),"xmlns"===prefix&&localName):(prefix=null,"xmlns"===(localName=qName)&&"");a.localName=localName,!1!==qName&&(null==localNSMap&&(localNSMap={},_copy(currentNSMap,currentNSMap={})),currentNSMap[qName]=localNSMap[qName]=value,a.uri="http://www.w3.org/2000/xmlns/",domBuilder.startPrefixMapping(qName,value))}for(var prefix,i=el.length;i--;)(prefix=(a=el[i]).prefix)&&("xml"===prefix&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==prefix)&&(a.uri=currentNSMap[prefix||""]);var nsp,localName=0<(nsp=tagName.indexOf(":"))?(prefix=el.prefix=tagName.slice(0,nsp),el.localName=tagName.slice(nsp+1)):(prefix=null,el.localName=tagName),ns=el.uri=currentNSMap[prefix||""];if(domBuilder.startElement(ns,localName,tagName,el),!el.closed)return el.currentNSMap=currentNSMap,el.localNSMap=localNSMap,1;if(domBuilder.endElement(ns,localName,tagName),localNSMap)for(prefix in localNSMap)domBuilder.endPrefixMapping(prefix)}function _copy(source,target){for(var n in source)target[n]=source[n]}function ElementAttributes(source){}function _set_proto_(thiz,parent){return thiz.__proto__=parent,thiz}XMLReader.prototype={parse:function(source,defaultNSMap,entityMap){var domBuilder=this.domBuilder;domBuilder.startDocument(),_copy(defaultNSMap,defaultNSMap={}),function(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){function entityReplacer(a){var k=a.slice(1,-1);return k in entityMap?entityMap[k]:"#"===k.charAt(0)?65535<(k=parseInt(k.substr(1).replace("x","0x")))?(k-=65536,String.fromCharCode(55296+(k>>10),56320+(1023&k))):String.fromCharCode(k):(errorHandler.error("entity not found:"+a),a)}function appendText(end){var xt;start<end&&(xt=source.substring(start,end).replace(/&#?\w+;/g,entityReplacer),locator&&position(start),domBuilder.characters(xt,0,end-start),start=end)}function position(p,m){for(;lineEnd<=p&&(m=linePattern.exec(source));)lineStart=m.index,lineEnd=lineStart+m[0].length,locator.lineNumber++;locator.columnNumber=p-lineStart+1}var lineStart=0,lineEnd=0,linePattern=/.*(?:\r\n?|\n)|.*$/g,locator=domBuilder.locator,parseStack=[{currentNSMap:defaultNSMapCopy}],closeMap={},start=0;for(;;){try{var doc,text,tagStart=source.indexOf("<",start);if(tagStart<0)return source.substr(start).match(/^\s*$/)||(doc=domBuilder.doc,text=doc.createTextNode(source.substr(start)),doc.appendChild(text),domBuilder.currentElement=text);switch(start<tagStart&&appendText(tagStart),source.charAt(tagStart+1)){case"/":var end=source.indexOf(">",tagStart+3),tagName=source.substring(tagStart+2,end),config=parseStack.pop(),localNSMap=(end<0?(tagName=source.substring(tagStart+2).replace(/[\s<].*/,""),errorHandler.error("end tag name: "+tagName+" is not complete:"+config.tagName),end=tagStart+1+tagName.length):tagName.match(/\s</)&&(tagName=tagName.replace(/[\s<].*/,""),errorHandler.error("end tag name: "+tagName+" maybe not complete"),end=tagStart+1+tagName.length),config.localNSMap),endMatch=config.tagName==tagName;if(endMatch||config.tagName&&config.tagName.toLowerCase()==tagName.toLowerCase()){if(domBuilder.endElement(config.uri,config.localName,tagName),localNSMap)for(var prefix in localNSMap)domBuilder.endPrefixMapping(prefix);endMatch||errorHandler.fatalError("end tag name: "+tagName+" is not match the current start tagName:"+config.tagName)}else parseStack.push(config);end++;break;case"?":locator&&position(tagStart),end=function(source,start,domBuilder){var end=source.indexOf("?>",start);if(end){source=source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(source)return source[0].length,domBuilder.processingInstruction(source[1],source[2]),end+2}return-1}(source,tagStart,domBuilder);break;case"!":locator&&position(tagStart),end=function(source,start,domBuilder,errorHandler){{if("-"===source.charAt(start+2))return"-"===source.charAt(start+3)?(end=source.indexOf("--\x3e",start+4),start<end?(domBuilder.comment(source,start+4,end-start-4),end+3):(errorHandler.error("Unclosed comment"),-1)):-1;if("CDATA["==source.substr(start+3,6))return end=source.indexOf("]]>",start+9),domBuilder.startCDATA(),domBuilder.characters(source,start+9,end-start-9),domBuilder.endCDATA(),end+3;var sysid,errorHandler=function(source,start){var match,buf=[],reg=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;reg.lastIndex=start,reg.exec(source);for(;match=reg.exec(source);)if(buf.push(match),match[1])return buf}(source,start),end=errorHandler.length;if(1<end&&/!doctype/i.test(errorHandler[0][0]))return source=errorHandler[1][0],start=3<end&&/^public$/i.test(errorHandler[2][0])&&errorHandler[3][0],sysid=4<end&&errorHandler[4][0],errorHandler=errorHandler[end-1],domBuilder.startDTD(source,start&&start.replace(/^(['"])(.*?)\1$/,"$2"),sysid&&sysid.replace(/^(['"])(.*?)\1$/,"$2")),domBuilder.endDTD(),errorHandler.index+errorHandler[0].length}return-1}(source,tagStart,domBuilder,errorHandler);break;default:locator&&position(tagStart);var el=new ElementAttributes,currentNSMap=parseStack[parseStack.length-1].currentNSMap,end=function(source,start,el,currentNSMap,entityReplacer,errorHandler){var attrName,p=++start,s=S_TAG;for(;;){var c=source.charAt(p);switch(c){case"=":if(s===S_ATTR)attrName=source.slice(start,p);else if(s!==S_ATTR_SPACE)throw new Error("attribute equal must after attrName");s=S_EQ;break;case"'":case'"':if(s===S_EQ||s===S_ATTR){if(s===S_ATTR&&(errorHandler.warning('attribute value must after "="'),attrName=source.slice(start,p)),start=p+1,!(0<(p=source.indexOf(c,start))))throw new Error("attribute value no end '"+c+"' match");value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer),el.add(attrName,value,start-1)}else{if(s!=S_ATTR_NOQUOT_VALUE)throw new Error('attribute value must after "="');value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer),el.add(attrName,value,start),errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+")!!"),start=p+1}s=S_ATTR_END;break;case"/":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:s=S_TAG_CLOSE,el.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return errorHandler.error("unexpected end of input"),s==S_TAG&&el.setTagName(source.slice(start,p)),p;case">":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:"/"===(value=source.slice(start,p)).slice(-1)&&(el.closed=!0,value=value.slice(0,-1));case S_ATTR_SPACE:s===S_ATTR_SPACE&&(value=attrName),s==S_ATTR_NOQUOT_VALUE?(errorHandler.warning('attribute "'+value+'" missed quot(")!!'),el.add(attrName,value.replace(/&#?\w+;/g,entityReplacer),start)):("http://www.w3.org/1999/xhtml"===currentNSMap[""]&&value.match(/^(?:disabled|checked|selected)$/i)||errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!'),el.add(value,value,start));break;case S_EQ:throw new Error("attribute value missed!!")}return p;case"":c=" ";default:if(c<=" ")switch(s){case S_TAG:el.setTagName(source.slice(start,p)),s=S_TAG_SPACE;break;case S_ATTR:attrName=source.slice(start,p),s=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);errorHandler.warning('attribute "'+value+'" missed quot(")!!'),el.add(attrName,value,start);case S_ATTR_END:s=S_TAG_SPACE}else switch(s){case S_ATTR_SPACE:el.tagName;"http://www.w3.org/1999/xhtml"===currentNSMap[""]&&attrName.match(/^(?:disabled|checked|selected)$/i)||errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead2!!'),el.add(attrName,attrName,start),start=p,s=S_ATTR;break;case S_ATTR_END:errorHandler.warning('attribute space is required"'+attrName+'"!!');case S_TAG_SPACE:s=S_ATTR,start=p;break;case S_EQ:s=S_ATTR_NOQUOT_VALUE,start=p;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}p++}}(source,tagStart,el,currentNSMap,entityReplacer,errorHandler),len=el.length;if(!el.closed&&function(source,elStartEnd,tagName,closeMap){var pos=closeMap[tagName];null==pos&&((pos=source.lastIndexOf("</"+tagName+">"))<elStartEnd&&(pos=source.lastIndexOf("</"+tagName)),closeMap[tagName]=pos);return pos<elStartEnd}(source,end,el.tagName,closeMap)&&(el.closed=!0,entityMap.nbsp||errorHandler.warning("unclosed xml attribute")),locator&&len){for(var locator2=copyLocator(locator,{}),i=0;i<len;i++){var a=el[i];position(a.offset),a.locator=copyLocator(locator,{})}domBuilder.locator=locator2,appendElement(el,domBuilder,currentNSMap)&&parseStack.push(el),domBuilder.locator=locator}else appendElement(el,domBuilder,currentNSMap)&&parseStack.push(el);"http://www.w3.org/1999/xhtml"!==el.uri||el.closed?end++:end=function(source,elStartEnd,tagName,entityReplacer,domBuilder){if(/^(?:script|textarea)$/i.test(tagName)){var elEndStart=source.indexOf("</"+tagName+">",elStartEnd),source=source.substring(elStartEnd+1,elEndStart);if(/[&<]/.test(source))return/^script$/i.test(tagName)?domBuilder.characters(source,0,source.length):(source=source.replace(/&#?\w+;/g,entityReplacer),domBuilder.characters(source,0,source.length)),elEndStart}return elStartEnd+1}(source,end,el.tagName,entityReplacer,domBuilder)}}catch(e){errorHandler.error("element parse error: "+e),end=-1}start<end?start=end:appendText(Math.max(tagStart,start)+1)}}(source,defaultNSMap,entityMap,domBuilder,this.errorHandler),domBuilder.endDocument()}},ElementAttributes.prototype={setTagName:function(tagName){if(!tagNamePattern.test(tagName))throw new Error("invalid tagName:"+tagName);this.tagName=tagName},add:function(qName,value,offset){if(!tagNamePattern.test(qName))throw new Error("invalid attribute:"+qName);this[this.length++]={qName:qName,value:value,offset:offset}},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}},_set_proto_({},_set_proto_.prototype),exports.XMLReader=XMLReader},{}],44:[function(require,module,exports){module.exports=function(){for(var target={},i=0;i<arguments.length;i++){var key,source=arguments[i];for(key in source)hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var hasOwnProperty=Object.prototype.hasOwnProperty},{}],45:[function(require,module,exports){!function(global){!function(){playList=global.playList=require("global");var __browserify_shim_require__=require;!function(module,exports,require,define,browserify_shim__define__module__export__){var urlDebugParameter;try{urlDebugParameter=window.location.search&&window.location.search.match(/[?&]amp_dev=1/)}catch(e){}var videojs,player;var plExport={playListEnabled:!0,installPlayList:function(playListToUse,videojsToUse,playerToUse,playerStorage,options,topElement,e){videojs=videojsToUse||playerStorage.videojs,player=playerToUse||playerStorage.player;var uiInstance,tryNumber,intervalChecker,playerElement=playerStorage.rootDocument.getElementById(playerToUse.id()),L=(playerElement.parentElement.classList.add("bc-iframe"),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,r=arguments[t];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}),o=videojsToUse=void 0!==e?e:"undefined"!=typeof a?a:"undefined"!=typeof self?self:{},playerToUse=o&&o.navigator||{},g={isArr:function(t){return Array.isArray(t)},isFn:function(t){return"function"==typeof t},isNil:function(t){return null==t},isNum:function(t){return"number"==typeof t&&t==t},isNonEmptyStr:function(t){return"string"==typeof t&&/\S/.test(t)},isObj:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},Z={perf:{},Promise:playerToUse,assign:function(){var t;return(t=Q).extends.apply(t,arguments)},withoutNilValues:function(t){var r=t;return g.isArr(t)?r=t.filter(function(e){return!g.isNil(e)}).map(Z.withoutNilValues):g.isObj(t)&&(r={},Object.keys(t).forEach(function(e){g.isNil(t[e])||(r[e]=Z.withoutNilValues(t[e]))})),r},debounce:function(t,r,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:o,a=void 0;return function(){var e=this,s=arguments,o=function(){o=a=null,i||t.apply(e,s)};!a&&i&&t.apply(e,s),n.clearTimeout(a),a=n.setTimeout(o,r)}},throttle:function(t,r){var i=Date.now();return function(){var e=Date.now();r<=e-i&&(t.apply(void 0,arguments),i=e)}},qs:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o&&o.location||{};return L({hash:v.parse((t.hash||"#").substr(1)),search:v.parse((t.search||"?").substr(1))},v)}};L(Z,g),videojs.bc_=Z,function(docu){videojs.getPlugin("bcPlaylistUi")||!function(e,t){"object"==typeof exports&&void 0!==module?module.exports=t(__browserify_shim_require__("video.js"),__browserify_shim_require__("@brightcove/loscore")):"function"==typeof r&&r.amd?r(["video.js","@brightcove/loscore"],t):e.videojsBcPlaylistUi=t(playerStorage.videojs,playerStorage.videojs.bc_)}(this,function(r,i){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r,i=i&&i.hasOwnProperty("default")?i.default:i;function m(e,t){for(var r=0;r<e.length;r++){var i=e[r].sources;if(Array.isArray(i))for(var n=0;n<i.length;n++){var a=i[n];if(a&&v(a,t))return r}}return-1}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function w(e){e.addClass("vjs-selected")}function E(e){e.removeClass("vjs-selected"),e.thumbnail&&T.removeClass(e.thumbnail,"vjs-playlist-now-playing")}function A(e){e.removeClass("vjs-up-next")}function L(e){if(!this.playlist)throw new Error("videojs-playlist plugin is required by the videojs-playlist-ui plugin");var t,i,n;T.isEl(e)&&(r.log.warn('videojs-playlist-ui: Passing an element directly to playlistUi() is deprecated, use the "el" option instead!'),e={el:e}),e=r.mergeOptions(k,e),this.playlistMenu&&(t=this.playlistMenu.el())&&(i=t.parentNode,n=t.nextSibling,this.playlistMenu.dispose(),T.emptyEl(t),n?i.insertBefore(t,n):i.appendChild(t),e.el=t),T.isEl(e.el)||(e.el=function(e){for(var t=topElement.querySelectorAll("."+e),r=void 0,i=0;i<t.length;i++)if(!x(t[i])){r=t[i];break}return r}(e.className)),this.playlistMenu=new P(this,e)}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function V(){var t,r,e=this;this.endscreenState_||(t=this.endscreenState_={},r=function(){return e.trigger("endscreen")},q(t),this.on("adstart",function(){var r=e.ended();t.postrollStarted=r,t.postrollFinished=!r}),this.on("adend",function(){t.postrollFinished=e.ended()}),this.on("adtimeout",function(){t.postrollTimedOut=e.ended()}),this.on(["endscreen","loadstart"],function(){e.off("adend",r),q(t)}),this.on("nopostroll",function(){t.sawNoPostrollEvent=!0}),this.on("ended",function(){!function(e){var r;if(F(e,"playlist"))return r=(e=e.playlist)(),0===e.autoadvance_.delay&&r.length&&(e.repeat()||e.currentItem()!==r.length-1)}(e)&&(function(e){if(F(e,"ads"))return!(e=e.endscreenState_).sawNoPostrollEvent&&e.postrollStarted&&!e.postrollFinished&&!e.postrollTimedOut}(e)?e.one("adend",r):r())}))}function W(e){return"string"==typeof e&&/\S/.test(e)}var a=void 0!==e?e:void 0!==global?global:"undefined"!=typeof self?self:{},s={},o=Object.freeze({default:s}),l=void 0!==a?a:void 0!==e?e:{},n=void 0!==docu?docu:(n=l["__GLOBAL_DOCUMENT_CACHE@4"])||(l["__GLOBAL_DOCUMENT_CACHE@4"]=o&&s),c=n,d=function(e){var t=e.playlist.autoadvance_;t.timeout&&e.clearTimeout(t.timeout),t.trigger&&e.off("ended",t.trigger),t.timeout=null,t.trigger=null},f=function e(t,r){d(t),function(e){return"number"==typeof e&&!isNaN(e)&&0<=e&&e<1/0}(r)?(t.playlist.autoadvance_.delay=r,t.playlist.autoadvance_.trigger=function(){function i(){return e(t,r)}t.one("play",i),t.playlist.autoadvance_.timeout=t.setTimeout(function(){d(t),t.off("play",i),t.playlist.next()},1e3*r)},t.one("ended",t.playlist.autoadvance_.trigger)):t.playlist.autoadvance_.delay=null},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v=function(e,t){var r=e,i=t;return"object"===(void 0===e?"undefined":p(e))&&(r=e.src),"object"===(void 0===t?"undefined":p(t))&&(i=t.src),/^\/\//.test(r)&&(i=i.slice(i.indexOf("//"))),(r=/^\/\//.test(i)?r.slice(r.indexOf("//")):r)===i},g=((r.registerPlugin||r.plugin)("playlist",function(e,t){!function(e,t,argument_2){var argument_2=2<arguments.length&&void 0!==argument_2?argument_2:0,n=null,a=!1,s=e.playlist=function(t){var i,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(a)throw new Error("do not call playlist() during a playlist change");return Array.isArray(t)&&(i=Array.isArray(n)?n.slice():null,n=t.slice(),a=!0,e.trigger({type:"duringplaylistchange",nextIndex:r,nextPlaylist:n,previousIndex:s.currentIndex_,previousPlaylist:i||[]}),a=!1,-1!==r&&s.currentItem(r),i)&&e.setTimeout(function(){e.trigger("playlistchange")},0),n.slice()};e.on("loadstart",function(){-1===s.currentItem()&&d(e)}),s.currentIndex_=-1,s.player_=e,s.autoadvance_={},s.repeat_=!1,s.currentItem=function(e){return a||("number"==typeof e&&s.currentIndex_!==e&&0<=e&&e<n.length?(s.currentIndex_=e,function(e,t){var r=!e.paused()||e.ended();e.trigger("beforeplaylistitem",t),e.poster(t.poster||""),e.src(t.sources),function(e){for(var t=e.remoteTextTracks(),r=t&&t.length||0;r--;)e.removeRemoteTextTrack(t[r])}(e),e.ready(function(){(t.textTracks||[]).forEach(e.addRemoteTextTrack.bind(e)),e.trigger("playlistitem",t),r&&e.play(),f(e,e.playlist.autoadvance_.delay)})}(s.player_,n[s.currentIndex_])):s.currentIndex_=s.indexOf(s.player_.currentSrc()||"")),s.currentIndex_},s.contains=function(e){return-1!==s.indexOf(e)},s.indexOf=function(e){if("string"==typeof e)return m(n,e);for(var t=Array.isArray(e)?e:e.sources,r=0;r<t.length;r++){var i=t[r];if("string"==typeof i)return m(n,i);if(i.src)return m(n,i.src)}return-1},s.currentIndex=function(){return s.currentItem()},s.lastIndex=function(){return n.length-1},s.nextIndex=function(){var t,e=s.currentItem();return-1===e?-1:(t=s.lastIndex(),s.repeat_&&e===t?0:Math.min(e+1,t))},s.previousIndex=function(){var e=s.currentItem();return-1===e?-1:s.repeat_&&0===e?s.lastIndex():Math.max(e-1,0)},s.first=function(){if(!a)return n.length?n[s.currentItem(0)]:void(s.currentIndex_=-1)},s.last=function(){if(!a)return n.length?n[s.currentItem(s.lastIndex())]:void(s.currentIndex_=-1)},s.next=function(){var e;return!a&&(e=s.nextIndex())!==s.currentIndex_?n[s.currentItem(e)]:void 0},s.previous=function(){var e;return!a&&(e=s.previousIndex())!==s.currentIndex_?n[s.currentItem(e)]:void 0},s.autoadvance=function(e){f(s.player_,e)},s.repeat=function(e){return void 0===e?s.repeat_:"boolean"==typeof e?(s.repeat_=!!e,s.repeat_):void r.log.error("videojs-playlist: Invalid value for repeat",e)},s.sort=function(t){n.length&&(n.sort(t),a||e.trigger("playlistsorted"))},s.reverse=function(){n.length&&(n.reverse(),a||e.trigger("playlistsorted"))},s.shuffle=function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).rest,r=0,i=n;t&&(r=s.currentIndex_+1,i=n.slice(r)),i.length<=1||(function(e){for(var t=-1,r=e.length-1;++t<e.length;){var i=t+Math.floor(Math.random()*(r-t+1)),n=e[i];e[i]=e[t],e[t]=n}}(i),t&&n.splice.apply(n,[r,i.length].concat(i)),a)||e.trigger("playlistsorted")},Array.isArray(t)?s(t.slice(),argument_2):n=[]}(this,e,t)}),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),b=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")},T=r.dom||r,l=r.registerPlugin||r.plugin,k={className:"vjs-playlist",playOnSelect:!1,supportsCssPointerEvents:function(){var e=c.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}()},o=r.getComponent("Component"),O=function(e){function t(r,i,n){if(g(this,t),i.item)return(r=b(this,e.call(this,r,i))).item=i.item,r.playOnSelect=n.playOnSelect,r.emitTapEvents(),r.on(["click","tap"],r.switchPlaylistItem_),r.on("keydown",r.handleKeyDown_),r;throw new Error("Cannot construct a PlaylistMenuItem without an item option")}return _(t,e),t.prototype.handleKeyDown_=function(e){13!==e.which&&32!==e.which||this.switchPlaylistItem_()},t.prototype.switchPlaylistItem_=function(e){this.player_.playlist.currentItem(function(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}(this.player_.playlist(),this.item)),this.playOnSelect&&this.player_.play()},t.prototype.createEl=function(){var e=c.createElement("li"),t=this.options_.item,n=(e.className="vjs-playlist-item",e.setAttribute("tabIndex",0),this.thumbnail=function(e){if(!e)return(t=c.createElement("div")).className="vjs-playlist-thumbnail vjs-playlist-thumbnail-placeholder",t;var r=c.createElement("picture");if(r.className="vjs-playlist-thumbnail","string"==typeof e){var t=c.createElement("img");t.src=e,t.alt="",r.appendChild(t)}else{for(var n=0;n<e.length-1;n++){var o,a=e[n],s=c.createElement("source");for(o in a)s[o]=a[o];r.appendChild(s)}var d,u=e[e.length-1],l=c.createElement("img");for(d in l.alt="",u)l[d]=u[d];r.appendChild(l)}return r}(t.thumbnail),e.appendChild(this.thumbnail),t.duration&&(i=c.createElement("time"),n=r.formatTime(t.duration),i.className="vjs-playlist-duration",i.setAttribute("datetime","PT0H0M"+t.duration+"S"),i.appendChild(c.createTextNode(n)),e.appendChild(i)),c.createElement("span")),i=this.localize("Now Playing"),i=(n.className="vjs-playlist-now-playing-text",n.appendChild(c.createTextNode(i)),n.setAttribute("title",i),this.thumbnail.appendChild(n),c.createElement("div")),n=(i.className="vjs-playlist-title-container",this.thumbnail.appendChild(i),c.createElement("span")),l=this.localize("Up Next"),l=(n.className="vjs-up-next-text",n.appendChild(c.createTextNode(l)),n.setAttribute("title",l),i.appendChild(n),c.createElement("cite")),n=t.name||this.localize("Untitled Video");return l.className="vjs-playlist-name",l.appendChild(c.createTextNode(n)),l.setAttribute("title",n),i.appendChild(l),e},t}(o),P=function(e){function t(i,n){var a;if(g(this,t),i.playlist)return(a=b(this,e.call(this,i,n))).items=[],n.horizontal?a.addClass("vjs-playlist-horizontal"):a.addClass("vjs-playlist-vertical"),n.supportsCssPointerEvents&&a.addClass("vjs-csspointerevents"),a.createPlaylist_(),r.browser.TOUCH_ENABLED||a.addClass("vjs-mouse"),i.on(["loadstart","playlistchange","playlistsorted"],function(e){a.update()}),i.on("adstart",function(){a.addClass("vjs-ad-playing")}),i.on("adend",function(){a.removeClass("vjs-ad-playing")}),a;throw new Error("videojs-playlist is required for the playlist component")}return _(t,e),t.prototype.createEl=function(){return T.createEl("div",{className:this.options_.className})},t.prototype.createPlaylist_=function(){var e=this.player_.playlist()||[],t=this.el_.querySelector(".vjs-playlist-item-list"),r=this.el_.querySelector(".vjs-playlist-ad-overlay");t||((t=c.createElement("ol")).className="vjs-playlist-item-list",this.el_.appendChild(t));for(var i=0;i<this.items.length;i++)t.removeChild(this.items[i].el_);for(var n=this.items.length=0;n<e.length;n++){var a=new O(this.player_,{item:e[n]},this.options_);this.items.push(a),t.appendChild(a.el_)}r||((r=c.createElement("li")).className="vjs-playlist-ad-overlay"),t.appendChild(r);var r=this.player_.playlist.currentItem();this.items.length&&0<=r&&(w(this.items[r]),r=this.items[r].$(".vjs-playlist-thumbnail"))&&T.addClass(r,"vjs-playlist-now-playing")},t.prototype.update=function(){var e=this.player_.playlist();if(this.items.length===e.length){for(var t=0;t<this.items.length;t++)if(this.items[t].item!==e[t])return void this.createPlaylist_();for(var r=this.player_.playlist.currentItem(),i=0;i<this.items.length;i++){var n=this.items[i];i===r?(w(n),c.activeElement!==n.el()&&T.addClass(n.thumbnail,"vjs-playlist-now-playing"),A(n)):i===r+1?(E(n),n.addClass("vjs-up-next")):(E(n),A(n))}}else this.createPlaylist_()},t}(o),x=function(e){for(var t=0;t<e.childNodes.length;t++)if(T.isEl(e.childNodes[t]))return!0;return!1},D=(r.registerComponent("PlaylistMenu",P),r.registerComponent("PlaylistMenuItem",O),l("playlistUi",L),L.VERSION="3.4.0",function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),R=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")},s=function(e){function t(r,i){D(this,t);i=R(this,e.call(this,r,i));return i.controlText(i.localize("Next playlist item")),i.on(r,["adstart"],i.disable),i.on(r,["adend","adtimeout"],i.enable),i}return U(t,e),t.prototype.buildCSSClass=function(){return"vjs-next-button "+e.prototype.buildCSSClass.call(this)},t.prototype.createEl=function(){return e.prototype.createEl.call(this,"button",{innerHTML:'<span class="vjs-icon-placeholder" aria-hidden="true"></span>'})},t.prototype.handleClick=function(e){this.player_.playlist.next(),this.options_.playOnSelect&&this.player_.play()},t}(r.getComponent("Button")),j=(r.registerComponent("NextButton",s),void 0!==e?e:void 0!==a?a:"undefined"!=typeof self?self:{}),n=function(e){function t(n,a){D(this,t);a=R(this,e.call(this,n,a));return a.haveSeenEnded_=!1,a.haveSeenNoPostroll_=!1,a.closeButton_=a.addChild("CloseButton"),a.on("click",a.handleClick),a.throttledHandleTimeupdate_=i.throttle(r.bind(a,a.handleTimeupdate_),200),a.boundHandleEnded_=r.bind(a,a.handleEnded_),a.boundHandleLoadstart_=r.bind(a,a.handleLoadstart_),a.on(a.closeButton_,"close",a.handleClose_),a.on(n,"adstart",a.handleAdStart_),a.on(n,"nopostroll",a.handleNoPostroll_),a.toggleListeners_("on"),a}return U(t,e),t.prototype.createEl=function(){this.countdownEl_=r.dom.createEl("div",{className:"vjs-next-overlay-countdown"}),this.nameEl_=r.dom.createEl("div",{className:"vjs-next-overlay-name"}),this.bannerEl_=r.dom.createEl("div",{className:"vjs-next-overlay-banner"},{},[this.countdownEl_,this.nameEl_]);var t=e.prototype.createEl.call(this,"div",{className:"vjs-next-overlay vjs-hidden"});return t.appendChild(this.bannerEl_),t},t.prototype.dispose=function(){this.bannerEl_=null,this.countdownEl_=null,this.nameEl_=null,this.imageEl_&&r.off(this.imageEl_),this.imageEl_=null,e.prototype.dispose.call(this)},t.prototype.handleClick=function(e){var t=this.closeButton_.el();e.target===t||t.contains(e.target)||this.player_.playlist.next()},t.prototype.handleStateChanged=function(e){var thumbnail,u,l,t=this,e=e.changes,n=this.state,a=n.name,s=n.seconds,n=n.thumbnail;e.seconds&&(u=this.localize("Up next"),this.canShowCountdown_()&&"number"==typeof s&&(u=this.localize("Up next in {1} seconds",[s])),r.dom.textContent(this.countdownEl_,u)),e.name&&r.dom.textContent(this.nameEl_,a||""),e.thumbnail&&(this.imageEl_&&this.el_.removeChild(this.imageEl_),"string"==typeof n&&/\S/.test(n)&&(thumbnail=n)||"object"==typeof n&&"number"==typeof n.length&&"object"==typeof n[0]&&"string"==typeof n[0].src&&(thumbnail=n[0].src))&&((l=this.imageEl_=new j.Image).src=thumbnail,l.alt="",r.on(l,"load",function(){r.dom.appendContent(t.el_,l)}),r.on(l,"error",function(){t.imageEl_=null}))},t.prototype.shouldShow_=function(){var e=this.player(),t=e.playlist;return!(this.hiddenByUser_||t.nextIndex()===t.currentIndex()||e.getChild("NextEndscreen")&&e.ended())},t.prototype.canShowCountdown_=function(){var e=this.player();return"number"==typeof e.playlist.autoadvance_.delay&&(!e.usingPlugin("ads")||J&&J.forceCountdown||this.haveSeenNoPostroll_||this.haveSeenEnded_)},t.prototype.getRemaining_=function(){var e=this.player(),t=e.duration(),r=e.currentTime();if(!(r<(30<t?t-10:Math.ceil(.6666*t))))return t=Math.ceil(t)-Math.ceil(r),e.playlist.autoadvance_.delay&&(t+=e.playlist.autoadvance_.delay),t},t.prototype.handleClose_=function(){this.hiddenByUser_=!0,this.hide()},t.prototype.toggleListeners_=function(e){this[e](this.player_,"ended",this.boundHandleEnded_),this[e](this.player_,"loadstart",this.boundHandleLoadstart_),this[e](this.player_,"timeupdate",this.throttledHandleTimeupdate_)},t.prototype.handleAdStart_=function(){var e=this;this.hide(),this.toggleListeners_("off"),this.one(this.player_,["adend","adtimeout"],function(){e.toggleListeners_("on")})},t.prototype.handleNoPostroll_=function(){this.haveSeenNoPostroll_=!0},t.prototype.handleEnded_=function(){var t,r,e=this;this.haveSeenEnded_=!0,this.clearInterval(this.countdownInterval_),this.shouldShow_()?0<(t=this.player().playlist.autoadvance_.delay)&&(r=Date.now(),this.show(),this.state.seconds=null,this.setState({seconds:t}),this.countdownInterval_=this.setInterval(function(){var i=Date.now();1e3<=i-r&&(r=i,t--,e.setState({seconds:t}),0===t)&&e.clearInterval(e.countdownInterval_)},100)):this.hide()},t.prototype.handleLoadstart_=function(){var e=this.player().playlist,e=e()[e.nextIndex()];this.clearInterval(this.countdownInterval_),this.hiddenByUser_=!1,this.haveSeenEnded_=!1,this.haveSeenNoPostroll_=!1,this.hide(),e&&this.setState({name:e.name,thumbnail:e.thumbnail})},t.prototype.handleTimeupdate_=function(){this.shouldShow_()&&(this.setState({seconds:this.getRemaining_()}),0<=this.state.seconds)?this.show():this.hide()},t}(r.getComponent("Component")),B=(r.registerComponent("NextOverlay",n),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}),F=function(e,t){return"function"==typeof e.usingPlugin?e.usingPlugin(t):"ads"===t?"object"===B(e.ads):"playlist"===t?!(!e.playlist||"object"!==B(e.playlist.autoadvance_)):!!e[t]},q=function(e){e.postrollStarted=!1,e.postrollFinished=!1,e.postrollTimedOut=!1,e.sawNoPostrollEvent=!1},H=(r.registerPlugin?r.getPlugin("endscreen")||r.registerPlugin("endscreen",V):r.plugin("endscreen",V),j.Date),o=r.getComponent("Button"),l=r.getComponent("ModalDialog"),Y=function(e){function t(){return D(this,t),R(this,e.apply(this,arguments))}return U(t,e),t.prototype.buildCSSClass=function(){return"vjs-play-control "+e.prototype.buildCSSClass.call(this)},t.prototype.handleClick=function(e){e.stopPropagation(),this.player_.playlist.next()},t}(o),s=function(e){function t(r,i){D(this,t);i=R(this,e.call(this,r,i));return r.endscreen(),i.closeable(!1),i.on("click",i.handleClick),i.on(r,"endscreen",i.handleEndscreen_),i.on(r,"loadstart",i.handleLoadstart_),i.on(r,"adstart",i.handleAdStart_),i}return U(t,e),t.prototype.buildCSSClass=function(){return"vjs-next-endscreen "+e.prototype.buildCSSClass.call(this)},t.prototype.dispose=function(){this.countdownEl_=null,this.nameEl_=null,this.thumbPlay_&&this.thumbPlay_.dispose(),this.imageEl_&&r.off(this.imageEl_),this.imageEl_=null,this.thumbEl_=null,e.prototype.dispose.call(this)},t.prototype.content=function(){var e=this;return this.countdownEl_=r.dom.createEl("div",{className:"vjs-next-endscreen-countdown"}),this.nameEl_=r.dom.createEl("div",{className:"vjs-next-endscreen-name"}),this.thumbEl_=r.dom.createEl("div",{className:"vjs-next-endscreen-thumbnail"}),W(this.state.name)&&r.dom.textContent(this.nameEl_,this.state.name),this.thumbPlay_&&(this.thumbPlay_.dispose(),this.thumbPlay_=null),W(this.state.thumbnail)?(this.imageEl_=new j.Image,this.imageEl_.src=this.state.thumbnail,this.imageEl_.alt="",r.on(this.imageEl_,"load",function(){e.thumbPlay_=new Y(e.player()),r.dom.appendContent(e.thumbEl_,[e.imageEl_,e.thumbPlay_.el()])}),r.on(this.imageEl_,"error",function(){e.imageEl_=null})):(this.thumbEl_=null,this.imageEl_=null),[this.countdownEl_,this.nameEl_,this.thumbEl_]},t.prototype.handleClick=function(e){this.player_.playlist.next()},t.prototype.handleStateChanged=function(e){var t=this;e.changes.seconds&&this.requestAnimationFrame(function(){r.dom.textContent(t.countdownEl_,t.localize("Up next in {1} seconds",[t.state.seconds]))})},t.prototype.shouldOpen_=function(){var e=this.player(),t=e.playlist;return!(e.usingPlugin("customEndscreen")||e.usingPlugin("social")&&e.socialOverlay&&e.socialOverlay.asEndscreen())&&t.nextIndex()!==t.currentIndex()&&"number"==typeof t.autoadvance_.delay},t.prototype.handleEndscreen_=function(){var t,r,e=this;this.clearInterval(this.countdownInterval_),this.shouldOpen_()?0<(t=this.player().playlist.autoadvance_.delay)&&(r=H.now(),this.open(),this.setState({seconds:t}),this.countdownInterval_=this.setInterval(function(){var i=H.now();1e3<=i-r&&(r=i,t--,e.setState({seconds:t}),0===t)&&e.clearInterval(e.countdownInterval_)},100)):this.close()},t.prototype.handleLoadstart_=function(){var e=this.player().playlist,e=e()[e.nextIndex()];this.clearInterval(this.countdownInterval_),this.close(),e&&this.setState({name:e.name,seconds:void 0,thumbnail:e.thumbnail})},t.prototype.handleAdStart_=function(){this.opened()&&(this.clearInterval(this.countdownInterval_),this.setState({seconds:void 0}),this.close())},t}(l),a=(s.prototype.options_={fillAlways:!0,pauseOnOpen:!0,temporary:!1},r.registerComponent("NextEndscreen",s),function(e){function t(){return D(this,t),R(this,e.apply(this,arguments))}return U(t,e),t.prototype.createEl=function(){return this.listEl_=r.dom.createEl("div",{className:"vjs-playlist"}),r.dom.createEl("div",{className:"vjs-playlist-sidebar vjs-playlist-sidebar-"+this.options_.orientation},{},this.listEl_)},t.prototype.listEl=function(){return this.listEl_},t.prototype.toggleHidden=function(){},t}(r.getComponent("Component"))),n=(r.registerComponent("PlaylistSidebar",a),function(e){function t(r,i){D(this,t);var n=R(this,e.call(this,r,i));return n.setState({hidden:!!i.hideOnStart}),n.on(n.showHideEl_,"click",function(){return n.toggleHidden()}),n.on(r,"play",function(){return n.toggleHidden(!0)}),n.on(c.body,["mouseenter","mouseleave"],function(e){n.toggleClass("vjs-playlist-show-hide-hidden","mouseleave"===e.type)}),n}return U(t,e),t.prototype.createEl=function(){var t=e.prototype.createEl.call(this);return this.showHideBtnEl_=r.dom.createEl("button"),this.showHideEl_=r.dom.createEl("div",{className:"vjs-playlist-show-hide"},{},this.showHideBtnEl_),t.appendChild(this.showHideEl_),t},t.prototype.handleStateChanged=function(e){var i,t=this;e.changes.hidden&&(i=e.changes.hidden.to,this.toggleClass("vjs-playlist-hidden",i),r.dom.textContent(this.showHideBtnEl_,i?"<":">"),this.setState({animating:!0})),e.changes.animating&&(i=e.changes.animating.to,this.toggleClass("vjs-playlist-animating",i),i)&&this.setTimeout(function(){return t.setState({animating:!1})},50)},t.prototype.toggleHidden=function(e){void 0===e&&(e=!this.state.hidden),this.state.animating||this.setState({hidden:e})},t}(a)),J=(n.defaultState={hidden:void 0,animating:!1},r.registerComponent("CollapsiblePlaylistSidebar",n),{hideOnStart:!1,nextButton:!0,nextOverlay:!0,nextEndscreen:!0,playOnSelect:!1,forceCountdown:!0,repeat:!1,shuffle:!1}),o=function(e){function t(i,n){D(this,t);var a=R(this,e.call(this,i,n));return a.options=r.mergeOptions(J,n),a.isInIframe_=r.dom.hasClass(playerElement.parentElement,"bc-iframe"),i.addClass("vjs-playlist-enabled"),a.orientation_=a.options.horizontal?"horizontal":"vertical",a.initPlaylist_(),a.initPlaylistUi_(),a.initNextButton_(),a.initNextEndscreen_(),a.initNextOverlay_(),a.isInIframe_&&(a.handlePlaylistChangeBound_=r.bind(a,a.handlePlaylistChange_),a.on(i,"playlistchange",a.handlePlaylistChangeBound_),a.handlePlaylistChangeBound_()),a}return U(t,e),t.prototype.toggleSidebar=function(){this.sidebar_&&this.sidebar_.toggleHidden()},t.prototype.dispose=function(){var t=this;e.prototype.dispose.call(this),["sidebar_","nextButton_","nextOverlay_","nextEndscreen_"].forEach(function(e){t[e]&&t[e].dispose()})},t.prototype.initNextButton_=function(){var a,e=this.options,t=e.nextButton,e=e.playOnSelect;t&&((t=i.isObj(t)?t:{}).hasOwnProperty("playOnSelect")||(t.playOnSelect=!!e),a=(e=this.player.getChild("controlBar")).children().map(function(e){return e.name()}).indexOf("PlayToggle")+1,this.nextButton_=e.addChild("NextButton",t,a))},t.prototype.initNextOverlay_=function(){var nowOptions=this.options,t=this.player;nowOptions.nextOverlay&&(this.nextOverlay_=t.addChild("NextOverlay",{nextOverlay:nowOptions.nextOverlay}))},t.prototype.initNextEndscreen_=function(){var nowOptions=this.options,t=this.player;nowOptions.nextEndscreen&&(this.nextEndscreen_=t.addChild("NextEndscreen",{nextEndscreen:nowOptions.nextEndscreen}))},t.prototype.initPlaylist_=function(){var e=this.options,t=this.player;e.shuffle&&t.on("duringplaylistchange",function(){return t.playlist.shuffle()}),t.playlist(e.playlist),t.playlist.repeat(!!e.repeat),void 0!==e.autoadvance&&t.playlist.autoadvance(e.autoadvance)},t.prototype.initPlaylistUi_=function(){var e=this,t=this.options,i=this.player,n={horizontal:t.horizontal,playOnSelect:t.playOnSelect};this.isInIframe_?(t.horizontal?this.sidebar_=i.addChild("PlaylistSidebar",{orientation:this.orientation_}):this.sidebar_=i.addChild("CollapsiblePlaylistSidebar",{hideOnStart:t.hideOnStart,orientation:this.orientation_}),i.el().parentNode.appendChild(this.sidebar_.el()),n.el=this.sidebar_.listEl(),this.finalizePlaylistUi_(n)):"complete"===c.readyState?this.finalizePlaylistUi_(n):r.one(c,"DOMContentLoaded",function(){e.finalizePlaylistUi_(n)})},t.prototype.finalizePlaylistUi_=function(e){var t=this.player,r=t.bcinfo,i=r&&r.playerId||t.tagAttributes["data-player"],n=r&&r.embedId||t.tagAttributes["data-embed"],a=r&&r.applicationId||t.tagAttributes["data-application-id"];if(t.el()){r=topElement.querySelector('.vjs-playlist[data-for="'+t.id()+'"]');if(r)e.el=r;else if(i&&n)for(var o=Array.prototype.slice.call(topElement.querySelectorAll('.vjs-playlist[data-player="'+i+'"][data-embed="'+n+'"]')),u=0;u<o.length;u++){var l=o[u];if(!a){e.el=l;break}if(a===l.getAttribute("data-application-id")){e.el=l;break}}t.playlistUi(e)}},t.prototype.handlePlaylistChange_=function(){var e="vjs-playlist-"+this.orientation_+"-enabled";this.isInIframe_&&(this.player.playlist().length?(r.dom.addClass(c.body,e),this.sidebar_.show()):(r.dom.removeClass(c.body,e),this.sidebar_.hide()))},t}(r.getPlugin("plugin"));return r.registerPlugin("bcPlaylistUi",o),o.VERSION="3.3.1",o})}(document),player.playlist(playListToUse||playList.items),void 0===(options=options||{}).autoadvance&&(options.autoadvance=0),void 0===options.forceCountdown&&(options.forceCountdown=!0),void 0===options.playOnSelect&&(options.playOnSelect=!0),uiInstance=player.bcPlaylistUi(options),tryNumber=0,intervalChecker=setInterval(function(){var playlistCurrentItem,playlist;uiInstance&&uiInstance.nextOverlay_&&uiInstance.nextOverlay_.state&&uiInstance.nextOverlay_.state.name&&(playlist=uiInstance.player.playlist(),playlistCurrentItem=uiInstance.player.playlist.currentItem(),playlist.length)&&0<=playlistCurrentItem&&playlistCurrentItem<playlist.length&&(playlist=playlist[playlistCurrentItem],uiInstance.nextOverlay_.state.name===playlist.name)&&(uiInstance.nextOverlay_.handleLoadstart_(),function(){urlDebugParameter&&console.log.apply(this,arguments)}("FIX uiInstance DONE",uiInstance,playlist,playlist.name,uiInstance.nextOverlay_.state,uiInstance.nextOverlay_.state.name),4<++tryNumber)&&(clearInterval(intervalChecker),intervalChecker=0)},1e3),playerStorage.disposeCallback.push(function(x){intervalChecker&&clearInterval(intervalChecker),intervalChecker=0})}};browserify_shim__define__module__export__(void 0!==plExport?plExport:window.plExport)}.call(global,void 0,void 0,void 0,void 0,function(ex){module.exports=ex})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{global:8}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkState=checkState,exports.loaded=loaded,exports.prepareComScore=function(useComScoreID,playerStorageToUse){playerStorageToUse&&(playerStorage=playerStorageToUse);var s,f;return!!useComScoreID&&"string"==typeof window.comScore6&&(playerStorageToUse=document,s="script",f=playerStorageToUse.getElementsByTagName(s)[0],(playerStorageToUse=playerStorageToUse.createElement(s)).async=!0,playerStorageToUse.src=window.comScore6,playerStorageToUse.onload=loaded,f.parentNode.insertBefore(playerStorageToUse,f),void(comScoreID=useComScoreID))};var comScore,_log=require("../log/log"),comScoreID=0;function loaded(){(0,_log.cLog)("HERE loaded comScore6",comScoreID,window.ns_.ReducedRequirementsStreamingAnalytics),"function"!=typeof ns_.ReducedRequirementsStreamingAnalytics?(0,_log.cLog)("missing ns_.ReducedRequirementsStreamingAnalytics"):(setInterval(checkState,500),window.addEventListener("beforeunload",function(){(0,_log.cLog)("beforeunload",comScore),comScore&&(comScore.stop(),comScore=void 0)}),window.addEventListener("unload",function(){(0,_log.cLog)("unload",comScore),comScore&&(comScore.stop(),comScore=void 0)}))}var c3,playerStorage,playingAnAd=!1,playingContent=!1,comScoreStopped=!0;try{c3=window.location.hostname&&window.location.hostname.length?window.location.hostname.split(".").slice(-2).join("."):window.location.hostname}catch(e){}function checkState(){if(void 0!==playerStorage.playerState)if(playerStorage.playerState.adManager.playingAnAd!==playingAnAd)playerStorage.playerState.adManager.playingAnAd?(metadata={ns_st_cl:0},"string"==typeof c3&&c3.length&&(metadata.c3=c3),comScoreStopped||(comScoreStopped=!0,comScore&&comScore.stop(),comScore=void 0),(comScore=new ns_.ReducedRequirementsStreamingAnalytics({publisherId:comScoreID})).playVideoAdvertisement(metadata,ns_.ReducedRequirementsStreamingAnalytics.AdType.LinearOnDemandPreRoll),playingContent=comScoreStopped=!1):comScoreStopped||(comScoreStopped=!0,comScore.stop(),comScore=void 0),playingAnAd=playerStorage.playerState.adManager.playingAnAd;else if(!playingAnAd&&playerStorage.playerState.playingVidCo!==playingContent){if(playerStorage.playerState.playingVidCo){try{var currentVideo=playerStorage.player.playlist()[playerStorage.player.playlist.currentItem()]}catch(e){}var metadata={ns_st_ci:currentVideo?currentVideo.description_url:0,ns_st_cl:currentVideo?1e3*currentVideo.duration:0,ns_st_pr:"Ampliffy",ns_st_ge:"*null",ns_st_ia:"0",ns_st_ce:"0",ns_st_ddt:"*null",ns_st_tdt:"*null",ns_st_ep:currentVideo?currentVideo.name:0};"string"==typeof c3&&c3.length&&(metadata.c3=c3),comScoreStopped||(comScoreStopped=!0,comScore&&comScore.stop(),comScore=void 0),(comScore=new ns_.ReducedRequirementsStreamingAnalytics({publisherId:comScoreID})).playVideoContentPart(metadata,ns_.ReducedRequirementsStreamingAnalytics.ContentType.ShortFormOnDemand),playingAnAd=comScoreStopped=!1}else comScoreStopped||(comScoreStopped=!0,comScore.stop(),comScore=void 0);playingContent=playerStorage.playerState.playingVidCo}}},{"../log/log":62}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCoords=function(elem){var doc=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,elem=elem.getBoundingClientRect(),body=doc.body,docEl=doc.documentElement,doc=doc.defaultView,scrollTop=doc.pageYOffset||docEl.scrollTop||body.scrollTop,doc=doc.pageXOffset||docEl.scrollLeft||body.scrollLeft,clientTop=docEl.clientTop||body.clientTop||0,docEl=docEl.clientLeft||body.clientLeft||0,body=elem.top+scrollTop-clientTop,scrollTop=elem.left+doc-docEl;return{top:Math.round(body),left:Math.round(scrollTop)}}},{}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCookie=function(name){name=("; "+document.cookie).split("; "+name+"=");if(2==name.length)return name.pop().split(";").shift()},exports.getTopCookie=function(name){name=("; "+top.document.cookie).split("; "+name+"=");if(2==name.length)return name.pop().split(";").shift()}},{}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDeviceSizeOrientationAware=function(){var screenWidth,screenHeight,orientation=(0,_orientation.getOrientation)();"landscape-primary"===orientation||"landscape-secondary"===orientation?screenHeight=screen.width>screen.height?(screenWidth=screen.width,screen.height):(screenWidth=screen.height,screen.width):"portrait-secondary"===orientation||"portrait-primary"===orientation?screenHeight=screen.width>screen.height?(screenWidth=screen.height,screen.width):(screenWidth=screen.width,screen.height):void 0===orientation&&(screenWidth=screen.width,screenHeight=screen.height);return{screenWidth:screenWidth,screenHeight:screenHeight}};var _orientation=require("./orientation")},{"./orientation":50}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOrientation=function(){var orientationByAPI=(screen.orientation||{}).type||screen.mozOrientation||screen.msOrientation;if(!orientationByAPI&&window.orientation){switch(window.orientation){case 0:return"portrait-primary";case 90:return"landscape-primary";case-90:return"portrait-secondary";case 180:return"landscape-secondary"}return orientationByAPI}}},{}],51:[function(require,module,exports){"use strict";function parseQueryString(str){for(var key,result={},keyValues=str.split("&"),len=keyValues.length,i=0;i<len;i++){var el=keyValues[i];el.length&&(key=(el=el.split("=",2))[0],el=el[1],result[key]=el)}return result}function serializeQueryString(data){var prop,value,result=[];for(prop in data)data.hasOwnProperty(prop)&&(value=data[prop],result.push(void 0===value?prop:prop+"="+value));return result.join("&")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseQuery=function(queryString,returnObject){for(var query=returnObject||{},pairs=("?"===queryString[0]?queryString.substr(1):queryString).split("&"),i=0;i<pairs.length;i++){var pair=pairs[i].split("=");query[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1]||"")}return query},exports.parseQueryString=parseQueryString,exports.removeDuplicateURLParameters=function(url){var hashParts=url.split("#",2);if(hashParts[0].indexOf("?")<0)return url;var url=hashParts[0].split("?"),data=parseQueryString(url[1]),url=url[0]+"?"+serializeQueryString(data);1<hashParts.length&&(url+="#"+hashParts[1]);return url},exports.serializeQueryString=serializeQueryString},{}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isShadowDOMAvailable=function(){(0,_version.getChromeVersion)();return!document.head.createShadowRoot&&document.head.attachShadow};var _version=require("./version")},{"./version":53}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChromeVersion=function(){var raw=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!raw&&parseInt(raw[2],10)}},{}],54:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.showNonPersonalizedAds=function(){return!1}},{}],55:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FluidObserver=void 0;var _device=require("../browser/device");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}require=function(){function FluidObserver(){var elementToWatch=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,ratio=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.5625,instance=this,Constructor=FluidObserver;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");if(this.elementToWatch=elementToWatch,ratio<=0)throw"Invalid ratio "+ratio;this.containerRatio=ratio,this.fluidObservers=[]}var Constructor,protoProps,staticProps;return Constructor=FluidObserver,(protoProps=[{key:"installFluidIntervalChecker",value:function(){var intervalMS=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1500;this.intervalChecker&&clearInterval(this.intervalChecker),this.intervalChecker=setInterval(this.fixFluidViaJS.bind(this),intervalMS)}},{key:"fixFluidViaJS",value:function(){var _getDeviceSizeOrienta,calcW,elementToWatch,screenWidth,finalW;return!!this.containerRatio&&(elementToWatch=this.elementToWatch,screenWidth=(_getDeviceSizeOrienta=(0,_device.getDeviceSizeOrientationAware)()).screenWidth,_getDeviceSizeOrienta=_getDeviceSizeOrienta.screenHeight,screenWidth=0<top.innerWidth?Math.min(top.innerWidth,screenWidth):screenWidth,_getDeviceSizeOrienta=0<top.innerHeight?Math.min(top.innerHeight,_getDeviceSizeOrienta):_getDeviceSizeOrienta,screenWidth=Math.min(elementToWatch.offsetWidth,screenWidth),_getDeviceSizeOrienta=Math.min(elementToWatch.offsetHeight,_getDeviceSizeOrienta),calcW=Math.floor(Math.min(elementToWatch.offsetWidth,_getDeviceSizeOrienta/this.containerRatio)),elementToWatch=Math.floor(Math.min(elementToWatch.offsetHeight,screenWidth*this.containerRatio+.9)),screenWidth=screenWidth<=calcW?(finalW=screenWidth,elementToWatch):(finalW=calcW,_getDeviceSizeOrienta),finalW=Math.round(finalW),screenWidth=Math.round(screenWidth),finalW<100||screenWidth<70||"number"!=typeof finalW||"number"!=typeof screenWidth||isNaN(screenWidth)||isNaN(finalW)||((isNaN(this.lastHeight)||isNaN(this.lastWidth))&&(this.lastWidth=finalW,this.lastHeight=screenWidth),this.lastWidth===finalW&&this.lastHeight===screenWidth)?void 0:(this.lastWidth=finalW,this.lastHeight=screenWidth,this.fluidObservers.forEach(function(x){return x()}),!0))}},{key:"addFluidObserver",value:function(observer){return!this.fluidObservers.find(function(x){return x===observer})&&(this.fluidObservers.push(observer),!0)}},{key:"removeFluidObserver",value:function(observer){return this.fluidObservers=this.fluidObservers.filter(function(x){return x!==observer}),!0}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),FluidObserver}();exports.FluidObserver=require},{"../browser/device":49}],56:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _defineProperty(obj,key,value){(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}function _toPropertyKey(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SizeRegistry=void 0;var SizeRegistry=function(){function SizeRegistry(){if(!(this instanceof SizeRegistry))throw new TypeError("Cannot call a class as a function");_defineProperty(this,"registry",{}),_defineProperty(this,"type",""),_defineProperty(this,"playerResize",function(){}),_defineProperty(this,"interval",void 0)}var Constructor,protoProps,staticProps;return Constructor=SizeRegistry,(protoProps=[{key:"getSize",value:function(){return this.registry[this.type]}},{key:"setSizeByType",value:function(type,width,height){this.registry[type]={width:width,height:height}}},{key:"getSizeByType",value:function(type){return this.registry[type]}},{key:"setType",value:function(newType){this.type=newType}},{key:"getType",value:function(){return this.type}},{key:"getRegistry",value:function(){return this.registry}},{key:"setPlayerResize",value:function(callback){this.playerResize=callback}},{key:"getPlayerResize",value:function(){return this.playerResize}},{key:"doResize",value:function(){var _this$registry$this$t=this.registry[this.type],width=_this$registry$this$t.width,_this$registry$this$t=_this$registry$this$t.height;this.playerResize(width,_this$registry$this$t)}},{key:"startResize",value:function(){var _this=this,_this$registry$this$t2=this.registry[this.type],width=_this$registry$this$t2.width,_this$registry$this$t2=_this$registry$this$t2.height;console.log("startResize",width,_this$registry$this$t2,top.ampRegistryTest),this.playerResize(width,_this$registry$this$t2),this.interval&&clearInterval(this.interval),this.interval=setInterval(function(){return _this.doResize()},500)}},{key:"stopResize",value:function(){this.interval&&clearInterval(this.interval),this.interval=null}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),SizeRegistry}();exports.SizeRegistry=SizeRegistry},{}],57:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addStyles=function(jsStyles,rootElement){var rootElement=rootElement||document,rootElement=rootElement.head||rootElement.querySelector("head"),style=document.createElement("style");style.type="text/css",style.styleSheet?style.styleSheet.cssText=jsStyles:style.appendChild(document.createTextNode(jsStyles));return rootElement.appendChild(style),style}},{}],58:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeHtml=function(html){var txt=document.createElement("textarea");return txt.innerHTML=html,txt.value},exports.escapeHtml=function(unsafe){return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},{}],59:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.IsMobile=void 0;var IsMobile=function(){function IsMobile(viewPortWidth,viewPortHeight){if(!(this instanceof IsMobile))throw new TypeError("Cannot call a class as a function");this.viewPortWidth=viewPortWidth,this.viewPortHeight=viewPortHeight}var Constructor,protoProps,staticProps;return Constructor=IsMobile,(protoProps=[{key:"isMobile",value:function(){return this.viewPortWidth<460||this.viewPortHeight<460||this.isIOS()||this.isAndroid()}},{key:"isIOS",value:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}},{key:"isAndroid",value:function(){return/Android/i.test(navigator.userAgent)}},{key:"isSafari",value:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),IsMobile}();exports.IsMobile=IsMobile},{}],60:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getTopViewPortSize=function(){var viewPortSize=[0,0];try{var validDocumentSize=document.documentElement&&document.documentElement.clientHeight<1.5*window.innerHeight;viewPortSize[0]=Math.max(validDocumentSize?document.documentElement.clientWidth:0,window.innerWidth||0),viewPortSize[1]=Math.max(validDocumentSize?document.documentElement.clientHeight:0,window.innerHeight||0)}catch(e){console.log("Unable to grab current viewport dimensions")}try{var _validDocumentSize=top.document.documentElement&&top.document.documentElement.clientHeight<1.5*top.innerHeight;viewPortSize[0]=Math.max(_validDocumentSize?top.document.documentElement.clientWidth:0,top.innerWidth||0),viewPortSize[1]=Math.max(_validDocumentSize?top.document.documentElement.clientHeight:0,top.innerHeight||0)}catch(e){}return viewPortSize},exports.getViewPortSize=function(){var viewPortSize=[0,0];try{var validDocumentSize=document.documentElement&&document.documentElement.clientHeight<1.5*window.innerHeight;viewPortSize[0]=Math.max(validDocumentSize?document.documentElement.clientWidth:0,window.innerWidth||0),viewPortSize[1]=Math.max(validDocumentSize?document.documentElement.clientHeight:0,window.innerHeight||0)}catch(e){console.log("Unable to grab current viewport dimensions")}return viewPortSize}},{}],61:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gamestryAdUnits=exports.Gamestry=void 0;var _log=require("./log/log"),_viewport=require("./dom/viewport"),_isMobile=require("./dom/isMobile"),_vast=require("./vidCo/vast"),_consent=require("./consent/consent");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _construct(Parent,args,Class){return(_construct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){}}()?Reflect.construct.bind():function(Parent,args,Class){var a=[null];a.push.apply(a,args);args=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(args,Class.prototype),args}).apply(null,arguments)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o})(o,p)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}var gamestryAdUnits={DEFAULT:"Gamestryesports_Gamestry","5fad36622596e50004c00f18":"Gamestryesports_Trolerotutos","5fad32932596e50004c00c5d":"Gamestryesports_Hardyluski","5fadb0c9e5ca22000313983a":"Gamestryesports_ElCHiNORB","5f9c1c46b62f4e000442a262":"Gamestryesports_Manucraft","5f95d474df5fb20004bf1614":"Gamestryesports_Inachete","5efc595a21492f0004e69740":"Gamestryesports_DrekzeNN","5f678ebe978af50004cad35a":"Gamestryesports_BENIJU","5fa5bf31aebcde00044ca004":"Gamestryesports_WhiteZunder","5d4b67165377640004963390":"Gamestryesports_YoSoyRick","5fa6c9a38c4c6f0004b63680":"Gamestryesports_RiusPlay","5f624b054e8a46000402a653":"Gamestryesports_Late","5f9b3eed5db2e00004425625":"Gamestryesports_HiipoHD","5f6510d3c7d3870004af34b7":"Gamestryesports_KManuS88","5fa299f5d51e5d0004d26890":"Gamestryesports_GuitarHeroStyles","5f9b40935db2e000044256ce":"Gamestryesports_Nonigamer","5f9193804d22c20004ac99ab":"Gamestryesports_Dagar64","5f9bff045db2e00004426bac":"Gamestryesports_Thekhornar","5f9b5c035db2e00004425c49":"Gamestryesports_NickSaurus","5be59731ae722e0004574a3c":"Gamestryesports_Malcaide","5fa1a1b8d51e5d0004d1f793":"Gamestryesports_Themarzy","5e7df4ea22244c0004ce6a54":"Gamestryesports_Regue","5e84f9b18e940000047c5c9f":"Gamestryesports_AdrianPiedra","5fa884629345630004a483ee":"Gamestryesports_Massi","5f7fc79e1b96bb0003b49da4":"Gamestryesports_CloudyOhio","5f71e8f29cbef30004ed12fc":"Gamestryesports_Soking","5f7d18451edcdf0003804529":"Gamestryesports_Haru","5f832899749cf5000399b64c":"Gamestryesports_Neburix","5f7cc7141edcdf000380371d":"Gamestryesports_BySmash","5ed435ec7c68c800040f337d":"Gamestryesports_RoyalFlush","5fa5978faebcde00044c854f":"Gamestryesports_CarlosCastle","5fa594c5aebcde00044c8356":"Gamestryesports_RedstoneCanarias","5f6244b44e8a46000402a5ff":"Gamestryesports_YersonCz","5eda486cf828f100041e4215":"Gamestryesports_Hanuari","5f3d991e134bb8000498e73e":"Gamestryesports_Kodigo","5f5a67733d14670004039605":"Gamestryesports_BaleGG","5f059f66ba3a851b9a544660":"Gamestryesports_IAmJP","5e7a2cfce7cd990004c0071f":"Gamestryesports_AleReyesYT","5ec7cacc8659ae00046df837":"Gamestryesports_HITBOXKING","5fab226da3d24700048c0777":"Gamestryesports_DualView","5f61fb554e8a46000402a3bc":"Gamestryesports_MaRCeU","5fba0ef5c344d100037f8377":"Gamestryesports_TheNino","5fb767de14e280000375f2ba":"Gamestryesports_PopperCraft","5fd8f866ecf3780003e5f91a":"Gamestryesports_Exi","5fce4e2bb9368a000340ba22":"Gamestryesports_DaniGamerOficial","5fc61e2e4c805a0003e3e53e":"Gamestryesports_dedreviil","5fc52928184ce90003f81cd8":"Gamestryesports_Rovi23","5fa596efaebcde00044c84c9":"Gamestryesports_soyivax","5fafc4fd536ae600036658dd":"Gamestryesports_ChicoGamerr","5fce0f08b9368a0003406d61":"Gamestryesports_LeonPicaron","5fb171f61c4e1c00037b8a77":"Gamestryesports_BPancri","5fbc08a0ab87e600035dc2d1":"Gamestryesports_MORTIS","5fcce3c5f06c250003626da1":"Gamestryesports_PokeR988TV","5fa988887be3350004bd23cd":"Gamestryesports_ZEROZONE","5fb2e465b6741f0003727663":"Gamestryesports_Blackelespanolito","5fbefe8885c43400032006e9":"Gamestryesports_SoyLeodany","5e56b661005b42000444103d":"Gamestryesports_Janghy","5faf7664ed146900037e553c":"Gamestryesports_yimmymi"},require=(exports.gamestryAdUnits=gamestryAdUnits,function(){function Gamestry(playerStorage){if(!(this instanceof Gamestry))throw new TypeError("Cannot call a class as a function");this.playerStorage=playerStorage,this._adUnits={},this.playerStorage.options.openwrapAccountId=159460,this.playerStorage.options.openwrapProfileId=3380,this.playerStorage.options.openwrapDelayVidAdUntilOwResponse=!1,this.playerStorage.options.openwrapMinCachedBids=2,this.pendingInitialization=!0,this.needsPlayForUnmute=!0,this.adShownToVimeoVideo=!1,this.vidAdTryToResumeVidCo=!1,this.adsError=!1,this.allowToRequestAds=!1,this.lastVimeoPlays=[],this.originalVidAd||(this.originalVidAd=this.playerStorage.options.vastURL);var vid,playerStorage=_construct(_isMobile.IsMobile,_toConsumableArray((0,_viewport.getTopViewPortSize)()));playerStorage.isIOS()&&(this.playerStorage.options.muted=!0,this.mutedUntilFirstAd=!0,vid=document.body.querySelector("video"))&&vid.setAttribute("muted","muted"),this.originalVidCo||(this.originalVidCo=this.playerStorage.options.vidCoAdUnit),this.playerStorage.options.vastURL=void 0,this.playerStorage.options.vidCoAllowRepeatSameVideo=!0,this.playerStorage.options.adBreakOnlyPrerolls=!0,playerStorage.isIOS()&&(this.playerStorage.options.adBreakOnlyPrerolls=!1),this.playerStorage.options.vidCoTitleHidden=!0,this.documentLocationHref=top.location.href,this.minimumVideoTime=6,this.urlToCreator={},this.newURLProcessed=!1,this.hideVimeoLayer=!1,this.resizeObservers=[],this.newURLTimestamp=performance.now()+5e3,this.resizeObservers.push(this.onResizeDoResizePlayer.bind(this)),this.adsLaunched=0,this.installHideVimeoLayer(),this.installEventHandler()}var Constructor,protoProps,staticProps;return Constructor=Gamestry,(protoProps=[{key:"adUnits",get:function(){return this._adUnits},set:function(value){this._adUnits=value}},{key:"getBaseAdUnit",value:function(dataLayer){var coach,baseAdUnit=void 0!==gamestryAdUnits.DEFAULT?gamestryAdUnits.DEFAULT:void 0;if(!dataLayer)return baseAdUnit;for(var i=0;i<dataLayer.length;i++)void 0!==dataLayer[i].creatorId&&(coach=dataLayer[i].creatorId);return coach&&void 0!==gamestryAdUnits[coach]?gamestryAdUnits[coach]:baseAdUnit}},{key:"onError",value:function(){var player=this.playerStorage.data.player;if("function"==typeof player.dispose&&("function"!=typeof player.error||player.error()))try{try{"function"==typeof player.error&&player.error()&&(this.playerStorage.errors=this.playerStorage.errors?this.playerStorage.errors+1:1,5<this.playerStorage.errors)&&(this.playerStorage.ignoreByErrors=!0)}catch(e){(0,_log.cLog)("Memory Reducing Error with player",e),this.playerStorage.errors=this.playerStorage.errors?this.playerStorage.errors+1:1}this.playerStorage.disposed=!0,this.playerStorage.soundInitialized=!1;try{this.playerStorage.playerCurrentTime=player.currentTime()}catch(e){(0,_log.cLog)("Unable to get currentTime for id ",id)}this.playerStorage.playerStorage.data&&this.playerStorage.playerStorage.data.dispose&&this.playerStorage.playerStorage.data.dispose();var disposePlayer=function(player,rootDocument){top.ampTV.rootDocument=rootDocument,player.dispose()}.bind(window,player,this.playerStorage.playerStorage.rootDocument);useShadowRoot?setTimeout(disposePlayer,1e3):disposePlayer(),this.playerStorage.onDispose&&this.playerStorage.onDispose.length&&(this.playerStorage.onDispose.forEach(function(x){return x()}),this.playerStorage.onDispose.splice(0)),top.ampTV.deleteConfigById(id),delete this.playerStorage.playerStorage}catch(e){(0,_log.cLog)("Memory Reducing Error: ",e,id)}}},{key:"searchForVimeoVideo",value:function(){this.documentLocationHref.match(/course-player\/[a-z0-9]/)?(this.intervalParsedVimeoVideo||(this.intervalParsedVimeoVideo=setInterval(this.searchForVimeoVideo.bind(this),1e3)),this.launchVidAd()):((0,_log.cLog)("AMP: Non Vimeo URL: Destroying Overlay, if it exists"),this.removeOverlay(!1))}},{key:"launchVidAd",value:function(){var placeholder=top.document.querySelector("#videoContainer");placeholder&&(this.vimeoPlaceholder=placeholder,this.resizePlayer(this.vimeoPlaceholder),this.newURLProcessed||(this.controlHideVimeoLayer(!0),this.controlHideVimeoLayerTimer&&clearTimeout(this.controlHideVimeoLayerTimer),this.controlHideVimeoLayerTimer=setTimeout(this.controlHideVimeoLayer.bind(this,!1),1e4),(0,_log.cLog)("AMP: Launch VidAd!"),this.newURLProcessed=!0,this.allowShowingVimeoLayer=!0,this.adRequestedToVimeoVideo=!1,this.adShownToVimeoVideo=!1,this.adsError=!1,this.allowToRequestAds=!1,this.vimeoWantsToPlay=!1,this.pendingInitialization=!1,this.vimeoPlayerAppearsObserver(),(0,_log.cLog)("AMP: Launch VidAd HERE!"),this.playerATVAppearsObserver()))}},{key:"vimeoPlayerAppearsObserver",value:function(){var _this=this,placeholder=this.vimeoPlaceholder,iframe=placeholder.querySelector("iframe");if(!iframe)return setTimeout(this.vimeoPlayerAppearsObserver.bind(this,placeholder),200);if(void 0===top.Vimeo)return setTimeout(this.vimeoPlayerAppearsObserver.bind(this,placeholder),200);if(iframe===this.parsedVimeoVideo)return setTimeout(this.vimeoPlayerAppearsObserver.bind(this,placeholder),200);(0,_log.cLog)("AMP: New Vimeo Player",iframe),this.parsedVimeoVideo=iframe;var vimeoPlayer=new top.Vimeo.Player(iframe);vimeoPlayer.ready().then(function(){return _this.newVimeoPlayerDetected(vimeoPlayer)}),vimeoPlayer.getVideoTitle().then(function(title){(0,_log.cLog)("AMP: Vimeo Title:",title)})}},{key:"playerATVAppearsObserver",value:function(){var _this2=this;if(!this.playerStorage.player)return setTimeout(this.playerATVAppearsObserver.bind(this),200);if(this.wasInAdsMode){(0,_log.cLog)("AMP: Was in Ads Mode"),this.wasInAdsMode=!1,this.adsError=!0,this.allowShowingVimeoLayer=!0,this.controlHideVimeoLayer(!1);try{var placeholder=this.playerStorage.getVideoElementPlaceholder(),_player=(placeholder.querySelector(".vjs-ad-playing")&&((0,_log.cLog)("AMP: About to remove vjs-ad-playing "),placeholder.querySelector(".vjs-ad-playing").classList.remove("vjs-ad-playing")),this.playerStorage.player);_player.ads&&"function"==typeof _player.ads.isInAdMode&&_player.ads.isInAdMode()&&_player.ads.reset()}catch(e){(0,_log.cLog)("AMP: Failed removing vjs-ad-playing"+e)}}else{this.setPlayerTime(this.playerStorage.player,0);var myThis=this,vastURLtoUse=(this.playerStorage.options.vastURL||((0,_log.cLog)("AMP: no VastURL, getting the default"),this.playerStorage.options.vastURL=this.originalVidAd,(0,_log.cLog)("AMP: VastURL",this.playerStorage.options.vastURL)),this.playerStorage.options.vastURL);(0,_log.cLog)("AMP: VastURL to Use",this.playerStorage.options.vastURL);(this.playerStorage.options.vastURL=void 0,_log.cLog)("AMP: About to check if playing and pause it");try{this.playerStorage.player.paused()||this.playerStorage.player.pause()}catch(e){}try{this.playerStorage.player.currentTime(0)}catch(e){}if(this.mutedUntilFirstAd){try{(0,_log.cLog)("AMP: About to force the mute state"),this.playerStorage.player.muted(!0),(0,_log.cLog)("AMP: Forced the mute state"),this.setAdsManagerVolume("muted"),(0,_log.cLog)("AMP: Forced the adsManager unmute state")}catch(e){(0,_log.cLog)("AMP: error trying to Mute: "+e)}this.needsPlayForUnmute=!0}else{try{(0,_log.cLog)("AMP: About to force the unmute state"),this.playerStorage.player.muted(!1),(0,_log.cLog)("AMP: Forced the unmute state"),this.setAdsManagerVolume("unmuted"),(0,_log.cLog)("AMP: Forced the adsManager unmute state")}catch(e){(0,_log.cLog)("AMP: error trying to unMute: "+e)}this.needsPlayForUnmute=!1}var cbOk=function(){(0,_log.cLog)("AMP: prepareOverlayOnAd"),myThis.adsLaunched++,myThis.prepareOverlayOnAd(function(){if(!myThis.adShownToVimeoVideo)try{(0,_log.cLog)("AMP: Show ads"),(0,_log.cLog)("AMP: About to request Ads"),myThis.adRequestedToVimeoVideo||(myThis.adRequestedToVimeoVideo=!0,_this2.playerStorage.options.vastURL=vastURLtoUse,myThis.requestAndShowAds(0))}catch(e){}})}.bind(this);(0,_log.cLog)("AMP: tryToAutoPlay"),this.tryAutoPlay(function(){(0,_log.cLog)("AMP: tryToAutoPlay Played the video, trying muted"),_this2.playerStorage.player.muted(!0),_this2.setAdsManagerVolume("muted"),_this2.needsPlayForUnmute=!0,_this2.tryAutoPlay(function(){_this2.adsError=!0,(0,_log.cLog)("tryToAutoPlay => abortOverlay()"),_this2.abortOverlay()},cbOk)},cbOk)}}},{key:"isInAdsMode",value:function(){var inAdsMode=!1,player=this.playerStorage.player;if(player){try{this.playerStorage.getVideoElementPlaceholder().querySelector(".vjs-ad-playing")&&((0,_log.cLog)("AMP: isInAdsMode true due to vjs-ad-playing "),inAdsMode=!0)}catch(e){}!inAdsMode&&player.ads&&"function"==typeof player.ads.isInAdMode&&player.ads.isInAdMode()&&((0,_log.cLog)("AMP: isInAdsMode true due to player.ads.isInAdMode"),inAdsMode=!0)}return inAdsMode}},{key:"resizePlayer",value:function(placeHolder){var placeHolderW,placeHolderH,w;placeHolder&&(placeHolderW=Math.round(placeHolder.offsetWidth),placeHolderH=Math.round(placeHolder.offsetHeight),placeHolder=top.document.querySelector(".amp-overlay"))&&(w=Math.round(placeHolder.offsetWidth),placeHolder=Math.round(placeHolder.offsetHeight),placeHolderW===w&&placeHolderH===placeHolder||((0,_log.cLog)("AMP: Resizing",placeHolderW,placeHolderH,w,placeHolder),this.resizeObservers.forEach(function(f){try{f(placeHolderW,placeHolderH)}catch(e){}})))}},{key:"onResizeDoResizePlayer",value:function(w,h){try{var ampOverlay=top.document.querySelector(".amp-overlay");ampOverlay&&(ampOverlay.style.width=w+"px",ampOverlay.style.height=h+"px")}catch(e){}try{var _player2=this.playerStorage.player;_player2.width(w),_player2.height(h)}catch(e){}try{var rootElement=this.playerStorage.getElementToFloat();rootElement&&"iframe"===rootElement.nodeName.toLowerCase()&&(rootElement.width=w,rootElement.height=h)}catch(e){}}},{key:"newVimeoPlayerDetected",value:function(vimeoPlayer){function timeUpdate(event){(0,_log.cLog)("AMP: Vimeo Time ",event.seconds,event.duration),.2<event.seconds&&myThis.controlHideVimeoLayer(!1),event.seconds<myThis.minimumVideoTime||(event.seconds>myThis.minimumVideoTime+10&&vimeoPlayer.off("timeupdate",timeUpdate),myThis.adsError)||((0,_log.cLog)("AMP: About to abort overlay due to time ",event.seconds,myThis.minimumVideoTime),myThis.controlHideVimeoLayer(!1),(0,_log.cLog)("AMP: Time => abortOverlay()"),myThis.abortOverlay(!1))}var myThis=this;vimeoPlayer.getPaused().then(function(paused){(0,_log.cLog)("AMP: paused:",paused);try{var onVimeoPlayEventHandler;paused?(onVimeoPlayEventHandler=myThis.onVimeoPlay.bind(myThis,function(){return vimeoPlayer.off("play",onVimeoPlayEventHandler)}),vimeoPlayer.on("play",onVimeoPlayEventHandler)):myThis.onVimeoPlay()}catch(e){}(0,_log.cLog)("AMP: Ads",myThis.playerStorage.player)});vimeoPlayer.on("timeupdate",timeUpdate)}},{key:"prepareOverlayOnAd",value:function(cb){var _this3=this;if(!this.adsError){this.controlHideVimeoLayer(!0);var player=this.playerStorage.player;if(!player||this.isFullScreen())return setTimeout(this.prepareOverlayOnAd.bind(this),1e3);(0,_log.cLog)("AMP: INSTALLED HANDLERS"),player.one("adstart",this.showAsOverlay.bind(this)),player.one("adend",function(){_this3.allowShowingVimeoLayer&&_this3.controlHideVimeoLayer(!1),(0,_log.cLog)("AMP: Remove Overlay due to adend",player),_this3.mutedUntilFirstAd=!1,_this3.removeOverlay()}),player.one("adserror",function(){_this3.adRequestedToVimeoVideo&&(_this3.allowShowingVimeoLayer&&_this3.controlHideVimeoLayer(!1),_this3.adsError=!0,(0,_log.cLog)("AMP: Remove Overlay due to adserror",player),_this3.removeOverlay())}),this.watchDog(),cb&&cb()}}},{key:"watchDog",value:function(){var _this4=this;if(this.watchDogInterval||(this.watchDogInterval=setInterval(this.watchDog.bind(this),1e3)),this.isFullScreen(),this.overlayShown){if(this.parsedVimeoVideo&&!top.document.body.contains(this.parsedVimeoVideo))return(0,_log.cLog)("AMP: Abort Overlay due to parsedVimeoVideo not in document",this.parsedVimeoVideo),this.abortOverlay();var _player3=this.playerStorage.player;_player3.ads.isInAdMode()||_player3.paused()||(_player3.pause(),(0,_log.cLog)("AMP: Remove Overlay due to overlayShown and player not in ads mode",_player3),this.abortOverlay(!1),this.watchDogInterval&&clearInterval(this.watchDogInterval),this.watchDogInterval=void 0)}else{_player3=this.playerStorage.player;if((0,_log.cLog)("AMP: WatchDog: adShown",this.adShownToVimeoVideo,this.adsError,"AdsMode:",_player3.ads.isInAdMode(),"Paused:",_player3.paused()),!this.adShownToVimeoVideo&&!this.adsError||_player3.ads.isInAdMode()||_player3.paused()){if(!this.adShownToVimeoVideo&&1e4<performance.now()-this.newURLTimestamp)try{this.playerStorage.getVideoElementPlaceholder().querySelector(".vjs-ad-playing")&&((0,_log.cLog)("AMP: About to abort overlay due to vjs-ad-playing "),this.abortOverlay())}catch(e){}}else _player3.pause(),this.vimeoWantsToPlay&&this.parsedVimeoVideo&&new top.Vimeo.Player(this.parsedVimeoVideo).ready().then(function(){var vimeoPlayer=new top.Vimeo.Player(_this4.parsedVimeoVideo);vimeoPlayer.getPaused().then(function(paused){paused&&vimeoPlayer.play()})})}}},{key:"isFullScreen",value:function(){var fullScreen;try{fullScreen=top.document.fullscreenElement||top.document.fullscreen||top.document.webkitIsFullScreen||top.document.mozFullScreen}catch(e){try{fullScreen=document.fullscreenElement||document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen}catch(e){(0,_log.cLog)("AMP: Error retrieving full screen info")}}try{var _player5=this.playerStorage.player;(0,_log.cLog)("AMP: Fullscreen",fullScreen,_player5.isFullscreen())}catch(e){}return!!fullScreen&&(this.adsError=!0,(0,_log.cLog)("AMP: About to abort overlay due to fullScreen "),this.abortOverlay(!1),!0)}},{key:"tooManyRecentVimeoPlays",value:function(now){var recentItems=0;return this.lastVimeoPlays.forEach(function(x){now-3e3<x&&++recentItems}),this.lastVimeoPlays.push(now),1<recentItems}},{key:"onVimeoPlay",value:function(cb){var now;if((0,_log.cLog)("AMP: Played the video"),!this.adRequestedToVimeoVideo&&!this.adShownToVimeoVideo&&!this.adsError||!this.adShownToVimeoVideo&&!this.adsError||this.overlayShown)return now=performance.now(),this.tooManyRecentVimeoPlays(now)?(this.vimeoWantsToPlay=!1,void(cb&&cb())):(new top.Vimeo.Player(this.parsedVimeoVideo).pause(),void(this.vimeoWantsToPlay=!0));this.vimeoWantsToPlay=!1,cb&&cb()}},{key:"onURLChange",value:function(){top.location.href!==this.documentLocationHref&&(this.documentLocationHref=top.location.href,this.newURLProcessed=!1,this.newURLTimestamp=performance.now(),(0,_log.cLog)("AMP: onURLChange",arguments),this.playerStorage.options.vastURL=void 0,this.wasInAdsMode=this.isInAdsMode(),this.abortOverlay(!1),this.lastVimeoPlays.splice(0),this.searchForVimeoVideo())}},{key:"abortOverlay",value:function(resumePlay){(0,_log.cLog)("AMP: Abort overlay",resumePlay),this.removeOverlay(resumePlay);try{var adsManagerIMA=void 0!==this.playerStorage.adsManagerIMA?this.playerStorage.adsManagerIMA:player.ima.getAdsManager();adsManagerIMA?adsManagerIMA.stop():(0,_log.cLog)("Unable to find AdsManager")}catch(e){(0,_log.cLog)("AMP:",e)}try{var _player6=this.playerStorage.player;_player6.pause(),_player6.ads.endLinearAdMode()}catch(e){(0,_log.cLog)("AMP:",e)}this.prepareAdTagDelayer&&(clearTimeout(this.prepareAdTagDelayer),this.prepareAdTagDelayer=void 0),this.prepareAdTagDelayer=setTimeout(this.prepareAdTag.bind(this),2e3)}},{key:"installEventHandler",value:function(){var _this5=this,pushState=(this.locationChangeInterval&&(clearInterval(this.locationChangeInterval),this.locationChangeInterval=void 0),this.locationChangeInterval=setInterval(function(){return top.location.href!==_this5.documentLocationHref&&_this5.onURLChange()},100),top.history.pushState),myThis=this,popState=(top.history.pushState=function(){pushState.apply(top.history,arguments),myThis.onURLChange(arguments)},top.history.popState);top.history.popState=function(){popState.apply(top.history,arguments),myThis.onURLChange(arguments)},top.addEventListener("popstate",this.onURLChange.bind(this)),function dataLayerListener(){if(void 0===top.dataLayer||"function"!=typeof top.dataLayer.push)return setTimeout(dataLayerListener,500);(0,_log.cLog)("AMP: DataLayer Listener Installed",top.dataLayer);var oldPush=top.dataLayer.push.bind(top.dataLayer);top.dataLayer.push=function(){var args=arguments;try{oldPush.apply(top.dataLayer,args)}catch(e){}try{myThis.dataLayerEventProcessor(args)}catch(e){}},myThis.dataLayerEventProcessor(top.dataLayer)}()}},{key:"dataLayerEventProcessor",value:function(args){var creatorArg;(0,_log.cLog)("AMP: dataLayer Args: ",JSON.parse(JSON.stringify(args)));for(var isMobile,i=0;i<args.length;i++)void 0!==args[i].creatorId&&(creatorArg=args[i]);creatorArg&&(this.urlToCreator[top.location.href]=creatorArg.creatorId,isMobile=_construct(_isMobile.IsMobile,_toConsumableArray((0,_viewport.getTopViewPortSize)())),"function"!=typeof args.forEach&&isMobile.isIOS()||this.newCoach(args))}},{key:"calculateVastURL",value:function(args){args=this.getBaseAdUnit(args);return this.originalVidAd.replace(new RegExp(gamestryAdUnits.DEFAULT,"ig"),args)}},{key:"newCoach",value:function(args){args&&(args=this.getBaseAdUnit(args),this.playerStorage.options.vastURL=this.originalVidAd.replace(new RegExp(gamestryAdUnits.DEFAULT,"ig"),args),(0,_log.cLog)("AMP: New VastURL to Use: ",this.playerStorage.options.vastURL),this.playerStorage.options.vidCoAdUnit=this.originalVidCo.replace(new RegExp(gamestryAdUnits.DEFAULT,"ig"),args),this.coachDetected=!0,this.launchVidAd())}},{key:"tryAutoPlay",value:function(cbFailure,cbOk){var player=this.playerStorage.player,bpb=player.getChild("bigPlayButton");if(!(bpb&&player.ima&&this.playerStorage.playerState&&this.playerStorage.playerState.adManager&&this.playerStorage.playerState.adManager.adManagerPrepared))return setTimeout(this.tryAutoPlay.bind(this,cbFailure,cbOk),100);bpb&&bpb.hide(),(0,_log.cLog)("AMP: AutoPlay: Waiting for Player Ready"),player.ready(function(){(0,_log.cLog)("AMP: AutoPlay: About to Play"),player.pause();var timeout,promise=player.play(),aborted=!1;void 0===promise?((0,_log.cLog)("AMP: AutoPlay: No promise"),bpb&&bpb.show(),cbFailure&&cbFailure()):((0,_log.cLog)("AMP: AutoPlay: Here a promise",player,promise),timeout=setTimeout(function(){(0,_log.cLog)("AMP: AutoPlay: Aborting promise due to timeout"),aborted=!(timeout=void 0),player.pause(),cbFailure()},1e3),promise.then(function(){timeout&&(clearTimeout(timeout),(0,_log.cLog)("AMP: AutoPlay: Promise Ok!",aborted),aborted||(bpb&&bpb.show(),cbOk&&cbOk()))}).catch(function(reason){timeout&&(clearTimeout(timeout),player.pause(),(0,_log.cLog)("AMP: AutoPlay: Promise KO!",reason,aborted),aborted||(bpb&&bpb.show(),cbFailure&&cbFailure()))}))})}},{key:"showAsOverlay",value:function(){var ampOverlay,_this6=this,adShown=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];(0,_log.cLog)("AMP: showAsOverlay"),this.isFullScreen()||(this.adShownToVimeoVideo=adShown,this.overlayShown=!0,(ampOverlay=top.document.querySelector(".amp-overlay"))&&((adShown=this.trackPosition.bind(this,function(){return ampOverlay},function(){return _this6.vimeoPlaceholder}))(),this.trackPositionInterval&&clearInterval(this.trackPositionInterval),this.trackPositionInterval=setInterval(adShown,500),adShown=this.parsedVimeoVideo)&&new top.Vimeo.Player(adShown).pause())}},{key:"trackPosition",value:function(ampOverlayFn,vimeoPlaceholderFn){var x,zIndex=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1e6,ampOverlayFn=ampOverlayFn(),vimeoPlaceholderFn=vimeoPlaceholderFn();"none"!==vimeoPlaceholderFn.style.display&&top.document.body.contains(vimeoPlaceholderFn)&&(x=(vimeoPlaceholderFn=vimeoPlaceholderFn.getBoundingClientRect()).left+top.pageXOffset,vimeoPlaceholderFn=vimeoPlaceholderFn.top+top.pageYOffset,ampOverlayFn.style.position="absolute",ampOverlayFn.style.left=x+"px",ampOverlayFn.style.top=vimeoPlaceholderFn+"px",ampOverlayFn.style.right="",ampOverlayFn.style.bottom="",ampOverlayFn.style.zIndex=zIndex,ampOverlayFn.style.display="")}},{key:"divLog",value:function(name,message){try{var newDiv,div=document.getElementById(name);return div?div.innerHTML=message:((newDiv=document.createElement("div")).id=name,newDiv.style.position="fixed",newDiv.style.left=0,newDiv.style.bottom=0,newDiv.style.width="auto",newDiv.style.height="auto",newDiv.style.background="grey",top.document.body.appendChild(newDiv),newDiv.innerHTML=message)}catch(e){}}},{key:"removeOverlay",value:function(){var vimeoPlayer,myThis,ampOverlay,resumePlay=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],vimeoIframe=((0,_log.cLog)("AMP: removeOverlay"),this.trackPositionInterval&&(clearInterval(this.trackPositionInterval),this.trackPositionInterval=void 0),this.overlayShown=!1,this.parsedVimeoVideo);vimeoIframe&&(ampOverlay=top.document.querySelector(".amp-overlay"))&&(ampOverlay.style.display="none",ampOverlay.style.position="fixed",ampOverlay.style.top="",ampOverlay.style.left="",ampOverlay.style.right=0,ampOverlay.style.bottom=0,ampOverlay.style.zIndex=-1,top.Vimeo)&&top.Vimeo.Player&&(vimeoPlayer=new top.Vimeo.Player(vimeoIframe),myThis=this,vimeoPlayer.getPaused().then(function(paused){if(paused){try{myThis.playerStorage.player.pause()}catch(e){}(0,_log.cLog)("AMP: Resume Play:",resumePlay,vimeoPlayer),resumePlay&&vimeoPlayer.play()}}),ampOverlay=this.playerStorage.player,setTimeout(ampOverlay.pause.bind(ampOverlay),50),setTimeout(ampOverlay.pause.bind(ampOverlay),100),setTimeout(ampOverlay.pause.bind(ampOverlay),250),setTimeout(ampOverlay.pause.bind(ampOverlay),500),setTimeout(ampOverlay.pause.bind(ampOverlay),750),setTimeout(ampOverlay.pause.bind(ampOverlay),1e3),ampOverlay.pause())}},{key:"start",value:function(){if(this.searchForVimeoVideo(),!this.parsedVimeoVideo)return setTimeout(this.start.bind(this),1e3)}},{key:"prepareAdTag",value:function(){if(!this.playerStorage.vidAdQueue)return setTimeout(this.prepareAdTag.bind(this),150);try{this.playerStorage.vidAdQueue.prepareAdTag(!1)}catch(e){(0,_log.cLog)("AMP: Error Preparing Ad Tag: "+e)}}},{key:"requestAndShowAds",value:function(){var _this7=this,delay=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5500,playerState=(this.allowToRequestAds=!0,this.playerStorage.playerState);if(!playerState||void 0===playerState.adManager||"function"!=typeof playerState.adManager.requestAnAd||!playerState.adManager.adManagerPrepared)return setTimeout(this.requestAndShowAds.bind(this),1e3);playerState.adManager.requestAnAd(),(0,_log.cLog)("AMP: Ads Requested"),setTimeout(function tryToShowAd(){var player=_this7.playerStorage.player;player.paused()&&player.play();try{if(!playerState.adManager.showRequestedAd())return setTimeout(tryToShowAd,500);_this7.allowToRequestAds=!1}catch(e){return setTimeout(tryToShowAd,1e3)}},delay)}},{key:"installHideVimeoLayer",value:function(){var _this8=this,spinnerHolderDiv=(this.spinner||(this.spinner=this.createSpinner()),top.document.createElement("div"));spinnerHolderDiv.id="ampSpinnerDiv",spinnerHolderDiv.style.background="black none repeat scroll 0% 0%",spinnerHolderDiv.innerHTML='<div class="spinner-container" style="position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n  transform: translate(-50%, -50%);">\n      <div class="ispinner white ispinner-large animating">\n        <div class="ispinner-blade"></div>\n        <div class="ispinner-blade"></div>\n        <div class="ispinner-blade"></div>\n        <div class="ispinner-blade"></div>\n        <div class="ispinner-blade"></div>\n        <div class="ispinner-blade"></div>\n        <div class="ispinner-blade"></div>\n        <div class="ispinner-blade"></div>\n      </div>\n    </div>',top.document.body.insertBefore(spinnerHolderDiv,top.document.body.firstElementChild),this.hideVimeoLayerHolder=spinnerHolderDiv,this.resizeObservers.push(function(w,h){_this8.hideVimeoLayerHolder.style.width=w+"px",_this8.hideVimeoLayerHolder.style.height=h+"px"})}},{key:"controlHideVimeoLayer",value:function(hideVimeoLayer){var _this9=this;if(void 0!==hideVimeoLayer&&(this.hideVimeoLayer=hideVimeoLayer),!this.vimeoPlaceholder)return setTimeout(this.controlHideVimeoLayer.bind(this),300);if(this.hideVimeoLayer){if((0,_log.cLog)("AMP: Hide VimeoLayer"),!top.document.querySelector(".amp-overlay"))return setTimeout(this.controlHideVimeoLayer.bind(this),300);this.vimeoPlaceholder.style.opacity=0;hideVimeoLayer=this.trackPosition.bind(this,function(){return _this9.hideVimeoLayerHolder},function(){return _this9.vimeoPlaceholder},5e3);hideVimeoLayer(),this.trackSpinnerPositionInterval&&clearInterval(this.trackSpinnerPositionInterval),this.trackSpinnerPositionInterval=setInterval(hideVimeoLayer,500),this.hideVimeoLayerHolder.style.display=""}else(0,_log.cLog)("AMP: Show VimeoLayer"),this.vimeoPlaceholder.style.opacity="",this.trackSpinnerPositionInterval&&(clearInterval(this.trackSpinnerPositionInterval),this.trackSpinnerPositionInterval=void 0),this.hideVimeoLayerHolder&&(this.hideVimeoLayerHolder.style.display="none")}},{key:"createSpinner",value:function(){var cssElement=top.document.createElement("style");return cssElement.type="text/css",cssElement.innerHTML=".ispinner {\n  position: relative;\n  width: 20px;\n  height: 20px; }\n  .ispinner .ispinner-blade {\n    position: absolute;\n    top: 6.5px;\n    left: 8.5px;\n    width: 2.5px;\n    height: 6.5px;\n    background-color: #8e8e93;\n    border-radius: 1.25px;\n    animation: iSpinnerBlade 1s linear infinite;\n    will-change: opacity; }\n    .ispinner .ispinner-blade:nth-child(1) {\n      transform: rotate(45deg) translateY(-6.5px);\n      animation-delay: -1.625s; }\n    .ispinner .ispinner-blade:nth-child(2) {\n      transform: rotate(90deg) translateY(-6.5px);\n      animation-delay: -1.5s; }\n    .ispinner .ispinner-blade:nth-child(3) {\n      transform: rotate(135deg) translateY(-6.5px);\n      animation-delay: -1.375s; }\n    .ispinner .ispinner-blade:nth-child(4) {\n      transform: rotate(180deg) translateY(-6.5px);\n      animation-delay: -1.25s; }\n    .ispinner .ispinner-blade:nth-child(5) {\n      transform: rotate(225deg) translateY(-6.5px);\n      animation-delay: -1.125s; }\n    .ispinner .ispinner-blade:nth-child(6) {\n      transform: rotate(270deg) translateY(-6.5px);\n      animation-delay: -1s; }\n    .ispinner .ispinner-blade:nth-child(7) {\n      transform: rotate(315deg) translateY(-6.5px);\n      animation-delay: -0.875s; }\n    .ispinner .ispinner-blade:nth-child(8) {\n      transform: rotate(360deg) translateY(-6.5px);\n      animation-delay: -0.75s; }\n  .ispinner.ispinner-large {\n    width: 35px;\n    height: 35px; }\n    .ispinner.ispinner-large .ispinner-blade {\n      top: 11.5px;\n      left: 15px;\n      width: 5px;\n      height: 12px;\n      border-radius: 2.5px; }\n      .ispinner.ispinner-large .ispinner-blade:nth-child(1) {\n        transform: rotate(45deg) translateY(-11.5px); }\n      .ispinner.ispinner-large .ispinner-blade:nth-child(2) {\n        transform: rotate(90deg) translateY(-11.5px); }\n      .ispinner.ispinner-large .ispinner-blade:nth-child(3) {\n        transform: rotate(135deg) translateY(-11.5px); }\n      .ispinner.ispinner-large .ispinner-blade:nth-child(4) {\n        transform: rotate(180deg) translateY(-11.5px); }\n      .ispinner.ispinner-large .ispinner-blade:nth-child(5) {\n        transform: rotate(225deg) translateY(-11.5px); }\n      .ispinner.ispinner-large .ispinner-blade:nth-child(6) {\n        transform: rotate(270deg) translateY(-11.5px); }\n      .ispinner.ispinner-large .ispinner-blade:nth-child(7) {\n        transform: rotate(315deg) translateY(-11.5px); }\n      .ispinner.ispinner-large .ispinner-blade:nth-child(8) {\n        transform: rotate(360deg) translateY(-11.5px); }\n\n@keyframes iSpinnerBlade {\n  0% {\n    opacity: 0.85; }\n  50% {\n    opacity: 0.25; }\n  100% {\n    opacity: 0.25; } }\n",top.document.querySelector("head").appendChild(cssElement),cssElement}},{key:"setPlayerTime",value:function(player,seconds){var initDone=!1;try{player.ready(function(){void 0===top.doneWithTestsAmp&&(this.on("timeupdate",function(){(0,_log.cLog)("AMP: vJS Player Time: ",this.currentTime())}),top.doneWithTestsAmp=!0)}),player.one("play",function(){player.currentTime(seconds)}),player.one("loadedmetadata",function(){player.currentTime(seconds)}),player.one("canplaythrough",function(){initDone||(player.currentTime(seconds),initDone=!0)}),player.currentTime(seconds)}catch(e){(0,_log.cLog)("AMP: Error setting player time: "+e)}}},{key:"setAdsManagerVolume",value:function(muted){var player=this.playerStorage.player;if(player)try{var adsManagerIMA=void 0!==this.playerStorage.adsManagerIMA?this.playerStorage.adsManagerIMA:player.ima.getAdsManager();adsManagerIMA&&("muted"===muted?(this.oldAdsManagerVolume=adsManagerIMA.getVolume(),adsManagerIMA.setVolume(0)):(this.oldAdsManagerVolume||(this.oldAdsManagerVolume=1),adsManagerIMA.setVolume(this.oldAdsManagerVolume)),(0,_log.cLog)("AMP: Volume: "+adsManagerIMA.getVolume()))}catch(e){(0,_log.cLog)("AMP: IMA SetVolume error"+e)}}},{key:"openWrapOnInit",value:function(openWrap){openWrap.prefetchPreHook=this.openWrapPrefetchHook.bind(this),openWrap.sampleVastURL=(0,_vast.resolveVidAdURL)(this.calculateVastURL([]),this.playerStorage.options.dev,!1,this.playerStorage.options,void 0,(0,_consent.showNonPersonalizedAds)(),this.playerStorage.options.size),(0,_log.cLog)("SampleVAST",openWrap.sampleVastURL)}},{key:"openWrapPrefetchHook",value:function(prefetch){(0,_log.cLog)("OpenWrap: prefetch.iu",prefetch.iu);var iu=prefetch.iu.match(/(\/Gamestryesports_[^_]*)/);return iu?(prefetch.iu=prefetch.iu.replace(/\/Gamestryesports_[^_]*/g,"/Gamestryesports_Gamestry"),function(url){return url.replace(/\/Gamestryesports_[^_]*/g,iu[1])}):function(url){return(0,_log.cLog)("OpenWrap: AMP: UNABLE TO FIND GAMESTRY AdUnit in "+url),url}}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Gamestry}());exports.Gamestry=require},{"./consent/consent":54,"./dom/isMobile":59,"./dom/viewport":60,"./log/log":62,"./vidCo/vast":87}],62:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var urlDebugParameter,urlRemoteDebugParameter;Object.defineProperty(exports,"__esModule",{value:!0}),exports.cLog=function(){logLevel(1,arguments);try{urlRemoteDebugParameter&&navigator.sendBeacon("https://securepubads.g.doubleclick.net/ads?log="+encodeURIComponent(JSON.stringify(arguments)),{})}catch(e){}},exports.imgLog=function(url,done,fail){var img=new Image;done&&(img.onload=done);fail&&(img.onerror=fail);img.src=url},exports.log=function(){logLevel(1,arguments)},exports.logLevel=logLevel;try{urlDebugParameter=window.location.search&&window.location.search.match(/[?&]amp_dev=1/),urlRemoteDebugParameter=window.location.search&&window.location.search.match(/[?&]amp_deb=1/)}catch(e){}function logLevel(level){try{for(var _len=arguments.length,args=new Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];(top&&"object"===_typeof(top.ampTV)&&"object"===_typeof(top.ampTV.options)&&top.ampTV.options.logLevel&&top.ampTV.options.logLevel>=level||urlDebugParameter)&&console.log.apply(this,args)}catch(e){}}},{}],63:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Intersection=void 0;var Intersection=function(){function Intersection(statuses){if(!(this instanceof Intersection))throw new TypeError("Cannot call a class as a function");this.statuses=statuses}var Constructor,protoProps,staticProps;return Constructor=Intersection,(protoProps=[{key:"setup",value:function(containerDomElement){this.observer=new top.IntersectionObserver(this.configuredProcessChanges.bind(this),{threshold:[0].concat(_toConsumableArray(this.statuses.map(function(x){return x.threshold})),[1])}),this.tsSetup=performance.now(),this.observer.observe(containerDomElement)}},{key:"configuredProcessChanges",value:function(changes,observer){var _this=this;changes.forEach(function(entry){_this.statuses.forEach(function(status){entry.intersectionRatio>=status.threshold?status.viewable||(status.viewable=!0,status.tsPreviousTransition=status.tsLastTransition,status.tsLastTransition=entry.time,status.observer&&status.observer.forEach(function(x){return x(status)})):entry.intersectionRatio<status.threshold&&(status.viewable||void 0===status.viewable)&&(status.viewable=!1,status.tsPreviousTransition=status.tsLastTransition,status.tsLastTransition=entry.time,status.observer)&&status.observer.forEach(function(x){return x(status)})})})}},{key:"dispose",value:function(){this.observer.disconnect()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Intersection}();exports.Intersection=Intersection},{}],64:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.aboveScrollingPosition=function(){var pageYOffset,id=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"content_video",context=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,id=(context=context||document,pageYOffset=top.pageYOffset,getOffset(context=(window.useShadowRoot?void 0:window.frameElement)||context.getElementById(id)).top);return(0,_log.cLog)("aboveScrollingPosition: ",pageYOffset,id+.4*context.clientHeight,pageYOffset>id+.4*context.clientHeight),pageYOffset>id+.4*context.clientHeight},exports.getOffset=getOffset,exports.isInViewport=isInViewport,exports.isVidAfInViewport=function(){var id=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"content_video",context=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return context=context||document,window.frameElement&&!window.useShadowRoot?isInViewport(window.frameElement):isInViewport(context.getElementById(id))};var _log=require("../log/log");function isInViewport(elem){var bounding=elem.getBoundingClientRect(),elem=elem.ownerDocument,win=elem.defaultView;return 0<=bounding.top&&0<=bounding.left&&bounding.bottom<=(win.innerHeight||elem.documentElement.clientHeight)&&bounding.right<=(win.innerWidth||elem.documentElement.clientWidth)}function getOffset(el){for(var _x=0,_y=0;el&&!isNaN(el.offsetLeft)&&!isNaN(el.offsetTop);)_x+=el.offsetLeft-el.scrollLeft,_y+=el.offsetTop-el.scrollTop,el=el.offsetParent;return{top:_y,left:_x}}},{"../log/log":62}],65:[function(require,module,exports){"use strict";var _publisher=require("./publisher"),_vidCo=require("./vidCo/vidCo"),_comScore2VideoJS=require("./analytics/comScore2VideoJS"),_isMobile=require("./dom/isMobile"),_viewport=require("./dom/viewport"),_shadowDOM=require("./browser/shadowDOM"),_gamestry=require("./gamestry"),_log=require("./log/log"),_openWrap=require("./vidAd/openWrap"),_queue=require("./vidAd/queue"),_amazonHeaderBidder=require("./vidAd/amazonHeaderBidder"),_absolutePosition=require("./browser/absolutePosition"),_playerSize=require("./container/playerSize"),_domainWhitelist=require("./player/domainWhitelist"),_phase=require("./phase-2");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _construct(Parent,args,Class){return(_construct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){}}()?Reflect.construct.bind():function(Parent,args,Class){var a=[null];a.push.apply(a,args);args=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(args,Class.prototype),args}).apply(null,arguments)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o})(o,p)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ownKeys(object,enumerableOnly){var symbols,keys=Object.keys(object);return Object.getOwnPropertySymbols&&(symbols=Object.getOwnPropertySymbols(object),enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)),keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){!function(obj,key,value){(key=function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(callback,thisArg){thisArg=thisArg||window;for(var i=0;i<this.length;i++)callback.call(thisArg,this[i],i,this)});var useShadowRoot=window.useShadowRoot=(0,_shadowDOM.isShadowDOMAvailable)(),gamestryProcessed=!1;function addPhase2Script(configID,shadowRoot,src){var sr=document.createElement("script");sr.async="async",sr.className="phase-2",0!==configID&&(sr.onload=function(configID){(0,_log.cLog)("window",window),(0,_log.cLog)("top",top),top,!top.ampTV.ampPhase2&&top.ampTV.ampPhase2Setup&&top.ampTV.ampPhase2Setup(),top.ampTV.ampPhase2(configID)}.bind(window,configID)),sr.src=src,(shadowRoot.querySelector("body")||shadowRoot).appendChild(sr)}function ampPhase1(configID){try{top.ampTV=top.ampTV||{},void 0===top.ampTV.installPlayList&&(top.ampTV.installPlayList=require("./AMPLIFFYPLAYER_INTEXT_IMA_05.JS").installPlayList),void 0===top.ampTV.getElementById&&(top.ampTV.getElementById=function(ampTV,id){var configId,playerStorage;return id&&(configId=id.replace(/___/g,","),(playerStorage=ampTV.getConfigById(configId))||id.match(/^content_video-/)&&(playerStorage=ampTV.getConfigById(configId.substr(14))),playerStorage)?playerStorage.shadowRoot.querySelector("#"+id):null}.bind(top,top.ampTV)),void 0===top.ampTV.ampPhase1&&(top.ampTV.ampPhase1=ampPhase1),void 0===top.ampTV.instances&&(top.ampTV.instances=[]),void 0===top.ampTV.addConfig&&(top.ampTV.addConfig=function(ampTV,anchorElement,data){var shadowRoot;anchorElement&&data&&(shadowRoot=(0,_shadowDOM.isShadowDOMAvailable)()?anchorElement.shadowRoot:anchorElement.contentDocument||anchorElement,shadowRoot={anchorElement:anchorElement,shadowRoot:shadowRoot,data:data,id:anchorElement.id},ampTV.instances=ampTV.instances.filter(function(x){return x.anchorElement!==anchorElement}),ampTV.instances.push(shadowRoot))}.bind(top,top.ampTV)),void 0===top.ampTV.getConfigByElement&&(top.ampTV.getConfigByElement=function(ampTV,anchorElement){if(anchorElement){ampTV=ampTV.instances.find(function(x){return x.anchorElement===anchorElement});if(ampTV)return ampTV}}.bind(top,top.ampTV)),void 0===top.ampTV.getConfigById&&(top.ampTV.getConfigById=function(ampTV,id){if(id){ampTV=ampTV.instances.find(function(x){return x.id===id});if(ampTV)return ampTV}}.bind(top,top.ampTV)),void 0===top.ampTV.deleteConfigByElement&&(top.ampTV.deleteConfigByElement=function(ampTV,anchorElement){anchorElement&&(ampTV.instances=ampTV.instances.filter(function(x){return x.anchorElement!==anchorElement}))}.bind(top,top.ampTV)),void 0===top.ampTV.deleteConfigById&&(top.ampTV.deleteConfigById=function(ampTV,id){id&&(ampTV.instances=ampTV.instances.filter(function(x){return x.id!==id}))}.bind(top,top.ampTV))}catch(e){console.error("Cannot setup ATV",e)}var isVideoBlog;try{isDev=window.location.search&&window.location.search.match(/[?&]amp_dev=1/),void 0===top.ampTV.phase1&&(top.ampTV.phase1=document.querySelector("script.phase-1")&&document.querySelector("script.phase-1").src||!0),void 0===top.ampliffyTVVideoBlog||frameElement&&frameElement.className&&frameElement.match(/vid-iframe-amp/)||void 0!==top.ampTV.phase2||(isVideoBlog=top.ampliffyTVVideoBlog)}catch(e){}var playerStorage={useShadowRoot:useShadowRoot,disposeCallback:[],playerSize:new _playerSize.SizeRegistry},onPhase2=[];if(!isVideoBlog&&frameElement&&configID===frameElement&&useShadowRoot){var topDivElementId=frameElement.id.replace(/\//g,"_")+"-div",frameElementId=frameElement.id,div=document.createElement("div"),initialVideoWidth=frameElement.clientWidth,initialVideoHeight=9*frameElement.clientWidth/16,initializationDone=(div.id=topDivElementId,div.className="vid-shadowRoot-amp",frameElement.style.opacity=.05,frameElement.style.pointerEvents="none",div.style.position="absolute",div.style.overflow="hidden",div.style.opacity=.05,div.style.pointerEvents="none",playerStorage.playerSize.setType("nonAva"),!1),tracker=function tracker(){playerStorage.options&&playerStorage.options.fluid&&(frameElement.style.width="100%",frameElement.style.height="100%",frameElement.style.height=9*frameElement.clientWidth/16+"px");var coords=(0,_absolutePosition.getCoords)(frameElement,frameElement.ownerDocument);div.style.top=coords.top+"px",div.style.left=coords.left+"px",playerStorage.playerSize.setSizeByType("nonAva",frameElement.clientWidth,frameElement.clientHeight),div.style.width=frameElement.clientWidth+"px",div.style.maxWidth=frameElement.clientWidth+"px",div.style.height=frameElement.clientHeight+"px",div.style.maxHeight=frameElement.clientHeight+"px",!initializationDone&&playerStorage.player&&"function"==typeof playerStorage.player.ready&&"0.05"===div.style.opacity&&(initializationDone=!0,playerStorage.player.ready(function(){playerStorage.options.fluid?(frameElement.style.width="100%",frameElement.style.height="100%"):(frameElement.style.width=playerStorage.options.size[0]+"px",frameElement.style.height=playerStorage.options.size[1]+"px"),div.style.opacity=1,div.style.pointerEvents="",tracker()}))};tracker(),setInterval(tracker,500),playerStorage.playerSize.startResize(),frameElement.ownerDocument.body.insertBefore(div,null);try{var script="\n    var div = document.getElementById('".concat(topDivElementId,"');\n    var iframe = document.getElementById('").concat(frameElementId,"');\n      console.log('The iframe to be removed', div, iframe);\n    var checkIframe = setInterval(function() {\n      if (!document.contains(iframe)) {\n      console.log('Doesnt contain The iframe to be removed', div, iframe);\n        try { div.remove(); } catch (e) {\n      console.log('Doesnt contain The iframe to be removed', e);\n        }\n        clearInterval(checkIframe);\n      }\n    }, 1000);\n    function iframeRemoved() {\n      console.log('The iframe has been removed!');\n    }\n  ");top.detectIframeRemoval=new top.Function(script),top.detectIframeRemoval()}catch(e){console.log("WHERE: The iframe has been removed!",e)}configID=div}top.ampTV.addConfig(configID,playerStorage);var playerId="content_video-"+(configID?configID.id:"undefined").replace(/,/g,"___"),shadowRoot=(void 0!==top.ampVideoBlogProcessed&&useShadowRoot&&configID&&(initialVideoWidth=configID.parentElement.clientWidth,initialVideoHeight=9*configID.parentElement.clientWidth/16),playerStorage.dispose=function(playerStorage){playerStorage.disposeCallback.forEach(function(x){return x()}),playerStorage.disposeCallback.splice(0)}.bind(window,playerStorage),playerStorage.getElementToObserveViewability=function(playerStorage){return useShadowRoot?playerStorage.rootDocument.querySelector(".vid-iframe-amp"):configID||playerStorage.rootDocument.defaultView.frameElement}.bind(window,playerStorage),playerStorage.getElementToFloat=function(playerStorage){return useShadowRoot?playerStorage.rootDocument.querySelector(".vid-iframe-amp"):configID||playerStorage.rootDocument.defaultView.frameElement}.bind(window,playerStorage),playerStorage.getElementToObtainSize=function(playerStorage){return playerStorage.getElementToFloat().parentElement}.bind(window,playerStorage),playerStorage.getElementToSetSize=function(playerStorage){return useShadowRoot?playerStorage.rootDocument.querySelector(".vid-iframe-amp .video-js"):playerStorage.getElementToFloat()}.bind(window,playerStorage),playerStorage.getParentElementToFloat=function(playerStorage){return playerStorage.getElementToFloat().parentElement}.bind(window,playerStorage),playerStorage.getVideoElementPlaceholder=function(playerStorage){return useShadowRoot?playerStorage.rootDocument.querySelector(".vid-iframe-amp-inner"):playerStorage.rootDocument.body}.bind(window,playerStorage),void 0!==playerStorage.rootDocument?playerStorage.rootDocument:null);if(!isVideoBlog){if(!shadowRoot&&configID&&(useShadowRoot?configID.shadowRoot?shadowRoot=configID.shadowRoot:(shadowRoot=configID.attachShadow({mode:"open"}),topDivElementId=(tracker=configID).id,frameElementId=document,script=tracker.shadowRoot.querySelector("html")||frameElementId.createElement("html"),he=tracker.shadowRoot.querySelector("head")||frameElementId.createElement("head"),script.querySelector("head")||script.appendChild(he),he=tracker.shadowRoot.querySelector("body")||frameElementId.createElement("body"),script.querySelector("body")||script.appendChild(he),tracker.shadowRoot.querySelector("html")||tracker.shadowRoot.appendChild(script),(tracker=frameElementId.createElement("div")).id="super"+topDivElementId,tracker.className="vid-iframe-parent",he.appendChild(tracker),(script=frameElementId.createElement("div")).id="parent"+topDivElementId,script.setAttribute("data-observe-resizes","data-observe-resizes"),tracker.appendChild(script),(he=frameElementId.createElement("div")).id=topDivElementId,he.className="vid-iframe-amp",script.appendChild(he),(tracker=frameElementId.createElement("div")).className="vid-iframe-amp-inner",tracker.style.position="relative",he.appendChild(tracker)):(shadowRoot=configID&&configID.contentDocument?configID.contentDocument:configID,((frameElement&&frameElement.contentDocument&&frameElement.contentDocument.querySelector("body")?frameElement.contentDocument.querySelector("body"):frameElement)||configID).setAttribute("data-observe-resizes","data-observe-resizes")),playerStorage.rootDocument=shadowRoot),"ResizeObserver"in self)for(var element,ro=new ResizeObserver(function(entries){var defaultBreakpoints={DZERO:0,D285:285,D320:320,D380:380,D425:425,D480:480,D520:520,D600:600,D640:640,D750:750,D854:854,D920:920,D1280:1280};entries.forEach(function(entry){var breakpoints=entry.target.dataset.breakpoints?JSON.parse(entry.target.dataset.breakpoints):defaultBreakpoints,minWidth=(Object.keys(breakpoints).forEach(function(breakpoint){var minWidth=breakpoints[breakpoint];entry.contentRect.width>=minWidth?entry.target.classList.add("GT-W"+breakpoint):entry.target.classList.remove("GT-W"+breakpoint),entry.contentRect.height>=minWidth?entry.target.classList.add("GT-H"+breakpoint):entry.target.classList.remove("GT-H"+breakpoint),entry.contentRect.width<=minWidth?entry.target.classList.add("LT-W"+breakpoint):entry.target.classList.remove("LT-W"+breakpoint),entry.contentRect.height<=minWidth?entry.target.classList.add("LT-H"+breakpoint):entry.target.classList.remove("LT-H"+breakpoint)}),entry.contentRect.width),bestWidth=void 0,minHeight=entry.contentRect.height,bestHeight=void 0;Object.keys(breakpoints).forEach(function(breakpoint){var size=breakpoints[breakpoint];minWidth<=size&&(void 0===bestWidth||breakpoints[bestWidth]<minWidth)&&(bestWidth=breakpoint),minHeight<=size&&(void 0===bestHeight||breakpoints[bestHeight]<minHeight)&&(bestHeight=breakpoint)}),Object.keys(breakpoints).forEach(function(breakpoint){breakpoint===bestWidth?entry.target.classList.add("EQ-W"+breakpoint):entry.target.classList.remove("EQ-W"+breakpoint),breakpoint===bestHeight?entry.target.classList.add("EQ-H"+breakpoint):entry.target.classList.remove("EQ-H"+breakpoint)})})}),elements=shadowRoot.querySelectorAll("[data-observe-resizes]"),i=0;element=elements[i];i++)ro.observe(element);(0,_phase.phase2Install)()}var openWrapOnInit,topDivElementId=window.location||document.location,options=function(defaultOptions,options){var optionsMerged=_objectSpread(_objectSpread({},defaultOptions),options);return options.avaSize||(optionsMerged.avaSize=defaultOptions.avaSize),optionsMerged}({styles:"",size:[],fluid:!1,autoPlay:!1,muted:!1,useBandwidthFromLocalStorage:!1,limitRenditionByPlayerDimensions:!0,poster:void 0,ytVideo:void 0,videoTitle:"",vidCoTitleHidden:!1,videoDescriptionURL:"",videoDescription:"",vidCoAdUnit:"",proxy:void 0,playList:[],playListKWs:void 0,playListUserInterface:"shown if CTP",allowPlayListOverride:!1,playListPreloadNum:2,delayPhase2:0,viewability:{vidCo:.6,vidAd:.99,ignoreViewabilityIfAboveScrollingPosition:!0,forceFirstPrerollEvenIfMissingVidAdViewability:!1,firstVidAdMilliseconds:2e3,minMillisecondsBetweenVidAds:3e3},vastURL:"",vidAdSpecial:"",vidAdTryToResumeVidCo:!0,vidAdOnFirstPreroll:!0,openwrapAccountId:0,openwrapProfileId:0,openwrapDelayVidAdUntilOwResponse:!1,openwrapMinCachedBids:0,amazonHeaderBidderAccountId:"",amazonHeaderBidderSlotIDs:"",adBreakOnlyPrerolls:!0,ava:!1,avaOnlyOnVidAd:!1,avaSize:{desktop:{width:534,height:300},mobile:{percentage:21}},avaForceStartOnLoad:!1,avaForceFloatedOnVidad:!1,avaCloseDelayOnVidAd:-1,avaCloseSize:void 0,vidCoImpressions:!0,vidCoAllowRepeatSameVideo:!1,closeVidCo:!1,closeVidCoSize:20,closeVidCoDelayedMS:!1,closeVidCoOnEnd:!1,closeVidCoOnAdEnd:!1,closeVidCoIfNoAd:!1,closeVidCoIfNoAdTimeoutMS:0,observers:{},enforceWhitelist:!1,whitelistedDomains:[],comScoreID:0,context:{},dev:!1,logLevel:3},(0,_publisher.checkAmpAffiliate)(!1,topDivElementId,configID,playerStorage)),script=(playerStorage.options=options,(0,_domainWhitelist.expandDomains)(options.whitelistedDomains));if(!(0,_domainWhitelist.isWhitelistedDomain)(topDivElementId.host,options.enforceWhitelist,script))try{var topLocation=top.location;if(!(0,_domainWhitelist.isWhitelistedDomain)(topLocation.host,options.enforceWhitelist,script))return void console.error("Ampliffy TV: Domain not whitelisted. Ask your sales contact in Ampliffy to add this domain to your Account:",topLocation.host,window.host)}catch(e){return void console.error("Ampliffy TV: Domain not whitelisted. Ask your sales contact in Ampliffy to add this domain to your Account:",window.location.host)}window.location.host.match(/gamestry.com$/)&&!gamestryProcessed&&(gamestryProcessed=!0,(frameElementId=new _gamestry.Gamestry(playerStorage)).adUnits=_gamestry.gamestryAdUnits,frameElementId.start(),openWrapOnInit=frameElementId.openWrapOnInit.bind(frameElementId)),top.ampTV.addConfig(configID,playerStorage);var vidCoObj,isDev,executePhase2,inserted,insert,he="https://gtm2.local.ampliffy.com/tests/AMPLIFFYPLAYER_INTEXT_IMA";!top.ampTV.css&&window.css&&!0!==window.css&&(top.ampTV.css=window.css),!top.ampTV.phase2&&window.phase2&&!0!==window.phase2&&(top.ampTV.phase2=window.phase2),!top.ampTV.phase3&&window.phase3&&!0!==window.phase3&&(top.ampTV.phase3=window.phase3);try{isDev&&(css=he+".css?%%CACHEBUSTER%%",window.phase2=top.ampTV.phase2=he+"_FASE2.js?%%CACHEBUSTER%%",window.phase3=top.ampTV.phase3=he+"_FASE3.js?%%CACHEBUSTER%%")}catch(e){}isDev&&isVideoBlog?((tracker=document.createElement("script")).async="async",tracker.className="phase-video-blog",tracker.src="https://gtm2.local.ampliffy.com/tests/AMPLIFFYPLAYER_INTEXT_IMA_VIDEO_BLOG.js",document.body.appendChild(tracker),top.ampTV.ampPhase1=ampPhase1):isVideoBlog?((topDivElementId=document.createElement("script")).async="async",topDivElementId.className="phase-video-blog",topDivElementId.src=videoBlogURL,document.body.appendChild(topDivElementId),top.ampTV.ampPhase1=ampPhase1):(console.log("options",options),playerStorage.options=options,vidCoObj=new _vidCo.vidCo(playerStorage.options,playerStorage),options.proxy?vidCoObj.proxy=options.proxy:((script=_construct(_isMobile.IsMobile,_toConsumableArray((0,_viewport.getTopViewPortSize)()))).isIOS()||script.isSafari())&&(console.warn("Activating VidCo Cookies Counter-measures"),vidCoObj.proxy="https://ads.ampliffy.com/gampad/no.php"),playerStorage.vidCoObj=vidCoObj,frameElementId=(topLocation=options.amazonHeaderBidderAccountId&&5<options.amazonHeaderBidderAccountId.length)?1:options.openwrapMinCachedBids,console.log("Amazon Active: ",topLocation,window.location.host,options.amazonHeaderBidderAccountId),he=options.amazonHeaderBidderSlotIDs&&options.amazonHeaderBidderSlotIDs.length?options.amazonHeaderBidderSlotIDs:"{}",playerStorage.amazonHeaderBidder=new _amazonHeaderBidder.AmazonHeaderBidder(top,topLocation?options.amazonHeaderBidderAccountId:0,_amazonHeaderBidder.AmazonHeaderBidder.parseSlotIds(he),options.autoPlay,options.muted,options.openwrapDelayVidAdUntilOwResponse,frameElementId),playerStorage.amazonHeaderBidder.setup(),isDev=new _openWrap.OpenWrap(top,-1980,options.openwrapDelayVidAdUntilOwResponse,options.openwrapMinCachedBids),openWrapOnInit&&openWrapOnInit(isDev),isDev.install(options.openwrapAccountId,options.openwrapProfileId),playerStorage.openWrap=isDev,playerStorage.vidAdQueue=new _queue.VidAdQueue(playerStorage,vidCoObj),playerStorage.vidAdQueue.observers.push(function(immediate){playerStorage.openWrap.minBidQueueLength<=0?immediate&&!playerStorage.openWrap.delay_vidad_until_ow_response?(0,_log.cLog)("AMP: OpenWrap: Avoiding to Delay VidAd"):((0,_log.cLog)("AMP: OpenWrap: About to prefetch a new VidAd:",JSON.parse(JSON.stringify(playerStorage.vidAdQueue.queue))),immediate=playerStorage.vidAdQueue.queue.pop(),playerStorage.openWrap.prefetch(immediate,function(x){return playerStorage.vidAdQueue.queue.push(x)})):playerStorage.vidAdQueue.queue.length<=0?(0,_log.cLog)("AMP: OpenWrap: Cannot apply prefetched to new VidAd: empty queue"):((0,_log.cLog)("AMP: OpenWrap: Applying already prefetched to new VidAd:",playerStorage.openWrap.minBidQueueLength,JSON.parse(JSON.stringify(playerStorage.vidAdQueue.queue))),(immediate=playerStorage.vidAdQueue.queue.pop())&&immediate.length&&(playerStorage.openWrap.sampleVastURL=immediate),playerStorage.vidAdQueue.queue.push(playerStorage.openWrap.applyBestBid(immediate)))}),topLocation&&playerStorage.vidAdQueue.observers.push(function(immediate){var _queueElement2;playerStorage.amazonHeaderBidder.minBidQueueLength<=0?immediate&&!playerStorage.amazonHeaderBidder.delay_vidad_until_ow_response?(0,_log.cLog)("AMP: amazonHeaderBidder: Avoiding to Delay VidAd"):((0,_log.cLog)("AMP: amazonHeaderBidder: About to prefetch a new VidAd:",JSON.parse(JSON.stringify(playerStorage.vidAdQueue.queue))),_queueElement2=playerStorage.vidAdQueue.queue.pop(),playerStorage.amazonHeaderBidder.fetch(function(){var vast=playerStorage.amazonHeaderBidder.applyBid(_queueElement2);playerStorage.vidAdQueue.queue.push(vast)})):playerStorage.vidAdQueue.queue.length<=0?(0,_log.cLog)("AMP: amazonHeaderBidder: Cannot apply prefetched to new VidAd: empty queue"):((0,_log.cLog)("AMP: amazonHeaderBidder: Applying already prefetched to new VidAd:",playerStorage.amazonHeaderBidder.minBidQueueLength,JSON.parse(JSON.stringify(playerStorage.vidAdQueue.queue))),immediate=playerStorage.vidAdQueue.queue.pop(),immediate=playerStorage.amazonHeaderBidder.applyBid(immediate),playerStorage.vidAdQueue.queue.push(immediate))}),playerStorage.openWrap.startBidQueueFiller(),inserted=!(executePhase2=function executePhase2(){var phase2Exec,force=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(!force&&"number"==typeof options.delayPhase2&&0<options.delayPhase2)return setTimeout(executePhase2.bind(null,!0),options.delayPhase2);if(!force&&"function"==typeof options.delayPhase2&&options.delayPhase2())return setTimeout(executePhase2,options.delayPhase2());try{void 0!==top.ampTV.ampPhase2&&(top.ampTV.ampPhase2(configID),phase2Exec=!0)}catch(e){}for(phase2Exec||addPhase2Script(configID,shadowRoot,top.ampTV.phase2||window.phase2);onPhase2.length;)try{onPhase2.shift()()}catch(e){console.error(e)}(0,_comScore2VideoJS.prepareComScore)(options.comScoreID,playerStorage)}),insert=function(thumbnailURL,shortMP4URL){var v,videoWidth,videoHeight,doPhase2=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];inserted||(inserted=!0,(v=document.createElement("video")).setAttribute("preload","preload"),v.setAttribute("playsinline","playsinline"),options.autoPlay&&v.setAttribute("autoplay","autoplay"),options.muted&&v.setAttribute("muted","muted"),v.setAttribute("poster",thumbnailURL),videoWidth=options.fluid&&initialVideoWidth&&initialVideoHeight?initialVideoWidth:options.size[0],videoHeight=options.fluid&&initialVideoWidth&&initialVideoHeight?initialVideoHeight:options.size[1],v.setAttribute("width",videoWidth),v.setAttribute("height",videoHeight),v.width=videoWidth,v.height=videoHeight,v.id=playerId,v.className="video-js vjs-default-skin vjs-big-play-centered content_video-dimensions content_video-"+playerId+"-dimensions vjs-controls-enabled vjs-workinghover vjs-v7 vjs-playlist-enabled vjs-user-inactive",v.poster=thumbnailURL,v.innerHTML='<source src="'+shortMP4URL+'" type="video/mp4">',playerStorage.getVideoElementPlaceholder(playerStorage).appendChild(v),(videoWidth=document.createElement("link")).rel="stylesheet",videoWidth.href=css,videoWidth.className="phase-css",(shadowRoot.querySelector("head")||shadowRoot).appendChild(videoWidth),(videoHeight=document.createElement("style")).innerHTML="body { margin: 0 }",(shadowRoot.querySelector("head")||shadowRoot).appendChild(videoHeight),(thumbnailURL=document.createElement("style")).innerHTML='@font-face {\n    font-family: AMPVideoJS;\n    src: url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAABBIAAsAAAAAGoQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADsAAABUIIslek9TLzIAAAFEAAAAPgAAAFZRiV3RY21hcAAAAYQAAADQAAADIjn098ZnbHlmAAACVAAACv4AABEIAwnSw2hlYWQAAA1UAAAAKgAAADYUHzoRaGhlYQAADYAAAAAbAAAAJA4DByFobXR4AAANnAAAAA8AAACE4AAAAGxvY2EAAA2sAAAARAAAAEQ9NEHGbWF4cAAADfAAAAAfAAAAIAEyAIFuYW1lAAAOEAAAASUAAAIK1cf1oHBvc3QAAA84AAABDwAAAZ5AAl/0eJxjYGRgYOBiMGCwY2BycfMJYeDLSSzJY5BiYGGAAJA8MpsxJzM9kYEDxgPKsYBpDiBmg4gCACY7BUgAeJxjYGQ7xTiBgZWBgaWQ5RkDA8MvCM0cwxDOeI6BgYmBlZkBKwhIc01hcPjI+FGBHcRdyA4RZgQRAC4HCwEAAHic7dFprsIgAEXhg8U61XmeWcBb1FuQP4w7ZQXK5boMm3yclFDSANAHmuKviBBeBPQ8ymyo8w3jOh/5r2ui5nN6v8sYNJb3WMdeWRvLji0DhozKdxM6psyYs2DJijUbtuzYc+DIiTMXrty4k8oGLb+n0xCe37ekM7Z66j1DbUy3l6PpHnLfdLO5NdSBoQ4NdWSoY9ON54mhdqa/y1NDnRnq3FAXhro01JWhrg11Y6hbQ90Z6t5QD4Z6NNSToZ4N9WKoV0O9GerdUJORPqkhTd54nJ1YDXBU1RV+576/JBs2bPYPkrDZt5vsJrv53V/I5mclhGDCTwgGBQQSTEji4hCkYIAGd4TGIWFAhV0RQTpWmQp1xv6hA4OTOlNr2zFANbHUYbq2OtNCpViRqsk+e+7bTQAhzti8vPfuPffcc88959zznbcMMPjHD/KDDGEY0ABpYX384NhlomIYlo4JISGEY9mMh2FSidYiqkEUphtNYDSY/dXg9023l4DdxlqUl0chuZRhncJKrsCQHIwcGuwfnhMIzBnuH4Sym+1D2zaGjheXlhYfD238z80mKYMmvJ5XeOTzd8z9eujbMxJNhu4C9xPE/bCMiDuSNIWgkTQwBE55hLSAE7ZwhrHLnAHZOGV/kmBGTiNjZxzI77Hb7Hqjz68TjT6vh+5JT/cCIkqS0D6CqPf5jX4Qjdx5j6vlDfZM4aZFdbVXIxtOlJaP/WottMnH6CJQ3bTiue3PrY23HjnChtuamxwvvzFjxkPrNj3z0tG9T561HDYf6OgmRWvlY3JQHoQb8ltV2Yet7YfWctEjR1AtxS/cSX6U4alf6NJEBQ7YKg9wrXQKd0IeZCb2ux75Uhh1Un+Nz+9LTOE7PK777nN5xqdTneTBhCbx446mZrhnUkrCz2YhA9dSMxaG0SYmT8hi9ZPu1E94PJYQSH6LRmhxec7Q7ZeXntgQuVpbh+a4qWNsckVyTdn0P7o7DpgPW84+uRcq0BITflBikGdUjAZ9wYBVI3mtrNvr9kpg1UsaK6t3690aoorC1lg0GpMH2HAMtkZjsSi5Ig9ESVosOh7GQfLjKNLvKpMKkLSKNFAka710GdgSi8oDMSoNhqjkKBXTgn3swtaxyzGkUzIzae9RtLdWkSlZ1KDX6EzgllzV4NV4SoDFSOGD4+HCeQUF8wrZ5Hs8zIb5EaVxy8DYFTbMCJPnLIWZxugZE2NlivC0gc1qEQUR8jEKgZcAXeH18BiCgl5nlHh0CrjB4Hb5fX4gb0J7c9PuHVsfgkx2n/vTY/JV8kn8PGxf7faOZ8qX8JVByuIf4whk9sqXli2hvPJV9hrp0hY7l8r2x37ydaVsb4xvXv/47v2NjfCl8m5oRDJclFMoE1yk0Uh1Te4/m8lFXe9qBZD0EkheicebXvzI2PLCuoKCukLuhPIeKwaHPEouxw3kMqaIUXDQ1p0mip+MyCORSCQaoUsnY1VZ38nUTrG21WvVo4f1OsEJFhvSfAFwGfT8VHRMeAVUpwLOoLzjT/REIj3O3FhuURE+nERF+0pTId5Fyxv5sfwGyg4O+my4vZv0sZm7oeQlFZORiB+tG0MweVNraeitl7yxiPIHTk4/diVxs94o5lEYishB2iAtkchEnsActoEpx44Fo8XnsQMaA22BlqC20RmhBKzYojZyYaxg+JggMc4HHY2m+L9EkWSYljirOisrO7d3VorxzyZ6Vc4lJqITAu1b2wOBdrLElAP+bFc2eGaZFVbkmJktv5uT6Jlz5D/MnBFor6ig/JPnRViBsV3LNKGGqB1ChJ0tgQywlVLFJIuQgTFttwkiKxhyQdAZMdMYtSaoAewqfvXVYPAbDT6/1mez85YS8FSDywQ6NfAnef6FNEGMilnppyvn5rB6tTyq1pOceRWnp2WJEZFXHeX5oyoem1nTTgdqc4heDY7bOeKz63vnz+/dRx+s31Ht2JGanQ5seirfWJL9tjozU/12TnEjn5oux9OzU3ckGbBzBwNOyk69JykKH0n/0LM9A72tuwM3zQpIRu4AxiToseEpgPOmbROyFe9/X2yeUvoUsCyEvjcgs7fpWP3/aKlFN0+6HFUe6D9HFz/XPwBlN9tTqNyZjFJ8UO2RUT5/h4CptCctEyeisnOyXjALEp7dXKaQKf6O7IMnGjNNACRMLxqdYJX8eMLvmmd68D+ayBLyKKYZwYxDt/GNhzETDJ05Qxlyi3pi3/Z93ndYVSumgj0V/KkIFlO6+1K3fF2+3g0q+YtuSIf0bvmLqV09nnobI6hwcjIP8aPCKayjsF5JBY3LaKAeRLSyYB1h81oTwe9SlPMkXB7G0mfL9q71gaqqwPqu67QRKS1+ObTx+sbQy9QV2OQHEScGkdFBeT7v7qisqqrs6N52i78/R+6S0qQONVj26agOVoswCyQWIV5D86vH53bxNUeXV0K+XZaHv/nm/KsHhOvylwsWnJX/HE8l/4WCv5x+l5n08z6UU8bUMa3MBpSmM7F63AxntdC9eBCKEZW9Hr+ABNqtxgAQrSbMtmrW7lKQuoSgBhSrTazWVU2QAKWY8wiiuhqFmQgWJBgoXiuWIm42N7hqZbBsgXz52O5P5uSvaNgFGnOuvsRw8I8Laha91wMvDuxqWFheN7/8GVtTltdS83DQsXRmqc5ZtcJXEVrlV2doTWk5+Yunm71dG5f55m/qY0MjI93vv9/NfpxXV9sUXrxy2fbNy1or65cOlDRnOoKFeeXcbw42H/bNDT5Qs3flgs31gWC1lD1nfUV/X7NdCnSUdHY2e8afzfKsqZ5ZljfDqjLOmk3UebNXB+aHArPYDRs+/HDDxeT5DiP+sFg7OpRaVQMGBV89PpeBdj22hCE0Uub0UqwLrNWsG0cuyadgLXTeR5rbO4+3c/vl15cur2nRq+TXCQDcS3SO+s6ak+e5/eMS+1dw3btu3YG2tvFL8XdIZvdjdW6TO/4B7IdrZWVPmctm5/59AgsPItTSbCiIBr2OqIGzmu20SMKAS7yqwGBUfGfgjDYlLLDeF0SfcLB2LSx8flT+08/kzz6yOj96rft4rpTjdPQcmLd47uKibbDq7ZSz/XtbH2nN717Nd62rU+c8Icevvv7I09wA6WvjVcafb+FsbNG+ZQ80Rn6ZZsvrP7teP2dzTdoETvNhjCmsr8FID2sJ69VYvdUcxk4AzYRlKcaE38eXNRlfW9H1as9i6acLHp1XpuNB5K7DIvkX08y1ZYvh3KfWaiCzH+ztrSDmD7LuX73x/mJelB8Yj39t8nhNQJJ2CAthpoFGLsGgtSOCJooCGoaJAMTjSWHVZ08YAa1Fg9lPI5U6DOsGVjDasJeZZ+YyhfCwfOzCxlBA69M9XLXtza7H/rav+9Tjq5xNi0wpKQIRNO4Lrzz7yp5QVYM6Jd/oc1Uvn/mQhhuWh6ENXoS2YTZ8QT42bF5d/559zp5r0Uff2VnR2tdf2/WCOd2cO0Mw6qpWPnvxpV0nrt5fZd2yItc199GWe8vlNfNDq+CH/7yAAnB9hn7T4QO4c1g9ScxsZgmzntnE/IDGndtHMw69lFwoCnYsMGx+rBp8JSBqdLzBr9QRPq/PbhWMWFtQZp1xguy/haw3TEHm3TWAnxFWQQWgt7M5OV0lCz1VRYucpWliy7z6Zd4urwPIyeZQqli2Lgg7szJV09PysATbOQtYIrB2YzbkJYkGgJ0m4AjPUap1pvYu1K9qr97z0Yl3p332b2LYB78ncYIlRkau/8GObSsOlZancACE5d5ily+c2+7h5Yj4lqhVmXXB+iXLfvdqSgqfKtQvfHDV0OnvQR1qhw42XS/vkvsh/hXcrDFP0a+SJNIomEfD1nsrYGO+1bgTOJhM8Hv6ek+7vVglxuSRwoKn17S937bm6YJCeSSG0Op1n+7tE37tcZ/p7dsTv4EUrGpDbWueKigsLHhqTVsoEj+JU0kaSjnj9tz8/gryQWwJ9BcJXBC/7smO+I/IFURJetFPrdt5WcoL6DbEJaygI8CTHfQTjf40ofD+DwalTqIAAHicY2BkYGAA4uByr8R4fpuvDNzsDCBw7f/3LmSanREszsHABKIAKi0J7gAAeJxjYGRgYGcAARD5/z87IwMjAypQBAAtgwI4AHicY2BgYGAfYAwAOkQA4QAAAAAAAA4AaAB+AMwA4AECAUIBbAGYAcICGAJYArQC4AMwA7AD3gQwBJYE3AUkBWYFigYgBmYGtAbqB1gIEghYCG4IhHicY2BkYGBQZChlYGcAASYg5gJCBob/YD4DABfTAbQAeJxdkE1qg0AYhl8Tk9AIoVDaVSmzahcF87PMARLIMoFAl0ZHY1BHdBJIT9AT9AQ9RQ9Qeqy+yteNMzDzfM+88w0K4BY/cNAMB6N2bUaPPBLukybCLvleeAAPj8JD+hfhMV7hC3u4wxs7OO4NzQSZcI/8Ltwnfwi75E/hAR7wJTyk/xYeY49fYQ/PztM+jbTZ7LY6OWdBJdX/pqs6NYWa+zMxa13oKrA6Uoerqi/JwtpYxZXJ1coUVmeZUWVlTjq0/tHacjmdxuL90OR8O0UEDYMNdtiSEpz5XQGqzlm30kzUdAYFFOb8R7NOZk0q2lwAyz1i7oAr1xoXvrOgtYhZx8wY5KRV269JZ5yGpmzPTjQhvY9je6vEElPOuJP3mWKnP5M3V+YAAAB4nG2PyXLCMBBE3YCNDWEL2ffk7o8S8oCnkCVHC5C/jzBQlUP6IHVPzYyekl5y0iL5X5/ooY8BUmQYIkeBEca4wgRTzDDHAtdY4ga3uMM9HvCIJzzjBa94wzs+8ImvZNAq8TM+HqVkKxWlrQiOxjujQkNlEzyNzl6Z/cU2XF06at7U83VQyklLpEvSnuzsb+HAPnPfQVgaupa1Jlu4sPLsFblcitaz0dHU0ZF1qatjZ1+aTXYCmp6u0gSvWNPyHLtFZ+ZeXWVSaEkqs3T8S74WklbGbNNNq4LL4+CWKtZDv2cfX8l8aFbKFhEnJnJ+IULFpqwoQnNHlHaVQtPBl+ypmbSWdmyC61KS/AKZC3Y+AA==) format("woff");\n    font-weight: 400;\n    font-style: normal\n}\n',top.document.head.appendChild(thumbnailURL)),doPhase2&&executePhase2()},options.playList.items&&options.playList.items.length&&vidCoObj.addItemsToPlaylist(playerStorage.options.playList.items,!1),function checkValues(){var tryNum=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,thumbnailURL=!1,shortMP4URL=!1;vidCoObj.playList.forEach(function(x){x.thumbnail&&x.thumbnail.length&&x.thumbnail[0].src&&x.sources&&x.sources.first15&&(thumbnailURL=x.thumbnail[0].src,shortMP4URL=x.sources.first15)}),thumbnailURL&&shortMP4URL?(insert(thumbnailURL,shortMP4URL,!1),0===tryNum&&vidCoObj.resolveMissing(options.size,function(x){executePhase2()},function(){return setTimeout(function(){return checkValues(1)},1e3)},1)||executePhase2()):options.playListKWs?vidCoObj.resolveMissing(options.size,function(x){checkValues(1)},function(){return setTimeout(checkValues,1e3)},1)||vidCoObj.addNewItemBasedOnKeywords(options.vidCoAdUnit,options.size,options.playListKWs,function(){return checkValues(1)},function(){return setTimeout(checkValues,1e3)}):insert(thumbnailURL,shortMP4URL)}())}var goAheadPhase1=!0;try{window.location.search&&window.location.search.match(/[?&]amp_dev=1/)&&!document.querySelector("script.phase-1-dev")&&((sr=document.createElement("script")).className="phase-1-dev",sr.src="https://gtm2.local.ampliffy.com/tests/AMPLIFFYPLAYER_INTEXT_IMA_FASE1.js?%%CACHEBUSTER%%",document.body.appendChild(sr),goAheadPhase1=!1)}catch(e){console.log("Error "+e)}if(goAheadPhase1){var phase1Exec,sr=frameElement||document.currentScript||null;sr&&sr===frameElement&&(sr.id=sr.id.replace(/\//g,"_"));try{void 0===top.ampTV.ampPhase1&&(top.ampTV.ampPhase1=ampPhase1),sr&&top.ampTV.ampPhase1(sr),phase1Exec=!0}catch(e){}sr&&!phase1Exec&&ampPhase1(sr)}},{"./AMPLIFFYPLAYER_INTEXT_IMA_05.JS":45,"./analytics/comScore2VideoJS":46,"./browser/absolutePosition":47,"./browser/shadowDOM":52,"./container/playerSize":56,"./dom/isMobile":59,"./dom/viewport":60,"./gamestry":61,"./log/log":62,"./phase-2":66,"./player/domainWhitelist":69,"./publisher":76,"./vidAd/amazonHeaderBidder":80,"./vidAd/openWrap":81,"./vidAd/queue":82,"./vidCo/vidCo":88}],66:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.phase2Install=function(){top.ampTV=top.ampTV||{},top.ampTV.ampPhase2Setup=phase2Setup};var _playlist=require("./vidCo/playlist15"),_title=require("./vidCo/title"),_timePlaying=require("./timer/timePlaying"),_viewability=require("./viewability/viewability"),_playStateObserver=require("./player/playStateObserver"),_playListEnded=require("./player/playListEnded"),_adsManager=require("./player/adsManager"),_trackAdRequestDone=require("./player/trackAdRequestDone"),_playlistHidden=require("./vidCo/playlistHidden"),_fluid=require("./container/fluid"),_vidAdCoSizes=require("./player/vidAdCoSizes"),_visible=require("./observer/visible"),_viewabilityState=require("./viewability/viewabilityState"),_timeOutFirstAd=require("./vidAd/timeOutFirstAd"),_log=require("./log/log");function addPhase3Script(configID,phase3src,rootDocument){var sr=document.createElement("script");sr.id="phase3",document.getElementById(sr.id)||(sr.async="async",sr.className="phase-3",0!==configID&&(sr.onload=function(configID){top.ampTV.ampPhase3(configID)}.bind(window,configID)),sr.src=phase3src,(rootDocument.querySelector("body")||rootDocument.body||rootDocument).appendChild(sr))}var ampPhase2=function ampPhase2(configID){top.ampTV=top.ampTV||{},top.ampTV.ampPhase2=ampPhase2;var playerStorage=top.ampTV.getConfigByElement(configID).data,playerId="content_video-"+configID.id.replace(/,/g,"___"),videoEl=playerStorage.rootDocument.querySelector("video"),videojs=(playerStorage.videoEl=videoEl,frameElement&&!window.useShadowRoot?top.ampTV.rootDocument=void 0:top.ampTV.rootDocument=playerStorage.rootDocument,top.ampTV.videojs),vPlayList=(0,_playlist.getFirst15)(playerStorage.vidCoObj.playList),installPlayList=top.ampTV.installPlayList,autoplay=void 0!==playerStorage.options.autoPlay?playerStorage.options.autoPlay:void 0===playerStorage.autoplay||!!playerStorage.autoplay,start_in_autoplay=autoplay,videoJSOptions=(playerStorage.force_ava=playerStorage.options.avaForceStartOnLoad,autoplay&&((start_in_autoplay=(0,_visible.aboveScrollingPosition)(playerId,playerStorage.rootDocument)&&playerStorage.options.viewability.ignoreViewabilityIfAboveScrollingPosition||(0,_visible.isVidAfInViewport)(playerId,playerStorage.rootDocument)?start_in_autoplay:!1)||playerStorage.rootDocument.getElementById(playerId).removeAttribute("autoplay"),playerStorage.options.ava)&&"disabled"!==playerStorage.options.ava&&playerStorage.options.viewability.ignoreViewabilityIfAboveScrollingPosition&&(0,_visible.aboveScrollingPosition)(playerId,playerStorage.rootDocument)&&start_in_autoplay&&(playerStorage.force_ava=!0),playerStorage.videojs=videojs,{controls:!0,autoplay:start_in_autoplay,duration:112,src:videoEl.src,poster:videoEl.poster,html5:{hls:{limitRenditionByPlayerDimensions:playerStorage.options.limitRenditionByPlayerDimensions,useDevicePixelRatio:!0,handlePartialData:!0,overrideNative:!1,useBandwidthFromLocalStorage:playerStorage.options.useBandwidthFromLocalStorage},vhs:{limitRenditionByPlayerDimensions:playerStorage.options.limitRenditionByPlayerDimensions,useDevicePixelRatio:!0,handlePartialData:!0,overrideNative:!1,useBandwidthFromLocalStorage:playerStorage.options.useBandwidthFromLocalStorage}}});"IFRAME"!==configID.nodeName||window.useShadowRoot?top.ampTV.rootDocument=playerStorage.rootDocument:top.ampTV.rootDocument=configID.contentDocument,playerStorage.player=videojs(playerId,videoJSOptions);try{playerStorage.player.qualityLevels()}catch(e){console.log("Error in qualityLevels",e)}playerStorage.amazonHeaderBidder.setPlayer(function(){return playerStorage.player.autoplay()},function(){return playerStorage.player.muted()}),playerStorage.playerSize.setPlayerResize(function(w,h){if(playerStorage.player){var elementToObtainSize,doResizeIma=!1;if((2<=Math.abs(playerStorage.player.width()-w)||2<=Math.abs(playerStorage.player.height()-h))&&(playerStorage.player.width(w),playerStorage.player.height(h),doResizeIma=!0),doResizeIma||"function"!=typeof playerStorage.getElementToObtainSize||(elementToObtainSize=(elementToObtainSize=playerStorage.getElementToObtainSize()).querySelector&&elementToObtainSize.querySelector(".video-js"))&&""!==elementToObtainSize.style.width&&20<Math.abs(parseInt(elementToObtainSize.style.width)-h)&&(elementToObtainSize.style.width=w+"px",elementToObtainSize.style.height=h+"px",doResizeIma=!0),doResizeIma)try{playerStorage.player.ima.getAdsManager().resize(w,h,"NORMAL")}catch(e){(0,_log.cLog)("AdsManager not set",e)}}}),playerStorage.getActualVidAdCoSize=function(){return playerStorage.options.size};function prepareFirstAd(){setTimeout(function(){try{playerStorage.vidAdQueue.prepareAdTag(!1)}catch(e){(0,_log.cLog)("AMP: OpenWrap: Error prefetching:"+e)}},10),playerStorage.vidCoObj.observers=playerStorage.vidCoObj.observers.filter(function(x){return x!==prepareFirstAd})}var fluidObserver;playerStorage.vidCoObj.playList.length?prepareFirstAd():playerStorage.vidCoObj.observers.push(prepareFirstAd),playerStorage.options.fluid&&(playerId=playerStorage.getElementToObtainSize(),(videoJSOptions=document.createElement("div")).style.position="absolute",videoJSOptions.style.width="100%",videoJSOptions.style.height="100%",videoJSOptions.style.top="0",videoJSOptions.style.left="0",videoJSOptions.style.right="0",videoJSOptions.style.bottom="0",videoJSOptions.style.maxHeight="500px",videoJSOptions.style.pointerEvents="none",playerId.appendChild(videoJSOptions),playerStorage.useShadowRoot||((fluidObserver=new _fluid.FluidObserver(videoJSOptions)).addFluidObserver(function(){var elementToFloat=playerStorage.getElementToSetSize();(0,_log.cLog)("RESIZE: ",playerStorage.player.id(),"lastWidth:",fluidObserver.lastWidth,"lastHeight:",fluidObserver.lastHeight," Now:",playerStorage.player.width(),"x",playerStorage.player.height()),playerStorage.player.width(fluidObserver.lastWidth),playerStorage.player.height(fluidObserver.lastHeight),"IFRAME"===elementToFloat.nodeName?(elementToFloat.width=fluidObserver.lastWidth,elementToFloat.height=fluidObserver.lastHeight):(elementToFloat.style.width=fluidObserver.lastWidth+"px",elementToFloat.style.height=fluidObserver.lastHeight+"px")}.bind(this)),fluidObserver.addFluidObserver(_vidAdCoSizes.checkVidAdCoSizes.bind(this,function(){return[fluidObserver.lastWidth,fluidObserver.lastHeight]},playerStorage.getActualVidAdCoSize)),fluidObserver.fixFluidViaJS(),fluidObserver.installFluidIntervalChecker()));function updateTimeControls(){(timeControls=timeControls||document.querySelector(".vjs-duration"))&&(timeControls.style.display=timeControlsHidden?"none":"inherit")}var timeControls,timeControlsHidden=!0;updateTimeControls(),setTimeout(updateTimeControls,1);try{start_in_autoplay&&videoEl.play()}catch(e){}playerStorage.playerState=new _playStateObserver.playStateObserver(playerStorage.options.autoPlay,playerStorage.options.muted,playerStorage.options.observers),playerStorage.playerState.adManager=new _adsManager.AdsManager(playerStorage.player,playerStorage,function(){throw"Calling getAdTag too soon"},_trackAdRequestDone.trackAdRequestDoneFactory.bind(this,playerStorage.player,playerStorage.playerState),playerStorage.options.observers),autoplay&&!start_in_autoplay&&(playerStorage.playerState.shouldBePlaying=!0),(0,_viewabilityState.install)(playerStorage.playerState,playerStorage.options,configID.id,playerStorage.rootDocument,function(){return playerStorage.player.paused()}),0<playerStorage.options.closeVidCoIfNoAdTimeoutMS&&(0,_timeOutFirstAd.installFirstAdTimeout)(playerStorage.options.closeVidCoIfNoAdTimeoutMS,playerStorage.playerState.adManager,playerStorage.playerState),(0,_playListEnded.install)(playerStorage.player,playerStorage.playerState);var phase3Exec,viewabilityControls=new _viewability.Viewability,playerId=(viewabilityControls.setupViewabilityControls(playerStorage),playerStorage.player.on("volumechange",function(){playerStorage.playerState.muted=playerStorage.player.muted()}),playerStorage.player.on("useractive",function(){playerStorage.playerState.playingVidCo&&playerStorage.player.paused(),playerStorage.playerState.userActive=!0}),playerStorage.player.on("userinactive",function(){playerStorage.playerState.userActive=!1}),playerStorage.playerState.observe("playListEnded",function(){}),playerStorage.options.closeVidCoOnEnd&&playerStorage.playerState.observe("playListEnded",function(){playerStorage.playerState.signalObservers("closedVidCo"),playerStorage.playerState.signalObservers("closeVidCo")}),playerStorage.timePlaying=new _timePlaying.TimePlaying(playerStorage.player),{hideOnStart:"hidden"===playerStorage.options.playListUserInterface||"collapsed"===playerStorage.options.playListUserInterface});"hidden"===playerStorage.options.playListUserInterface&&(0,_playlistHidden.hide)(playerStorage.rootDocument),installPlayList(vPlayList,videojs,playerStorage.player,playerStorage,playerId,playerStorage.rootDocument,top),!0!==playerStorage.options.vidCoTitleHidden&&(0,_title.title)(playerStorage.rootDocument,playerStorage.rootDocument.getElementById(playerStorage.player.id()),playerStorage.player),playerStorage.onTimeUpdate=function(){var i=this.playlist.currentItem();vPlayList&&i<vPlayList.length&&vPlayList[i]&&vPlayList[i].duration&&this.duration()<16&&15<vPlayList[i].duration&&Math.round(this.duration())!==Math.round(vPlayList[i].duration)&&this.duration(vPlayList[i].duration),timeControlsHidden=!1,updateTimeControls()},playerStorage.player.on("timeupdate",playerStorage.onTimeUpdate),playerStorage.player.ready(function(){(0,_log.cLog)("Init ads",this.ads),"function"==typeof this.ads?this.ads():!this.ads&&top.ampTV.videojs.getPlugin("ads")&&top.ampTV.videojs.getPlugin("ads").call(this)}),start_in_autoplay?playerStorage.player.one("playing",function(){return viewabilityControls.install(playerStorage.getElementToObserveViewability(),playerStorage.disposeCallback,playerStorage.player,playerStorage.options,playerStorage.playerState,playerStorage.options.viewability.vidCo,playerStorage.options.viewability.vidAd)}):viewabilityControls.install(playerStorage.getElementToObserveViewability()||document.body,playerStorage.disposeCallback,playerStorage.player,playerStorage.options,playerStorage.playerState,playerStorage.options.viewability.vidCo,playerStorage.options.viewability.vidAd,playerStorage.options.viewability.firstVidAdMilliseconds,playerStorage.options.viewability.minMillisecondsBetweenVidAds);try{void 0!==top.ampTV.ampPhase3&&(top.ampTV.ampPhase3(configID),phase3Exec=!0)}catch(e){}phase3Exec||(videoJSOptions="https://gtm2.local.ampliffy.com/tests/AMPLIFFYPLAYER_INTEXT_IMA_FASE3.js",playerStorage.options.dev||("string"==typeof playerStorage.phase3?videoJSOptions=playerStorage.phase3:"string"==typeof top.ampTV.phase3?videoJSOptions=top.ampTV.phase3:"string"==typeof window.phase3&&(videoJSOptions=window.phase3)),addPhase3Script(configID,videoJSOptions,playerStorage.rootDocument));try{"function"==typeof top.ampVidAfCustomize&&(void 0===playerStorage.rootDocument.createElement&&(playerStorage.rootDocument.createElement=document.createElement.bind(document)),playerStorage.rootDocument.createTextNode=document.createTextNode.bind(document),top.ampVidAfCustomize(playerStorage.rootDocument,playerStorage,playerStorage.options))}catch(e){(0,_log.cLog)("Amp.VidAf.UI.style ERROR",e)}playerStorage.options.dev&&((videoEl=document.createElement("script")).id="amp-dev",document.getElementById(videoEl.id)||(videoEl.async=!0,videoEl.className="phase-2-dev",videoEl.src="https://gtm2.local.ampliffy.com/tests/AMPLIFFYPLAYER_INTEXT_IMA_FASE2DEV.js",(playerStorage.rootDocument.querySelector("body")||playerStorage.rootDocument.body||playerStorage.rootDocument).appendChild(videoEl)))};function phase2Setup(){var phase2Exec,configID=frameElement&&void 0!==window.configID?window.configID:void 0;try{top.ampTV=top.ampTV||{},top.ampTV.ampPhase2=ampPhase2,configID&&(top.ampTV.ampPhase2(configID),phase2Exec=!0)}catch(e){}configID&&!phase2Exec&&ampPhase2(configID),0!==configID||phase2Exec||(top.ampTV.ampPhase2=ampPhase2,configID=top.ampTV.videojs,(phase2Exec=document.createElement("video")).id="p990",document.body.appendChild(phase2Exec),frameElement&&!window.useShadowRoot?top.ampTV.rootDocument=void 0:top.ampTV.rootDocument=document,window.player=configID(phase2Exec.id,null,function(x){(0,_log.cLog)("Init ads",window.player.ads),"function"==typeof window.player.ads?window.player.ads():!window.player.ads&&top.ampTV.videojs.getPlugin("ads")&&top.ampTV.videojs.getPlugin("ads").call(window.player)}),addPhase3Script(0,window.phase3,document))}},{"./container/fluid":55,"./log/log":62,"./observer/visible":64,"./player/adsManager":67,"./player/playListEnded":71,"./player/playStateObserver":73,"./player/trackAdRequestDone":74,"./player/vidAdCoSizes":75,"./timer/timePlaying":78,"./vidAd/timeOutFirstAd":83,"./vidCo/playlist15":84,"./vidCo/playlistHidden":85,"./vidCo/title":86,"./viewability/viewability":90,"./viewability/viewabilityState":91}],67:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.observables=exports.AdsManager=void 0;var _log=require("../log/log"),_bringGoogleIMAObjectsToThisWindow=require("./bringGoogleIMAObjectsToThisWindow");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}exports.observables={adManagerReady:[],errorVidAd:[],noVidAd:[],loadedVidAd:[],startedVidAd:[],endedVidAd:[],userClosedVidAd:[],wantingToPlayFirstPreroll:[],wantingToPlayAnAd:[]};require=function(){function AdsManager(player,playerStorage,getAdTag,trackerFactory){var _this=this,observers=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},instance=this,Constructor=AdsManager;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");this.player=player,this.playerStorage=playerStorage,this.getAdTag=getAdTag,this.tracker=trackerFactory,this._adManagerPrepared=!1,this._adManagerPluginInstalled=!1,this.adPrepared=!1,this.wantingToPlayAnAd=!1,this.wantingToPlayFirstPreroll=!1,this.playingAnAd=!1,this._userClosedVidAd=!1,this.observers=observers,this.player.on("adserror",function(e){return _this.errorVidAd(e)}),this.player.on("adstart",function(e){return _this.startedVidAd(e)}),this.player.on("adend",function(e){return _this.endedVidAd(e)}),this.player.on("adsready",function(e){return _this.loadedVidAd(e)}),player.one("adsready",function(){_this.adManagerPrepared=!0,(0,_log.cLog)("AdsManager Ready")}),setInterval(this.checkBugFix,1e3)}var Constructor,protoProps,staticProps;return Constructor=AdsManager,(protoProps=[{key:"prepareToLaunchFirstPreroll",value:function(options){return this.wantingToPlayAnAd||this.signalObservers("wantingToPlayAnAd"),this.wantingToPlayAnAd=!0,this.wantingToPlayFirstPreroll||this.signalObservers("wantingToPlayFirstPreroll"),this.wantingToPlayFirstPreroll=!0,void 0!==options.adsResponse&&delete options.adsResponse,options.adTagUrl=this.getAdTag(),this.tsLastAdLaunched=performance.now(),options}},{key:"setupAdsOnNextPreroll",value:function(){var _this2=this;this.wantingToPlayAnAd||this.signalObservers("wantingToPlayAnAd"),this.wantingToPlayAnAd=!0,this.player.one("contentchanged",function(e){(0,_log.cLog)("contentchanged",e),_this2.showRequestedAd()})}},{key:"requestAnAd",value:function(){return!!this._adManagerPrepared&&(this.updateMuteAutoPlay(),this.player.ima.changeAdTag(this.getAdTag()),this.adPrepared=!0)}},{key:"updateMuteAutoPlay",value:function(){var muted=this.player.muted(),volume=this.player.volume();try{var settings=this.player.ima.getSettings();settings.adsWillPlayMuted=0===volume||muted,settings.adsWillAutoplay=this.player.options().autoplay,(0,_log.cLog)("IMA settings: adsWillPlayMuted=>",settings.adsWillPlayMuted," adsWillAutoplay=>",settings.adsWillAutoplay)}catch(e){(0,_log.cLog)("Error in updateMuteAutoPlay: "+e)}}},{key:"showRequestedAd",value:function(){return!(!this.adPrepared&&!this.requestAnAd()||((0,_log.cLog)("showRequestedAd()"),this.wantingToPlayAnAd||this.signalObservers("wantingToPlayAnAd"),this.wantingToPlayAnAd=!0,this.player.ima.requestAds(),this.tsLastAdLaunched=performance.now(),0))}},{key:"errorVidAd",value:function(e){(0,_log.cLog)("noVidAd",e),(this.adPrepared=!1,_bringGoogleIMAObjectsToThisWindow.bringGoogleIMAObjectsToThisWindow)(),!this._adManagerPrepared&&e.data.AdError.getErrorCode()===window.google.ima.AdError.ErrorCode.VAST_EMPTY_RESPONSE&&(this.adManagerPrepared=!0,(0,_log.cLog)("Hack: AdsManager Ready"),void 0!==this.playerStorage.options.adsResponse)||(this.tsLastAdEnded=performance.now()),this.tsLastAdLaunched&&(this.signalObservers("errorVidAd"),this.signalObservers("noVidAd")),this.wantingToPlayAnAd=!1}},{key:"loadedVidAd",value:function(e){(0,_log.cLog)("loadedVidAd",e),this.signalObservers("loadedVidAd")}},{key:"startedVidAd",value:function(e){(0,_log.cLog)("startedVidAd",e),this.playingAnAd=!0,this.wantingToPlayAnAd=!1,this.adPrepared=!1,this._adManagerPrepared||(this.adManagerPrepared=!0),this.tsLastAdLaunched||(this.tsLastAdLaunched=performance.now()),this.signalObservers("startedVidAd")}},{key:"endedVidAd",value:function(e){(0,_log.cLog)("endedVidAd",e),this.tsLastAdEnded=performance.now(),this.playingAnAd=!1,this.adPrepared||this.requestAnAd(),this.signalObservers("endedVidAd")}},{key:"checkBugFix",value:function(){this._adManagerPrepared&&this.player.ads.isInAdMode()&&this.player.ads.isWaitingForAdBreak()&&((0,_log.cLog)("LAUNCHING BUGFIX"),this.player.ima.changeAdTag(null),this.player.ima.requestAds(),this.wantingToPlayAnAd)&&this.showRequestedAd()}},{key:"adManagerPrepared",get:function(){return this._adManagerPrepared},set:function(value){var modified=this._adManagerPrepared!==value;this._adManagerPrepared=value,modified&&value&&this.signalObservers("adManagerReady")}},{key:"userClosedVidAd",get:function(){return this._userClosedVidAd},set:function(value){var modified=this._userClosedVidAd!==value;this._userClosedVidAd=value,modified&&this.signalObservers("userClosedVidAd")}},{key:"observe",value:function(type,observer){this.observers[type]||(this.observers[type]=[]),this.observers[type].push(observer)}},{key:"signalObservers",value:function(type){(0,_log.cLog)("Signal ad observers: ",type),this.observers[type]&&this.observers[type].forEach(function(x){return x()})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),AdsManager}();exports.AdsManager=require},{"../log/log":62,"./bringGoogleIMAObjectsToThisWindow":68}],68:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bringGoogleIMAObjectsToThisWindow=function(){try{var loaded=!1;void 0===window.google&&void 0!==top.google&&(window.google=top.google,loaded=!0),loaded||void 0!==window.google&&void 0!==window.google.ima||void 0===top.google||void 0===top.google.ima||(window.google=top.google,loaded=!0)}catch(e){(0,_log.cLog)("Error in errorVidAd: "+e)}};var _log=require("../log/log")},{"../log/log":62}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.expandDomains=function(whitelist){for(var expandedWhitelist=[],i=0;i<whitelist.length;i++){var domain=whitelist[i];0===domain.indexOf("www.")?expandedWhitelist.push(domain.substr(4)):0===domain.indexOf("m.")&&expandedWhitelist.push(domain.substr(2)),expandedWhitelist.push(domain)}return expandedWhitelist},exports.isWhitelistedDomain=function(hostname,enforceWhitelist,whitelist){return!enforceWhitelist||-1!==whitelist.indexOf(hostname)||!!whitelist.some(function(item){return hostname.endsWith("."+item)})}},{}],70:[function(require,module,exports){"use strict";function isPlayingAnAd(player){return player.ads.isInAdMode()&&player.ads.isAdPlaying()&&!player.ads.isWaitingForAdBreak()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isFullyPaused=function(player){return!!player.paused()&&!isPlayingAnAd(player)},exports.isPlayingAnAd=isPlayingAnAd},{}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.install=install;var _log=require("../log/log");function install(player,playerState){function resetTimeOut(){player.off(["adstart","adsstart","play","playing"],resetTimeOut),timeOutWaitingForNextStart&&(clearTimeout(timeOutWaitingForNextStart),timeOutWaitingForNextStart=void 0)}var timeOutWaitingForNextStart,millisecondsToWaitForEnd=2<arguments.length&&void 0!==arguments[2]?arguments[2]:8e3,playListEnded=!1;player.on(["ended","error"],function checkEnded(e){function exec(){var playList,current;player&&"function"==typeof player.playlist?(playList=player.playlist(),!((current=player.playlist.currentIndex())<0)||playList&&playList.length?current>=playList.length-1&&(playListEnded=!0,(0,_log.cLog)("Mark PlayListEnded => playlist end reached",playerState,playList,current)):(playListEnded=!0,(0,_log.cLog)("Mark PlayListEnded => the playlist is empty",playerState))):(playListEnded=!0,(0,_log.cLog)("Mark PlayListEnded => there was just one video",playerState)),playListEnded?(playerState.playListEnded=!0,(0,_log.cLog)("Mark PlayListEnded",playerState),player.off("ended",checkEnded),player.one("playing",install.bind(null,player,playerState,millisecondsToWaitForEnd))):(resetTimeOut(),player.one(["adstart","adsstart","play","playing"],resetTimeOut),timeOutWaitingForNextStart=setTimeout(function(){playerState.playListEnded=!0,(0,_log.cLog)("Mark PlayListEnded due to timeout",playerState)},millisecondsToWaitForEnd))}e&&("error"===e.type?0===(e=player.error()).code||1===e.code||2===e.code?((0,_log.cLog)("NETWORK_ERROR. Fallback: Play next video on playlist",player),player.error(null),player.currentTime(0),player.playlist.next(),exec()):3!==e.code&&4!==e.code&&5!==e.code||(player.playlist.next(),exec()):exec())})}},{"../log/log":62}],72:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.playState=void 0;var playState=function(){function playState(autoPlay,muted){if(!(this instanceof playState))throw new TypeError("Cannot call a class as a function");this.autoPlay=autoPlay,this._muted=muted,this.hasPlayedAtLeastOnce=!1,this._playingVidCo=!1,this._playingVidAd=!1,this._playListEnded=!1,this.autoPlayDetectionCanAutoPlayWithSoundAnalysisDone=!1,this.autoPlayDetectionCanAutoPlayWithSoundAnalysisResult=!1,this.autoPlayDetectionCanAutoPlayMutedAnalysisDone=!1,this.autoPlayDetectionCanAutoPlayMutedAnalysisResult=!1,this.userWantsMuted=void 0,this.userWantsUnMuted=void 0,this._userClosedVidCo=!1,this.userActive=!1,this._adManagerPluginInstalled=!1}var Constructor,protoProps,staticProps;return Constructor=playState,(protoProps=[{key:"isMissingAutoPlay",value:function(){return!1!==this.autoPlay&&!this.hasPlayedAtLeastOnce&&(!(!this.autoPlayDetectionCanAutoPlayWithSoundAnalysisDone||!this.autoPlayDetectionCanAutoPlayWithSoundAnalysisResult)||!(!this.autoPlayDetectionCanAutoPlayMutedAnalysisDone||!this.autoPlayDetectionCanAutoPlayMutedAnalysisResult)||!(this._muted&&this.autoPlayDetectionCanAutoPlayMutedAnalysisDone&&!this.autoPlayDetectionCanAutoPlayMutedAnalysisResult||this.autoPlayDetectionCanAutoPlayWithSoundAnalysisDone&&this.autoPlayDetectionCanAutoPlayMutedAnalysisDone&&!this.autoPlayDetectionCanAutoPlayWithSoundAnalysisResult&&!this.autoPlayDetectionCanAutoPlayMutedAnalysisResult)&&void 0)}},{key:"getMustBeMuted",value:function(){return!0===this.userWantsMuted||!0!==this.userWantsUnMuted&&(!this.hasPlayedAtLeastOnce&&this.autoPlay?(!this.autoPlayDetectionCanAutoPlayWithSoundAnalysisDone||!this.autoPlayDetectionCanAutoPlayWithSoundAnalysisResult)&&(!(!this.autoPlayDetectionCanAutoPlayMutedAnalysisDone||!this.autoPlayDetectionCanAutoPlayMutedAnalysisResult)||(this._muted&&this.autoPlayDetectionCanAutoPlayMutedAnalysisDone&&!this.autoPlayDetectionCanAutoPlayMutedAnalysisResult||this.autoPlayDetectionCanAutoPlayWithSoundAnalysisDone&&this.autoPlayDetectionCanAutoPlayMutedAnalysisDone&&!this.autoPlayDetectionCanAutoPlayWithSoundAnalysisResult&&!this.autoPlayDetectionCanAutoPlayMutedAnalysisResult?this._muted:void 0)):this._muted)}},{key:"setHasPlayed",value:function(){this.hasPlayedAtLeastOnce=!0}},{key:"adManagerPluginInstalled",get:function(){return this._adManagerPluginInstalled},set:function(value){this._adManagerPluginInstalled=value}},{key:"playingVidCo",get:function(){return this._playingVidCo},set:function(value){this._playingVidCo=value}},{key:"playingVidAd",get:function(){return this._playingVidAd},set:function(value){this._playingVidAd=value}},{key:"playListEnded",get:function(){return this._playListEnded},set:function(value){this._playListEnded=value}},{key:"muted",get:function(){return this._muted},set:function(value){this._muted=value}},{key:"userClosedVidCo",get:function(){return this._userClosedVidCo},set:function(value){this._userClosedVidCo=value}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),playState}();exports.playState=playState},{}],73:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.playStateObserver=exports.observables=void 0;var _playState2=require("./playState"),_log=require("../log/log");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,Super=_getPrototypeOf(Derived),Super=(NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),this);if(NewTarget&&("object"===_typeof(NewTarget)||"function"==typeof NewTarget))return NewTarget;if(void 0!==NewTarget)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super)}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}exports.observables={init:[],ready:[],playListEnded:[],endedVidCo:[],startVidCo:[],userClosedVidCo:[],closeVidCo:[],closedVidCo:[],muted:[],unmute:[]};require=function(_playState){var subClass=playStateObserver;if("function"!=typeof _playState&&null!==_playState)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(_playState&&_playState.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),_playState&&_setPrototypeOf(subClass,_playState);var staticProps,_super=_createSuper(playStateObserver);function playStateObserver(autoPlay,muted,observers){if(this instanceof playStateObserver)return(autoPlay=_super.call(this,autoPlay,muted)).observers=observers||{},autoPlay.signalObservers("init"),autoPlay;throw new TypeError("Cannot call a class as a function")}return subClass=playStateObserver,(_playState=[{key:"adManagerPluginInstalled",get:function(){return this._adManagerPluginInstalled},set:function(value){var modified=this._adManagerPluginInstalled!==value;this._adManagerPluginInstalled=value,modified&&value&&this.signalObservers("ready")}},{key:"playingVidCo",get:function(){return this._playingVidCo},set:function(value){var modified=this._playingVidCo!==value;this._playingVidCo=value,modified&&value&&!this.playingVidAd&&this.signalObservers("startVidCo"),modified&&value&&!this.playingVidAd&&(this.playListEnded=!1),!modified||value||this.playingVidAd||this.signalObservers("endedVidCo")}},{key:"playListEnded",get:function(){return this._playListEnded},set:function(value){var modified=this._playListEnded!==value;this._playListEnded=value,modified&&value&&this.signalObservers("playListEnded")}},{key:"muted",get:function(){return this._muted},set:function(value){var modified=this._muted!==value;this._muted=value,modified&&value&&this.signalObservers("muted"),modified&&!value&&this.signalObservers("unmute")}},{key:"userClosedVidCo",get:function(){return this._userClosedVidCo},set:function(value){var modified=this._userClosedVidCo!==value;this._userClosedVidCo=value,modified&&this.signalObservers("userClosedVidCo"),modified&&this.signalObservers("closedVidCo"),modified&&this.signalObservers("closeVidCo")}},{key:"observe",value:function(type,observer){this.observers[type]||(this.observers[type]=[]),this.observers[type].push(observer)}},{key:"signalObservers",value:function(type){(0,_log.cLog)("Signal observers: ",type),this.observers[type]&&this.observers[type].forEach(function(x){return x()})}}])&&_defineProperties(subClass.prototype,_playState),staticProps&&_defineProperties(subClass,staticProps),Object.defineProperty(subClass,"prototype",{writable:!1}),playStateObserver}(_playState2.playState);exports.playStateObserver=require},{"../log/log":62,"./playState":72}],74:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TrackAdRequestDone=void 0,exports.trackAdRequestDoneFactory=function(player,playerState,relaunchAd,cbAdStarted,cbAdError){var millisecondsMaxWait=5<arguments.length&&void 0!==arguments[5]?arguments[5]:6e3,numRetries=6<arguments.length&&void 0!==arguments[6]?arguments[6]:3,millisecondsBetweenRetries=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1e3;return new TrackAdRequestDone(player,playerState,relaunchAd,cbAdStarted,cbAdError,millisecondsMaxWait,numRetries,millisecondsBetweenRetries)};var _log=require("../log/log"),_bringGoogleIMAObjectsToThisWindow=require("./bringGoogleIMAObjectsToThisWindow");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}var TrackAdRequestDone=function(){function TrackAdRequestDone(player,playerState,relaunchAd,cbAdStarted,cbAdError){var millisecondsMaxWait=5<arguments.length&&void 0!==arguments[5]?arguments[5]:6e3,numRetries=6<arguments.length&&void 0!==arguments[6]?arguments[6]:3,millisecondsBetweenRetries=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1e3,instance=this,Constructor=TrackAdRequestDone;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");this.player=player,this.playerState=playerState,this.relaunchAd=relaunchAd,this.cbAdStarted=cbAdStarted,this.cbAdError=cbAdError,this.numTries=0,this.numRetries=numRetries,this.millisecondsBetweenRetries=millisecondsBetweenRetries,this.waitForFeedBackBinded=this.waitForFeedback.bind(this),this.player.one(["adstart","adserror","playing"],this.waitForFeedBackBinded);millisecondsMaxWait&&(this.timeOutWaiting=setTimeout(function(myThis){return myThis.player.off(["adstart","adserror","playing"],myThis.waitForFeedBackBinded),myThis.timeOutWaiting=void 0,myThis.feedback(!1)}.bind(this,this),millisecondsMaxWait))}var Constructor,protoProps,staticProps;return Constructor=TrackAdRequestDone,(protoProps=[{key:"feedback",value:function(ok){return this.timeOutWaiting&&(clearTimeout(this.timeOutWaiting),this.timeOutWaiting=void 0),ok?this.cbAdStarted():this.cbAdError()}},{key:"waitForFeedback",value:function(e){return e?"adstart"===e.type?(this.timeOutRelaunch&&(clearTimeout(this.timeOutRelaunch),this.timeOutRelaunch=void 0),this.feedback(!0)):++this.numTries>this.numRetries?this.feedback(!1):"play"!==e.type&&"playing"!==e.type?((0,_bringGoogleIMAObjectsToThisWindow.bringGoogleIMAObjectsToThisWindow)(),e.data&&e.data.AdError&&e.data.AdError.getErrorCode()===window.google.ima.AdError.ErrorCode.UNKNOWN_AD_RESPONSE?(this.player.one(["adstart","adserror","playing"],this.waitForFeedBackBinded),this.timeOutRelaunch=setTimeout(this.relaunchAd,this.millisecondsBetweenRetries)):this.feedback(!1)):void(0,_log.cLog)("Last try due to content playing"):this.feedback(!1)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),TrackAdRequestDone}();exports.TrackAdRequestDone=TrackAdRequestDone},{"../log/log":62,"./bringGoogleIMAObjectsToThisWindow":68}],75:[function(require,module,exports){"use strict";function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{if(!_n&&null!=_i.return&&(_r=_i.return(),Object(_r)!==_r))return}finally{if(_d)throw _e}}return _arr}}(arr,i)||function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkVidAdCoSizes=function(getActualContainerSize,getActualVidAdCoSize){var allSizes,getActualContainerSize=_slicedToArray(getActualContainerSize(),2),w=getActualContainerSize[0],h=getActualContainerSize[1],actualVidAdCoSize=getActualVidAdCoSize();if(allSizesMobile.find(function(x){return x[0]===actualVidAdCoSize[0]&&x[1]===actualVidAdCoSize[1]}))allSizes=allSizesMobile;else{if(!allSizesDesktop.find(function(x){return x[0]===actualVidAdCoSize[0]&&x[1]===actualVidAdCoSize[1]}))throw"Invalid size "+actualVidAdCoSize[0]+"x"+actualVidAdCoSize[1]+" => not Mobile nor Desktop";allSizes=allSizesDesktop}var finalSize=allSizes[0];allSizes.forEach(function(_ref){var _ref=_slicedToArray(_ref,2),wT=_ref[0],_ref=_ref[1];wT<=w+2&&_ref<=h+2&&(finalSize=[wT,_ref])}),actualVidAdCoSize[0]=finalSize[0],actualVidAdCoSize[1]=finalSize[1]};var allSizesMobile=[[300,168],[320,180]],allSizesDesktop=[[426,240],[640,360],[854,480],[1280,720],[1920,1080]]},{}],76:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkAmpAffiliate=function(){var polluteWindowSpace=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],location=1<arguments.length?arguments[1]:void 0,configID=2<arguments.length?arguments[2]:void 0,playerStorage=3<arguments.length?arguments[3]:void 0,result={};try{var head,style,ampAffConfig=top.ampAffiliate.getConfig(window,configID),configurables=[["autoPlay","player_autoplay"],["autoPlay","player_hide_before_autoplay"],["muted","start_muted"],["muted","ytMuted"],["limitRenditionByPlayerDimensions","limitRenditionByPlayerDimensions"],["useBandwidthFromLocalStorage","useBandwidthFromLocalStorage"],["poster","videothumb"],["ytVideo","ytVideoId"],["videoTitle","title"],["vidCoTitleHidden","vidCoTitleHidden"],["videoDescriptionURL","video_description_url"],["videoDescription","video_description"],["videoDescription","evt_label"],["styles","jsStyles"],["vastURL","adTagUrlOrig"],["vidCoAdUnit","vidCoAdUnit"],["proxy","proxy"],["playList","playList"],["vidAdNonLinearAdMaxWidth","vidAdNonLinearAdMaxWidth"],["vidAdNonLinearAdMaxHeight","vidAdNonLinearAdMaxHeight"],["vidAdTryToResumeVidCo","vidAdTryToResumeVidCo"],["vidAdOnFirstPreroll","vidAdOnFirstPreroll"],["openwrapAccountId","openwrapAccountId"],["openwrapProfileId","openwrapProfileId"],["openwrapDelayVidAdUntilOwResponse","openwrapDelayVidAdUntilOwResponse"],["openwrapMinCachedBids","openwrapMinCachedBids"],["amazonHeaderBidderAccountId","amazonHeaderBidderAccountId"],["amazonHeaderBidderSlotIDs","amazonHeaderBidderSlotIDs"],["playListKWs","playListKWs"],["playListUserInterface","playListUserInterface"],["playListPreloadNum","playListPreloadNum"],["delayPhase2","delayPhase2"],["allowPlayListOverride","allowPlayListOverride"],["size","size"],["fluid","fluid"],["logLevel","logLevel"],["viewability","viewability"],["ava","ava"],["avaOnlyOnVidAd","avaOnlyOnVidAd"],["avaSize","avaSize"],["avaForceStartOnLoad","avaForceStartOnLoad"],["avaForceFloatedOnVidad","avaForceFloatedOnVidad"],["avaCloseDelayOnVidAd","avaCloseDelayOnVidAd"],["avaCloseSize","avaCloseSize"],["avaAvoidCLS","avaAvoidCLS"],["dev","dev"],["vidCoImpressions","vidCoImpressions"],["vidCoAllowRepeatSameVideo","vidCoAllowRepeatSameVideo"],["closeVidCo","closeVidCo"],["closeVidCoSize","closeVidCoSize"],["closeVidCoDelayedMS","closeVidCoDelayedMS"],["closeVidCoIfNoAd","closeVidCoIfNoAd"],["closeVidCoIfNoAdTimeoutMS","closeVidCoIfNoAdTimeoutMS"],["closeVidCoOnAdEnd","closeVidCoOnAdEnd"],["closeVidCoOnEnd","closeVidCoOnEnd"],["observers","observers"],["enforceWhitelist","enforceWhitelist"],["whitelistedDomains","whitelistedDomains"],["comScoreID","comScoreID"],["context","context"],["userOptions","userOptions"]];if(console.log("Loaded! ampAffConfig",ampAffConfig),void 0!==ampAffConfig.vidAf){!function(options,result){var recipient=options;"object"===_typeof(options.context)&&processContext(result,options.context);"object"===_typeof(options.userOptions)&&"object"===_typeof(options.userOptions.context)&&processContext(result,options.userOptions.context);if(options.userOptions){var sources,observers=options.userOptions.observers;if(observers&&(recipient.observers||(recipient.observers={}),_toConsumableArray(new Set([].concat(_toConsumableArray(Object.keys(_playStateObserver.observables)),_toConsumableArray(Object.keys(_adsManager.observables)),["avaClose"]))).forEach(function(x){observers[x]&&("function"==typeof observers[x]&&(observers[x]=[observers[x]]),recipient.observers[x]||(recipient.observers[x]=[]),recipient.observers[x]=[].concat(_toConsumableArray(observers[x]),_toConsumableArray(recipient.observers[x])))})),options.allowPlayListOverride&&options.userOptions.playList){options.playList&&options.playList.items&&options.playList.items[0]&&options.playList.items[0].sources&&(sources=options.playList.items[0].sources,options.userOptions.playList.items.forEach(function(item){item.sources.vidCoAdUnit=sources.vidCoAdUnit,sources.proxy&&(item.sources.proxy=sources.proxy),item.description_url=top.location.toString()})),(0,_log.cLog)("Before:",options.playList,"After:",options.userOptions.playList),options.playList=options.userOptions.playList;try{fillPlayList(options)}catch(e){(0,_log.cLog)(e)}(0,_log.cLog)("Finally:",options)}}}(ampAffConfig.vidAf,result);for(var i=0;i<configurables.length;i++)void 0!==ampAffConfig.vidAf[configurables[i][0]]&&(polluteWindowSpace&&(window[configurables[i][1]]=ampAffConfig.vidAf[configurables[i][0]]),result[configurables[i][0]]=ampAffConfig.vidAf[configurables[i][0]])}void 0!==result.styles&&(head=playerStorage.rootDocument.querySelector("head")||playerStorage.rootDocument.getElementsByTagName("head")[0],(style=document.createElement("style")).type="text/css",style.styleSheet?style.styleSheet.cssText=result.styles:style.appendChild(document.createTextNode(result.styles)),head.appendChild(style))}catch(e){console.log("ConfigErr",e)}try{var dev;location&&(dev=new URL(location.href).searchParams.get("amp_dev"),result.dev=Number(dev))}catch(e){(0,_log.cLog)(e)}return result},exports.fillPlayList=fillPlayList,exports.playList=exports.jsStyles=void 0;var _playStateObserver=require("./player/playStateObserver"),_adsManager=require("./player/adsManager"),_log=require("./log/log");function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function processContext(result,context){"string"==typeof context.section?(void 0===result.keywordsToAdd&&(result.keywordsToAdd=[]),result.keywordsToAdd.push(context.section)):"object"===_typeof(context.section)&&Array.isArray(context.section)&&(void 0===result.keywordsToAdd&&(result.keywordsToAdd=[]),result.keywordsToAdd.concat(context.section))}function fillPlayList(vidAf){var playList;return void 0===vidAf||!vidAf.playList||void 0===(playList=vidAf.playList).items||void 0===playList.items.length||playList.items.length<1||(playList=playList.items[0],vidAf.poster=playList.thumbnail[0].src,vidAf.ytVideo=playList.sources.ytVideo,vidAf.videoDescriptionURL=playList.description_url,vidAf.videoDescription=playList.name,playList.sources.proxy&&(vidAf.proxy=playList.sources.proxy),vidAf.vidCoAdUnit=playList.sources.vidCoAdUnit),vidAf}exports.playList=void 0,exports.jsStyles=void 0},{"./log/log":62,"./player/adsManager":67,"./player/playStateObserver":73}],77:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _defineProperty(obj,key,value){(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}function _toPropertyKey(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.DocumentVisibility=void 0;var DocumentVisibility=function(){function DocumentVisibility(){if(!(this instanceof DocumentVisibility))throw new TypeError("Cannot call a class as a function")}var Constructor,protoProps,staticProps;return Constructor=DocumentVisibility,staticProps=[{key:"setup",value:function(){document.addEventListener("visibilitychange",DocumentVisibility.handleVisibilityChange,!1)}},{key:"handleVisibilityChange",value:function(){document.hidden?DocumentVisibility.stopVisibilityObservers.forEach(function(x){return x()}):DocumentVisibility.startVisibilityObservers.forEach(function(x){return x()})}}],(protoProps=null)&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),DocumentVisibility}();_defineProperty(exports.DocumentVisibility=DocumentVisibility,"startVisibilityObservers",[]),_defineProperty(DocumentVisibility,"stopVisibilityObservers",[])},{}],78:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.TimePlaying=void 0;var TimePlaying=function(){function TimePlaying(player){if(!(this instanceof TimePlaying))throw new TypeError("Cannot call a class as a function");this.tsSetup=performance.now(),this.tsStartContent=void 0,this.tsLastStartContent=void 0,this.tsLastStartAd=void 0,this.timePlayingContent=0,this.timePlayingAds=0,player.on("playing",this.handlePlayingEvent.bind(this)),player.on("pause",this.handleEndedEvent.bind(this)),player.on("ended",this.handleEndedEvent.bind(this)),player.on("adplaying",this.handleAdPlayingEvent.bind(this)),player.on("adpause",this.handleAdEndedEvent.bind(this)),player.on("adended",this.handleAdEndedEvent.bind(this))}var Constructor,protoProps,staticProps;return Constructor=TimePlaying,(protoProps=[{key:"handlePlayingEvent",value:function(){this.tsStartContent||(this.tsStartContent=performance.now()),this.tsLastStartContent=performance.now()}},{key:"handleEndedEvent",value:function(){this.tsLastStartContent&&(this.timePlayingContent+=performance.now()-this.tsLastStartContent)}},{key:"handleAdPlayingEvent",value:function(){this.tsLastStartAd=performance.now()}},{key:"handleAdEndedEvent",value:function(){this.tsLastStartAd&&(this.timePlayingAds+=performance.now()-this.tsLastStartAd)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),TimePlaying}();exports.TimePlaying=TimePlaying},{}],79:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Timer=void 0;var Timer=function(){function Timer(){var on=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,ts=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,instance=this,Constructor=Timer;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");this.on=on,this.tsLastTransition=void 0!==ts?ts:performance.now(),this.timeOn=0,this.timeOff=0,this.observers=[]}var Constructor,protoProps,staticProps;return Constructor=Timer,(protoProps=[{key:"switchOn",value:function(){var _this=this;this.on||(this.paused||this.timePassesAsOff(),this.on=!0,this.paused)||this.observers.forEach(function(x){return x(_this)})}},{key:"switchOff",value:function(){var _this2=this;!this.on&&void 0!==this.on||(this.paused||this.timePassesAsOn(),this.on=!1,this.paused)||this.observers.forEach(function(x){return x(_this2)})}},{key:"timePassesAsOn",value:function(){var now=performance.now();void 0!==this.on&&(this.timeOn+=now-this.tsLastTransition),this.tsLastTransition=now}},{key:"timePassesAsOff",value:function(){var now=performance.now();void 0!==this.on&&(this.timeOff+=now-this.tsLastTransition),this.tsLastTransition=now}},{key:"timePassesAsUndefined",value:function(){var now=performance.now();this.tsLastTransition=now}},{key:"resetTime",value:function(){var now=performance.now();this.tsLastTransition=now,this.timeOff=0,this.timeOn=0}},{key:"pause",value:function(){this.paused||(this.paused=!0,this.stateWhenPaused=this.on,void 0===this.on?this.timePassesAsUndefined():this.on?this.timePassesAsOn():this.timePassesAsOff())}},{key:"unpause",value:function(){var _this3=this;this.paused&&(this.paused=!1,this.timePassesAsUndefined(),this.on!==this.stateWhenPaused)&&this.observers.forEach(function(x){return x(_this3)})}},{key:"getTimeOn",value:function(){var now;return this.on?(now=performance.now(),this.timeOn+now-this.tsLastTransition):this.timeOn}},{key:"getTimeOff",value:function(){var now;return this.on?this.timeOff:(now=performance.now(),this.timeOff+now-this.tsLastTransition)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Timer}();exports.Timer=Timer},{}],80:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AmazonHeaderBidder=void 0;var _queryString=require("../browser/queryString");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}require=function(){function AmazonHeaderBidder(windowHandle){var uniqId=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,SlotIDs=2<arguments.length?arguments[2]:void 0,autoPlay=3<arguments.length?arguments[3]:void 0,muted=4<arguments.length?arguments[4]:void 0,delay_vidad_until_ow_response=5<arguments.length?arguments[5]:void 0,minBidQueueLength=6<arguments.length&&void 0!==arguments[6]?arguments[6]:2,instance=this,Constructor=AmazonHeaderBidder;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");this.windowHandle=windowHandle,this.uniqId=uniqId,this.SlotIDs=SlotIDs,this.defaultSlot=this.getSlotName(autoPlay,muted),this.queue=[],this.maxTimeInQueue=29e3,this.delay_vidad_until_ow_response=delay_vidad_until_ow_response,this.installed=!1,this.requestInFlight=!1,this.minBidQueueLength=minBidQueueLength,this.player=void 0}var Constructor,protoProps,staticProps;return Constructor=AmazonHeaderBidder,staticProps=[{key:"parseSlotIds",value:function(amazonHeaderBidderSlotIDs){try{return JSON.parse(amazonHeaderBidderSlotIDs)}catch(e){return console.log("Amazon Header: error parsing '"+amazonHeaderBidderSlotIDs+"'"),null}}}],(protoProps=[{key:"getSlotName",value:function(autoPlay,muted){return autoPlay?muted?"autoPlayWithNoSound":"autoPlayWithSound":"clickToPlay"}},{key:"getEffectiveSlotName",value:function(){return void 0===this.autoPlay||void 0===this.muted?this.defaultSlot:this.getSlotName(this.autoPlay(),this.muted())}},{key:"getEffectiveSlot",value:function(){var slotName=this.getEffectiveSlotName();return this.SlotIDs[slotName]}},{key:"setPlayer",value:function(autoPlay,muted){this.autoPlay=autoPlay,this.muted=muted}},{key:"setup",value:function(){function q(c,r){a[a9]._Q.push([c,r])}var a9,a,s,A,p;this.uniqId&&(void 0===this.windowHandle.apstag&&(a9="apstag",a=this.windowHandle,p=this.windowHandle.document,s="script",a[a9]||(a[a9]={init:function(){q("i",arguments)},fetchBids:function(){q("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]},(A=p.createElement(s)).async=!0,A.src="//c.amazon-adsystem.com/aax2/apstag.js",(p=p.getElementsByTagName(s)[0]).parentNode.insertBefore(A,p)),this.windowHandle.apstag.init({pubID:this.uniqId,videoAdServer:"DFP"})),this.minBidQueueLength&&(this.queueFiller=setInterval(this.checkBids.bind(this),3e4)),this.checkBids())}},{key:"checkBids",value:function(){var tooOld,_this=this;this.requestInFlight||(tooOld=performance.now()-this.maxTimeInQueue,this.queue.filter(function(x){return x.ts>tooOld}).length<this.minBidQueueLength&&(this.requestInFlight=!0,this.fetch(function(){_this.requestInFlight=!1,_this.queue=_this.queue.filter(function(x){return x.ts>tooOld}),_this.queueFiller&&(console.log("Amazon: Cleaning Queue Filler"),clearInterval(_this.queueFiller),_this.queueFiller=void 0)})))}},{key:"fetch",value:function(cb){var myThis=this,configuration={slots:[{slotID:this.getEffectiveSlot(),mediaType:"video"}]};console.log("Amazon Header Bidder Bids Requested:",JSON.parse(JSON.stringify(configuration))),this.windowHandle.apstag.fetchBids(configuration,function(bids){myThis.handleVideoBids(bids),cb()})}},{key:"handleVideoBids",value:function(bids){var myThis=this;0<bids.length&&(console.log("Amazon Header Bidder Bids Received:",JSON.parse(JSON.stringify(bids))),bids.forEach(function(x){x={url:x.encodedQsParams,cpm:0,ts:performance.now()};myThis.queue.push(x)}))}},{key:"applyBid",value:function(vastURL){if(console.log("Amazon Header Bidder: Apply Bid called:",this.queue.length),this.queue.length<=0)return vastURL;console.log("Amazon Header Bidder: VAST URL:",vastURL);var bid=this.queue.pop(),parts=(vastURL="function"==typeof vastURL?vastURL():vastURL).split("?",2);if(parts.length<1)return vastURL;var url=parts[0],parts=parts[1],parts=(0,_queryString.parseQueryString)(parts);if(void 0===parts.cust_params)return vastURL;parts.cust_params+=bid.url;vastURL=url+"?"+(0,_queryString.serializeQueryString)(parts);return console.log("Amazon Header Bidder: NEW VAST URL:",vastURL),vastURL}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),AmazonHeaderBidder}();exports.AmazonHeaderBidder=require},{"../browser/queryString":51}],81:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OpenWrap=void 0;var _log=require("../log/log"),_queryString=require("../browser/queryString");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}require=function(){function OpenWrap(windowHandle){var uniqId=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1980,delay_vidad_until_ow_response=2<arguments.length?arguments[2]:void 0,minBidQueueLength=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2,instance=this,Constructor=OpenWrap;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");this.windowHandle=windowHandle,this.uniqId=uniqId,this.adUnits=[],this.queue=[],this.delay_vidad_until_ow_response=delay_vidad_until_ow_response,this.installed=!1,this.minBidQueueLength=minBidQueueLength}var Constructor,protoProps,staticProps;return Constructor=OpenWrap,(protoProps=[{key:"startBidQueueFiller",value:function(){this.queueFiller?clearInterval(this.queueFiller):this.keepPrefetchQueueFilled(),this.queueFiller=setInterval(this.keepPrefetchQueueFilled.bind(this),2200)}},{key:"addAdUnit",value:function(adUnitId){var w=1<arguments.length&&void 0!==arguments[1]?arguments[1]:640,h=2<arguments.length&&void 0!==arguments[2]?arguments[2]:360,found=this.adUnits.find(function(x){return x.adUnitId===adUnitId});return found?(found.mediaTypes.banner.sizes=[[w,h]],found.sizes=[[w,h]]):(found={adUnitId:adUnitId,adUnitIndex:"0",code:"div-gpt-ad-"+this.uniqId+"-0",divId:"div-gpt-ad-"+this.uniqId+"-0",mediaTypes:{banner:{sizes:[[w,h]]}},sizes:[[w,h]]},this.adUnits.push(found),++this.uniqId),found}},{key:"install",value:function(account,profile){if(account&&profile){if(this.installed=!0,"object"===_typeof(this.windowHandle.PWT))return this.openWrapLoaded();this.windowHandle.PWT={},this.windowHandle.PWT.jsLoaded=this.openWrapLoaded.bind(this);var purl=this.windowHandle.location.href,account="//ads.pubmatic.com/AdServer/js/pwt/"+account+"/"+profile,profile="",purl=(0<purl.indexOf("pwtv=")&&2<=(purl=/pwtv=(.*?)(&|$)/g.exec(purl)).length&&0<purl[1].length&&(profile="/"+purl[1]),this.windowHandle.document.createElement("script")),account=(purl.async=!0,purl.type="text/javascript",purl.src=account+profile+"/pwt.js",this.windowHandle.document.getElementsByTagName("script")[0]);account.parentNode.insertBefore(purl,account)}}},{key:"openWrapLoaded",value:function(){var oldBuildUrl,oldHook=this.windowHandle.PWT&&this.windowHandle.PWT.HookForPrebidRequestBids?this.windowHandle.PWT.HookForPrebidRequestBids:null,myThis=this;(0,_log.cLog)("AMP: OpenWrap: Installed",oldHook),top.location.host.match(/ahorradororata\.com/)||(this.windowHandle.PWT.HookForPrebidRequestBids=function(adUnitsWithBids){var skipOld;if(oldHook&&(adUnitsWithBids.forEach(function(adUnit){adUnit&&adUnit.divID&&myThis.adUnits.find(function(x){return x.divId===adUnit.divID})&&((0,_log.cLog)("AMP: OpenWrap: AdUnit",adUnit),skipOld=!0)}),!skipOld))return oldHook(adUnitsWithBids)}),this.windowHandle.owpbjs&&this.windowHandle.owpbjs.adServers&&this.windowHandle.owpbjs.adServers.dfp&&this.windowHandle.owpbjs.adServers.dfp.buildVideoUrl&&(oldBuildUrl=this.windowHandle.owpbjs.adServers.dfp.buildVideoUrl,this.windowHandle.owpbjs.adServers.dfp.buildVideoUrl=function(){var custParams;return(0,_log.cLog)("AMP: OpenWrap Video: ",arguments),arguments.length&&arguments[0]&&arguments[0].params&&arguments[0].params.cust_params&&arguments[0].params.cust_params.ampliffyURL?(arguments[0].url=arguments[0].params.cust_params.ampliffyURL,delete arguments[0].params.cust_params.ampliffyURL,1<(custParams=arguments[0].url.match(/cust_params=([^&]*)/)).length&&(custParams=decodeURIComponent(custParams[1]),(0,_queryString.parseQuery)(custParams,arguments[0].params.cust_params),delete arguments[0].params.cust_params.ampliffyURL),(custParams=arguments[0].url.match(/sz=([0-9x]*)/))[1]&&(arguments[0].params.sz=custParams[1]),(0,_log.cLog)("AMP: OpenWrap Video: Calling oldBuildUrl (2)",arguments,oldBuildUrl)):(0,_log.cLog)("AMP: OpenWrap Video: Calling oldBuildUrl",arguments,oldBuildUrl),oldBuildUrl.apply(myThis.windowHandle.owpbjs.adServers.dfp,arguments)})}},{key:"keepPrefetchQueueFilled",value:function(){this.queue.length<this.minBidQueueLength&&this.sampleVastURL&&this.sampleVastURL.length&&this.prefetchAndStore(this.sampleVastURL)}},{key:"prefetch",value:function(vidAdURL,cb){if(!this.installed)return cb(vidAdURL);if(!this.windowHandle.PWT||"function"!=typeof this.windowHandle.PWT.requestBids)return setTimeout(this.prefetch.bind(this,vidAdURL,cb),200);(0,_log.cLog)("AMP: OpenWrap: Prefetch",vidAdURL);var prefetchData={},iu=vidAdURL.match(/[&?]iu=([^&]*)/);if(iu){prefetchData.iu=iu[1];var size,prefetchPostHook,adUnit,myThis,thisAmpliffyURL,iu=vidAdURL.match(/sz=([0-9x#WH]*)/);if(iu)return size=iu[1].split("x"),prefetchData.w=parseInt(size[0]),prefetchData.h=parseInt(size[1]),(0,_log.cLog)("AMP: OpenWrap: Size",iu,prefetchData.w,prefetchData.h),this.prefetchPreHook&&(prefetchPostHook=this.prefetchPreHook(prefetchData),(0,_log.cLog)("AMP: OpenWrap: Size",iu,prefetchData.w,prefetchData.h)),adUnit=this.addAdUnit(prefetchData.iu,320<prefetchData.w?640:300,320<prefetchData.w?360:168),myThis=this,thisAmpliffyURL="function"==typeof vidAdURL?vidAdURL():vidAdURL,this.sampleVastURL=thisAmpliffyURL,this.windowHandle.PWT.requestBids([adUnit],function(adUnitsArray){(0,_log.cLog)("AMP: OpenWrap: AdUnitsArray",adUnitsArray);var videoUrl=myThis.windowHandle.PWT.generateDFPURL(adUnit,{ampliffyURL:thisAmpliffyURL});(0,_log.cLog)("AMP: OpenWrap: VAST URL:",videoUrl),prefetchPostHook&&(videoUrl=prefetchPostHook(videoUrl),(0,_log.cLog)("AMP: OpenWrap: PostHook: VAST URL:",videoUrl)),cb(videoUrl,adUnitsArray)}),!0}}},{key:"prefetchAndStore",value:function(vidAdURL){var _this=this,cb=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;this.prefetch(vidAdURL,function(url,adUnitsArray){adUnitsArray=adUnitsArray&&adUnitsArray[0]&&adUnitsArray[0].bid&&adUnitsArray[0].bid.netEcpm?adUnitsArray[0].bid.netEcpm:0;_this.queue.push({url:url,cpm:adUnitsArray}),cb&&cb()})}},{key:"applyBestBid",value:function(vidAdURL){var bestBid;return 1<arguments.length&&void 0!==arguments[1]&&arguments[1]||!vidAdURL.match(/pwtecp/)||!vidAdURL.match(/pwtplt/)?(bestBid=void 0,this.queue.forEach(function(x){(bestBid=bestBid||x).cpm<x.cpm&&(bestBid=x)}),bestBid&&(this.queue=this.queue.filter(function(x){return x!==bestBid&&0<x.cpm})),this.applyBid(bestBid,vidAdURL)):vidAdURL}},{key:"applyBid",value:function(bid,vidAdURL){var workInProgressCustParams,payloadVidAd;return bid&&bid.url?(workInProgressCustParams={},1<(bid=bid.url.match(/cust_params=([^&]*)/)).length&&(bid=decodeURIComponent(bid[1]),(0,_queryString.parseQuery)(bid,workInProgressCustParams)),1<(bid=vidAdURL.match(/cust_params=([^&]*)/)).length&&(payloadVidAd=decodeURIComponent(bid[1]),(0,_queryString.parseQuery)(payloadVidAd,workInProgressCustParams)),payloadVidAd=vidAdURL,workInProgressCustParams=""===(0,_queryString.serializeQueryString)(workInProgressCustParams)?"":"cust_params="+encodeURIComponent((0,_queryString.serializeQueryString)(workInProgressCustParams)),1<bid.length?payloadVidAd=vidAdURL.replace(/cust_params=[^&]*/,workInProgressCustParams):workInProgressCustParams&&(bid=(vidAdURL.indexOf("?")<0?"?":"&")+workInProgressCustParams,payloadVidAd=vidAdURL+bid),payloadVidAd):vidAdURL}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),OpenWrap}();exports.OpenWrap=require},{"../browser/queryString":51,"../log/log":62}],82:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VidAdQueue=void 0;var _vast=require("../vidCo/vast"),_consent=require("../consent/consent");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}require=function(){function VidAdQueue(playerStorage,vidCoObj){if(!(this instanceof VidAdQueue))throw new TypeError("Cannot call a class as a function");this.queue=[],this.playerStorage=playerStorage,this.vidCoObj=vidCoObj,this.observers=[]}var Constructor,protoProps,staticProps;return Constructor=VidAdQueue,(protoProps=[{key:"prepareAdTag",value:function(){var immediate=0<arguments.length&&void 0!==arguments[0]&&arguments[0],vastURL=(1<arguments.length?arguments[1]:void 0)||this.playerStorage.options.vastURL;(vastURL="function"==typeof vastURL?vastURL():vastURL)&&(vastURL=(0,_vast.resolveVidAdURL)(vastURL,this.playerStorage.options.dev,!1,this.playerStorage.options,this.vidCoObj.currentPlayListItem(this.playerStorage.player)||this.vidCoObj.playList[0],(0,_consent.showNonPersonalizedAds)(),this.playerStorage.getActualVidAdCoSize()),this.queue.push(vastURL),this.observers.forEach(function(x){return x(immediate)}))}},{key:"getAdTag",value:function(){var vastURL;return this.queue.length?this.observers.forEach(function(x){return x(!0)}):this.prepareAdTag(!0),(vastURL="function"==typeof(vastURL=this.queue.length?this.queue.shift():vastURL)?vastURL():vastURL)?(this.lastVastURL=(0,_vast.resolveVidAdURL)(vastURL,this.playerStorage.options.dev,!1,this.playerStorage.options,this.vidCoObj.currentPlayListItem(this.playerStorage.player)||this.vidCoObj.playList[0],(0,_consent.showNonPersonalizedAds)(),this.playerStorage.getActualVidAdCoSize()),this.lastVastURL):"data:application/xml,"+encodeURIComponent('<VAST version="3.0"/>')}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),VidAdQueue}();exports.VidAdQueue=require},{"../consent/consent":54,"../vidCo/vast":87}],83:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.installFirstAdTimeout=function(timeout,adManager,playerState){function clearTimeout(){return(0,_log.cLog)("TO: wanting to clear timeout\n",cleared,timeoutFirstAd),!cleared&&timeoutFirstAd&&(cleared=!0,clearTimeout())}var _this=this;adManager.observe("wantingToPlayAnAd",function(){(0,_log.cLog)("TO: wantingToPlayAnAd"),timeoutFirstAd=timeoutFirstAd||setTimeout(function(playerState){playerState.signalObservers("closedVidCo"),(0,_log.cLog)("TO: First Ad")}.bind(_this,playerState),timeout)});adManager.observe("noVidAd",clearTimeout),adManager.observe("errorVidAd",clearTimeout),adManager.observe("startedVidAd",clearTimeout)};var timeoutFirstAd,_log=require("../log/log"),cleared=!1},{"../log/log":62}],84:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function ownKeys(object,enumerableOnly){var symbols,keys=Object.keys(object);return Object.getOwnPropertySymbols&&(symbols=Object.getOwnPropertySymbols(object),enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)),keys}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFirst15=function(playList){var res=[];return playList.forEach(function(x){x=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){!function(obj,key,value){(key=function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}({},x);x.sources=[{src:x.sources.first15,type:"video/mp4"}],res.push(x)}),res}},{}],85:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hide=function(rootElement){style=style||(0,_addStyles.addStyles)(".vjs-playlist-sidebar {display: none;}",rootElement)},exports.show=function(){style&&(style.remove(),style=void 0)};var style,_addStyles=require("../dom/addStyles")},{"../dom/addStyles":57}],86:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.title=function(root,parent,player){function wantsTitleInactive(e){var timeout,sinceLastUserActive=performance.now()-lastUserActive;clearUserActive&&(clearTimeout(clearUserActive),clearUserActive=void 0),0<lastUserActive&&5900<=sinceLastUserActive?(parent.classList.contains("vjs-user-active-title")&&parent.classList.remove("vjs-user-active-title"),parent.classList.contains("vjs-user-inactive-title")||parent.classList.add("vjs-user-inactive-title")):(timeout=keepTitle,-2e3<sinceLastUserActive?timeout=Math.min(timeout,keepTitle-sinceLastUserActive):lastUserActive=performance.now()-100,timeout=Math.max(250,timeout),clearUserActive=setTimeout(wantsTitleInactive,timeout))}function wantsTitleActive(e){lastUserActive=performance.now(),parent.classList.contains("vjs-user-active-title")||parent.classList.add("vjs-user-active-title"),parent.classList.contains("vjs-user-inactive-title")&&parent.classList.remove("vjs-user-inactive-title"),clearUserActive&&(clearTimeout(clearUserActive),clearUserActive=void 0),player.one(["userinactive"],wantsTitleInactive)}var clearUserActive,keepTitle=3<arguments.length&&void 0!==arguments[3]?arguments[3]:6e3,div=((0,_log.cLog)("Title:",parent,player),document.createElement("div")),lastUserActive=(div.className="title",div.innerHTML="Este título",parent.appendChild(div),(0,_addStyles.addStyles)(".video-js .title a {color: inherit; text-decoration: inherit}\n",root),(0,_addStyles.addStyles)(".video-js .title {position: absolute;\n    top: 1em;\n    left: 1em;\n    font-size: 1.25em;\n    max-width: 80%;\n    -webkit-transition: visibility 1s,opacity 1s;\n    -moz-transition: visibility 1s,opacity 1s;\n    -ms-transition: visibility 1s,opacity 1s;\n    -o-transition: visibility 1s,opacity 1s;\n    transition: visibility 1s,opacity 1s;\n    text-overflow: ellipsis;}",root),(0,_addStyles.addStyles)(".vjs-user-active-title .title {visibility: visible;\n    opacity: 1;\n}",root),(0,_addStyles.addStyles)(".vjs-user-inactive-title.vjs-has-started .title {visibility: visible;\n    opacity: 0;\n}}",root),performance.now());player.on(["useractive"],wantsTitleActive),player.one(["userinactive"],wantsTitleInactive),player.on(["play","duringplaylistchange","playlistitem"],function(e){var itemIndex,linkTo;if((0,_log.cLog)(e),e&&void 0!==e.nextIndex){if((itemIndex=e.nextIndex)<0)return;name=e.nextPlaylist[itemIndex].name,void 0!==e.nextPlaylist[itemIndex].linkTo&&(linkTo=e.nextPlaylist[itemIndex].linkTo)}else{if((itemIndex=this.playlist.currentItem())<0)return;var e=this.playlist(),name=e[itemIndex].name;void 0!==e[itemIndex].linkTo&&(linkTo=e[itemIndex].linkTo)}linkTo?((e=document.createElement("a")).href=linkTo,e.innerHTML=name,e.setAttribute("target","_top"),div.innerHTML="",div.appendChild(e)):div.innerHTML=name,wantsTitleActive(),clearUserActive=setTimeout(wantsTitleInactive,keepTitle)})};var _addStyles=require("../dom/addStyles"),_log=require("../log/log")},{"../dom/addStyles":57,"../log/log":62}],87:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.adTagUrlReplacements=adTagUrlReplacements,exports.replaceSize=replaceSize,exports.resolveVidAdURL=function(adTagUrl,dev,newCacheBuster,options){var playListItem=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0,npa=5<arguments.length&&void 0!==arguments[5]&&arguments[5],actualSize=6<arguments.length?arguments[6]:void 0,dev=(!dev||"number"==typeof top.origVAST&&top.origVAST||"object"===_typeof(top.location)&&top.location.search&&top.location.search.match&&top.location.search.match(/amp_org=1/))&&"string"==typeof adTagUrl?adTagUrl:"https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinearvpaid2js&correlator=",adTagUrl=(playListItem.description_url=""+top.location,adTagUrlReplacements(dev,actualSize,newCacheBuster,options,playListItem,npa)),dev=(0,_queryString.removeDuplicateURLParameters)(adTagUrl);return(0,_log.cLog)("AMP: VAST URL DupRemov:",adTagUrl,dev),dev};var _log=require("../log/log"),_queryString=require("../browser/queryString");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function replaceSize(adTagUrl,size){return adTagUrl=size&&size.length&&size[0]&&size[1]?adTagUrl.replace(/#WxH#/g,size[0]+"x"+size[1]):adTagUrl}var mridx=0;function adTagUrlReplacements(adTagUrl,actualSize,newCacheBuster,options){var playListItem=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0,npa=5<arguments.length&&void 0!==arguments[5]&&arguments[5],vpos=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"preroll",newCacheBuster=((0,_log.cLog)("1",adTagUrl,newCacheBuster),newCacheBuster?adTagUrl=adTagUrl.replace(/__timestamp__/g,""+(new Date).getTime()):(adTagUrl="CACHEBUSTER%%"!=="%%CACHEBUSTER%%".substring(2)?adTagUrl.replace(/__timestamp__/g,encodeURIComponent("%%CACHEBUSTER%%")):adTagUrl.replace(/__timestamp__/g,""+(new Date).getTime()),(0,_log.cLog)("2",adTagUrl)),(0,_log.cLog)("F",adTagUrl),"");try{newCacheBuster=document.location.toString()}catch(e){}adTagUrl=replaceSize(adTagUrl,actualSize),newCacheBuster.length&&(adTagUrl=adTagUrl.replace(/__page-url__/g,encodeURIComponent(newCacheBuster))),void 0!==options.evt_label&&options.evt_label.length?adTagUrl=adTagUrl.replace(/__item-title__/g,encodeURIComponent(options.evt_label)):playListItem&&void 0!==playListItem.name&&playListItem.name.length&&(adTagUrl=adTagUrl.replace(/__item-title__/g,encodeURIComponent(playListItem.name))),void 0!==options.ytVideoId&&(adTagUrl=adTagUrl.replace(/__item-file__/g,encodeURIComponent(options.ytVideoId))),playListItem&&void 0!==playListItem.description_url&&playListItem.description_url.length&&(adTagUrl=adTagUrl.replace(/description_url%3D__item-description__/g,"description_url%3D"+encodeURIComponent(playListItem.description_url))),playListItem&&void 0!==playListItem.description_url&&playListItem.description_url.length&&(adTagUrl=adTagUrl.replace(/description_url=__item-description__/g,"description_url="+encodeURIComponent(playListItem.description_url))),void 0!==options.video_description_url&&options.video_description_url.length&&(adTagUrl=adTagUrl.replace(/description_url%3D__item-description__/g,"description_url%3D"+encodeURIComponent(options.video_description_url))),void 0!==options.video_description_url&&options.video_description_url.length&&(adTagUrl=adTagUrl.replace(/description_url=__item-description__/g,"description_url="+options.video_description_url)),void 0!==options.video_description&&options.video_description.length?adTagUrl=adTagUrl.replace(/__item-description__/g,encodeURIComponent(options.video_description)):playListItem&&void 0!==playListItem.description&&playListItem.description.length&&(adTagUrl=adTagUrl.replace(/__item-description__/g,encodeURIComponent(playListItem.description)));actualSize=[],newCacheBuster=[];return playListItem&&void 0!==playListItem.taxonomyAmpliffy&&playListItem.taxonomyAmpliffy.length&&(actualSize.push(playListItem.taxonomyAmpliffy),newCacheBuster.push("txa="+playListItem.taxonomyAmpliffy)),!options.dev||!playListItem||void 0!==playListItem.taxonomyCreator&&playListItem.taxonomyCreator.length||(playListItem.taxonomyCreator=Math.random()<.5?"AMPP---000050":"AMPP---000051"),playListItem&&void 0!==playListItem.taxonomyCreator&&playListItem.taxonomyCreator.length&&(actualSize.push(playListItem.taxonomyCreator),newCacheBuster.push("txc="+playListItem.taxonomyCreator)),playListItem&&void 0!==playListItem.vidCoHash&&playListItem.vidCoHash.length&&(actualSize.push(playListItem.vidCoHash),newCacheBuster.push("vch="+playListItem.vidCoHash)),(adTagUrl=adTagUrl.replace(/__item-category__/g,encodeURIComponent(actualSize.reduce(function(i,x){return(i.length?i+",":"")+x},"")))).match(/cust_params=/)&&!adTagUrl.match(/cust_params=([^&]*%26|)txa%3[dD]/)&&(adTagUrl=adTagUrl.replace(/cust_params=/g,"cust_params="+encodeURIComponent(newCacheBuster.reduce(function(i,x){return(i.length?i+"&":"")+x},"")+"&"))),adTagUrl=options.continueVideoJSContentWhenAdDone?adTagUrl.replace(/__fbfan__/g,"%2Cfbfan"):adTagUrl.replace(/__fbfan__/g,""),void 0!==options.keywordsToAdd&&options.keywordsToAdd.length&&(adTagUrl.match(/cust_params=/)?adTagUrl=adTagUrl.match(/cust_params=[^&]*keyword%3[dD]/)?adTagUrl.replace(/cust_params=([^&]*)keyword%3[dD]/g,"cust_params=$1keyword%3D"+encodeURIComponent(options.keywordsToAdd.join(",")+",")):adTagUrl.replace(/cust_params=/g,"cust_params=keyword%3D"+encodeURIComponent(options.keywordsToAdd.join(",")+"%26")):adTagUrl+="&cust_params=keyword%3D"+encodeURIComponent(options.keywordsToAdd.join(","))),void 0!==npa&&(adTagUrl+=(adTagUrl.indexOf("?")<0?"?":"&")+"npa="+(npa?"1":"0")),adTagUrl=(adTagUrl+=(adTagUrl.indexOf("?")<0?"?":"&")+"vpos="+vpos)+((adTagUrl.indexOf("?")<0?"?":"&")+"ad_type=audio_video"),"midroll"===vpos&&(adTagUrl+=(adTagUrl.indexOf("?")<0?"?":"&")+"mridx="+ ++mridx),adTagUrl+=(adTagUrl.indexOf("?")<0?"?":"&")+"max_ad_duration=300000",playListItem&&void 0!==playListItem.name&&playListItem.name.length&&(adTagUrl+=(adTagUrl.indexOf("?")<0?"?":"&")+"vid_t="+encodeURIComponent(playListItem.name)),playListItem&&"number"==typeof playListItem.duration&&0<playListItem.duration&&(adTagUrl+=(adTagUrl.indexOf("?")<0?"?":"&")+"vid_d="+playListItem.duration),playListItem&&void 0!==playListItem.description&&playListItem.description.length&&(adTagUrl+=(adTagUrl.indexOf("?")<0?"?":"&")+"vid_kw="+encodeURIComponent(playListItem.description)),adTagUrl}},{"../browser/queryString":51,"../log/log":62}],88:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.vidCo=void 0;var _vastClient=require("vast-client"),_htmlEntities=require("../dom/htmlEntities"),_isMobile=require("../dom/isMobile"),_cookies=require("../browser/cookies.js"),_viewport=require("../dom/viewport"),_version=require("../browser/version"),_log=require("../log/log"),_queryString=require("../browser/queryString");function _construct(Parent,args,Class){return(_construct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){}}()?Reflect.construct.bind():function(Parent,args,Class){var a=[null];a.push.apply(a,args);args=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(args,Class.prototype),args}).apply(null,arguments)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o})(o,p)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}require=function(){function vidCo(options,playerStorage){if(!(this instanceof vidCo))throw new TypeError("Cannot call a class as a function");this.vastClient=new _vastClient.VASTClient,this.playList=[],this.videoTester=document.createElement("video"),this.correlator=0,this.pendingCookieInitialization=!0,this.options=options,this.playerStorage=playerStorage,this.observers=[]}var Constructor,protoProps,staticProps;return Constructor=vidCo,staticProps=[{key:"convertToPlayListItem",value:function(x){if(x.sources.resolved)return(x=Object.assign({},x)).sources=x.sources.resolved,x}},{key:"getTracker",value:function(ad,creative){return new _vastClient.VASTTracker(null,ad,creative)}},{key:"getValidSource",value:function(item){if(item.sources.length)return item.sources;var ret=[];if(item.sources.first15&&ret.push({src:item.sources.first15}),item.sources.resolved&&ret.push.apply(ret,_toConsumableArray(item.sources.resolved)),ret.length)return ret;throw"Invalid source for item"}}],(protoProps=[{key:"addItemToPlaylist",value:function(item){(!(1<arguments.length&&void 0!==arguments[1])||arguments[1]||!item.sources||this.options.vidCoAllowRepeatSameVideo||!(this.playList.find(function(x){return x===item})||this.contains(item.sources)||this.containsName(item.name)))&&this.playList.push(item)}},{key:"addItemsToPlaylist",value:function(items){var _this=this,allowDuplicates=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];items.forEach(function(x){return _this.addItemToPlaylist(x,allowDuplicates)})}},{key:"getPlaylistWithPlayableItems",value:function(){return this.playList.filter(function(x){return x.sources.resolved}).map(vidCo.convertToPlayListItem)}},{key:"resolveMissing",value:function(mobileOrSize,cb,cberr){var _this2=this,limit=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,resolveMissing=[];return this.playList.forEach(function(x){limit&&limit<=resolveMissing.length||x.sources&&(x.sources.resolved||x.sources.tries)||resolveMissing.push(new Promise(function(resolve){return _this2.loadOne(mobileOrSize,x,resolve)}))}),resolveMissing.length&&Promise.all(resolveMissing).then(function(value){cb&&cb(value)},function(reason){cberr&&cberr(reason)}),resolveMissing.length}},{key:"notifyObservers",value:function(){this.observers.forEach(function(x){return x()})}},{key:"resolveOneMissing",value:function(item,mobileOrSize,cb){var _this3=this,resolveMissing=[];if((0,_log.cLog)("CHECK MISSING RESOLVE:",JSON.parse(JSON.stringify(this.playList))),!item.sources||!item.sources.resolved&&!item.sources.tries)return(0,_log.cLog)("IT'S MISSING RESOLVE:",JSON.parse(JSON.stringify(item)),item.sources,item&&item.sources?item.sources.resolved:null,item&&item.sources?item.sources.tries:null),resolveMissing.push(new Promise(function(resolve){return _this3.loadOne(mobileOrSize,item,resolve)})),Promise.all(resolveMissing).then(function(value){cb&&cb(value)}),resolveMissing.length}},{key:"addNewItemBasedOnKeywords",value:function(vidCoAdUnit,size,playListKWs,callBackAccept,callBackReject){var _this4=this;this.loadOne(size,{vidCoAdUnit:vidCoAdUnit,sources:{}},function(x){x&&(0,_log.cLog)("addNewItemBasedOnKeywords loadOne: ",x,x.name,_this4.playList,_this4.playList.find(function(y){return x.name===y.name})),!x||!_this4.playList||x.name&&!_this4.options.vidCoAllowRepeatSameVideo&&_this4.playList.find(function(y){return x.name===y.name})?callBackReject&&callBackReject():(_this4.playList.push(x),callBackAccept&&callBackAccept(x))},playListKWs,!1)}},{key:"loadOne",value:function(mobileOrSize,playListItem,resolve){var keywords=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0,keepCorrelator=4<arguments.length&&void 0!==arguments[4]&&arguments[4],myThis=this,mobileOrSize="object"===_typeof(mobileOrSize)?mobileOrSize[0]+"x"+mobileOrSize[1]:mobileOrSize?"320x180":"640x360",keywords="keyword="+(keywords||[playListItem.sources.ytVideoId]).reduce(function(i,x){return(i.length?i+",":"")+x},""),baseUrl=playListItem.sources&&playListItem.sources.proxy?playListItem.sources.proxy+"?sz=":this.proxy?this.proxy+"?ciu_szs=1x1&unviewed_position_start=1&sz=":"https://securepubads.g.doubleclick.net/gampad/ads?ciu_szs=1x1&unviewed_position_start=1&sz=",vidCoAdUnit=(playListItem.sources&&playListItem.sources.vidCoAdUnit?playListItem.sources:playListItem).vidCoAdUnit,keepCorrelator=keepCorrelator?"123456"+this.correlator:++this.correlator+""+(new Date).getTime(),isMobile=_construct(_isMobile.IsMobile,_toConsumableArray((0,_viewport.getTopViewPortSize)())),baseUrl=baseUrl+mobileOrSize+"&iu="+encodeURIComponent(vidCoAdUnit)+"&gdfp_req=1&env=vp&output=xml_vast3&correlator="+keepCorrelator+"&cust_params="+encodeURIComponent(keywords);try{var cookie=(0,_cookies.getCookie)("__gads");cookie&&(baseUrl+="&cookie="+encodeURIComponent(cookie))}catch(e){}isMobile.isIOS()&&((mobileOrSize=(0,_cookies.getCookie)("__gads"))&&this.pendingCookieInitialization?baseUrl+="&cookie="+encodeURIComponent(mobileOrSize):baseUrl+="&cookie_enabled=1"),this.pendingCookieInitialization=!1,this.vastClient.get(baseUrl,{withCredentials:!0}).catch(function(){return playListItem.sources.tries=1,resolve(void 0)}).then(function(playListItem,response){var sources,iOS,isSafari,debug,creative,adURLParts;(0,_log.cLog)(response),response&&response.ads&&response.ads.length&&response.ads[0].creatives&&response.ads[0].creatives.length?(sources=[],creative=(response=response.ads[0]).creatives[0],(0,_log.cLog)(creative),playListItem.vastTracker=vidCo.getTracker(response,creative),iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),debug=[],creative.mediaFiles.forEach(function(x){x.mimeType&&("application/x-mpegURL"===x.mimeType&&myThis.options&&myThis.options.reducedBandwidth?(0,_log.cLog)("Intervention Reduce Bandwidth, removing",x):0<(0,_version.getChromeVersion)()&&(2e3<x.bitrate||x.bitrate<=0)||(iOS||isSafari)&&"application/x-mpegURL"===x.mimeType||("maybe"!==myThis.videoTester.canPlayType(x.mimeType)&&"probably"!==myThis.videoTester.canPlayType(x.mimeType)||(sources.push({type:x.mimeType,src:x.fileURL,res:x.height,bitrate:x.bitrate}),debug.push(myThis.videoTester.canPlayType(x.mimeType)+" ("+x.height+") => "+x.mimeType)),"application/dash+xml"===x.mimeType&&(sources.unshift({type:x.mimeType,src:x.fileURL,res:x.height,bitrate:x.bitrate}),debug.unshift(myThis.videoTester.canPlayType(x.mimeType)+" ("+x.height+") => "+x.mimeType)),0<(0,_version.getChromeVersion)()&&"video/webm"===x.mimeType&&(sources.unshift({type:x.mimeType,src:x.fileURL,res:x.height,bitrate:x.bitrate}),debug.unshift(myThis.videoTester.canPlayType(x.mimeType)+" ("+x.height+") => "+x.mimeType))))}),creative.duration&&(playListItem.duration=creative.duration),(0,_log.cLog)("Sources:",JSON.parse(JSON.stringify(sources))),playListItem.geoData={},response.creatives.length&&response.creatives[0]&&response.creatives[0].videoClickThroughURLTemplate&&(creative=response.creatives[0].videoClickThroughURLTemplate.split(/&adurl=/)[1])&&(creative=decodeURIComponent(creative)).match(/\?.*geoData/)&&(adURLParts={},(creative=creative.split("?",2)[1])&&(0,_queryString.parseQuery)(creative,adURLParts),adURLParts.ct&&(playListItem.geoData.country=adURLParts.ct),adURLParts.city&&(playListItem.geoData.city=adURLParts.city),adURLParts.zp&&(playListItem.geoData.zip=adURLParts.zp),adURLParts.bw)&&(playListItem.geoData.bandWidth=adURLParts.bw),1<response.creatives.length&&"companion"===response.creatives[1].type&&response.creatives[1].variations&&response.creatives[1].variations.length&&response.creatives[1].variations[0]&&response.creatives[1].variations[0].htmlResource&&(creative=response.creatives[1].variations[0].htmlResource,response.id&&(playListItem.id=response.id,playListItem.vidCoHash="H--"+("000"+parseInt(response.id)%200).slice(-3)),(adURLParts=creative.match(/data-poster\s*=\s*["']([^"']*)["']/))&&adURLParts[1]&&((0,_log.cLog)("Poster:",adURLParts[1]),playListItem.thumbnail||(playListItem.thumbnail=[]),playListItem.thumbnail[0]||(playListItem.thumbnail[0]={}),playListItem.thumbnail[0].src=adURLParts[1]),(response=creative.match(/data-video\s*=\s*["']([^"']*)["']/))&&response[1]&&((0,_log.cLog)("extractShortMP4:",response[1]),playListItem.sources.first15=response[1]),(adURLParts=creative.match(/data-title\s*=\s*["']([^"']*)["']/))&&adURLParts[1]&&((0,_log.cLog)("extractTitle:",adURLParts[1]),playListItem.name=(0,_htmlEntities.decodeHtml)(adURLParts[1])),(response=creative.match(/data-destination-url\s*=\s*["']([^"']*)["']/))&&response[1]&&((0,_log.cLog)("extractDestinationUrl:",response[1]),playListItem.description_url=(0,_htmlEntities.decodeHtml)(response[1])),(adURLParts=creative.match(/data-vidco-metrics\s*=\s*["']([^"']*)["']/))&&adURLParts[1]&&((0,_log.cLog)("extractVidCoMetrics:",adURLParts[1]),playListItem.vidco_metrics=parseInt((0,_htmlEntities.decodeHtml)(adURLParts[1]))),(response=creative.match(/data-taxonomy-ampliffy\s*=\s*["']([^"']*)["']/))&&response[1]&&((0,_log.cLog)("extractTaxonomyAmpliffy:",response[1]),playListItem.taxonomyAmpliffy=(0,_htmlEntities.decodeHtml)(response[1])),adURLParts=creative.match(/data-taxonomy-creator\s*=\s*["']([^"']*)["']/))&&adURLParts[1]&&((0,_log.cLog)("extractTaxonomyCreator:",adURLParts[1]),playListItem.taxonomyCreator=(0,_htmlEntities.decodeHtml)(adURLParts[1])),playListItem.name||(playListItem.name=""),playListItem.sources.resolved=sources,resolve(playListItem),myThis.notifyObservers()):(playListItem.sources.tries=1,resolve(void 0))}.bind(this,playListItem))}},{key:"switchPlaylist",value:function(player){var allowChangeCurrent=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],validPlayList=this.getPlaylistWithPlayableItems(),currentItem=player.playlist.currentItem(),currentTime=player.currentTime(),paused=player.paused(),currentPlaylist=player.playlist(),currentPlaylist=!!(currentPlaylist&&currentPlaylist.length&&0<=currentItem)&&this.contains(currentPlaylist[currentItem].sources);player.playlist(validPlayList,allowChangeCurrent&&currentPlaylist?currentItem:-1),!currentPlaylist||(currentItem=player.playlist.indexOf(currentPlaylist.sources.resolved))<0||(allowChangeCurrent&&(player.playlist.currentItem(currentItem),player.currentTime(currentTime)),this.setPoster(player,validPlayList[currentItem].thumbnail),!paused&&player.paused()&&player.play())}},{key:"getQueueDepth",value:function(player){var playList=player.playlist(),player=player.playlist.currentItem();return playList.length-player-1}},{key:"compare",value:function(sources1,sources2){var sources1Array,sources2Array;return!(!sources1||"number"==typeof sources1||!sources2||"number"==typeof sources2||(sources1Array=[],sources2Array=[],"string"==typeof sources1?sources1Array.push({src:sources1}):sources1Array=sources1,"string"==typeof sources2?sources2Array.push({src:sources2}):sources2Array=sources2,"function"!=typeof sources1Array.find)||!sources1Array.find(function(x){return sources2Array.find(function(y){return x.src&&y.src&&x.src===y.src})}))}},{key:"contains",value:function(sources){var _this5=this;return this.playList.find(function(x){return _this5.compare(sources,vidCo.getValidSource(x))})}},{key:"containsName",value:function(name){return!!name&&this.playList.find(function(x){return x.name&&x.name===name})}},{key:"trackRemotely",value:function(item,event,vidAd){var params={};params.event=event,params.vidCoCreativeId=item.id,params.vidCoAdUnit=this.options.vidCoAdUnit,params.vidCoHash=item.vidCoHash,params.country=item.geoData.country,params.city=item.geoData.city,params.zip=item.geoData.zip,params.bandWidth=item.geoData.bandWidth,params.taxonomyAmpliffy=item.taxonomyAmpliffy,params.taxonomyCreator=item.taxonomyCreator,vidAd&&"function"==typeof vidAd.getCurrentAd&&(event=vidAd.getCurrentAd(),params.vidAdSystem=event.getAdSystem(),params.vidAdAdUnit=this.playerStorage.vidAdQueue.lastVastURL.match(/iu=([^&]*)/)[1],params.vidAdLineItemId=event.getAdId(),params.vidAdCreativeId=event.getCreativeId()),(0,_log.imgLog)("https://stats.ampliffy.com/atv/event?"+(0,_queryString.serializeQueryString)(params),{})}},{key:"hookPlayer",value:function(player){var onPlay=function(player){var _this6=this;this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&(!_this6.options||_this6.options.vidCoImpressions||x.vidco_metrics)&&x.vastTracker.setPaused(!1)}),this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&_this6.trackRemotely(x,"PLAY")})}.bind(this,player);if(!player.paused())try{onPlay(player)}catch(e){}player.on("play",onPlay),player.on("pause",function(player){var _this7=this;this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&(!_this7.options||_this7.options.vidCoImpressions||x.vidco_metrics)&&x.vastTracker.setPaused(!0)}),this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&_this7.trackRemotely(x,"PAUSE")})}.bind(this,player)),player.on("canplay",function(player){var _this8=this;this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&(!_this8.options||_this8.options.vidCoImpressions||x.vidco_metrics)&&x.vastTracker.trackImpression()}),this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&_this8.trackRemotely(x,"IMPRESSION")})}.bind(this,player)),player.on("timeupdate",function(player){var _this9=this;this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&(!_this9.options||_this9.options.vidCoImpressions||x.vidco_metrics)&&x.vastTracker.setProgress(player.currentTime())})}.bind(this,player)),player.on("ended",function(player){var _this10=this;this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&(!_this10.options||_this10.options.vidCoImpressions||x.vidco_metrics)&&x.vastTracker.complete()}),this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&_this10.trackRemotely(x,"COMPLETE")})}.bind(this,player)),player.on("adstart",function(player){var _this11=this;this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&_this11.trackRemotely(x,"ADSTART",player.ima.getAdsManager())})}.bind(this,player)),window.addEventListener("beforeunload",function(){var _this12=this;this.playList.forEach(function(playListItem){return playListItem&&playListItem.vastTracker&&playListItem.vastTracker.close()}),this.currentPlayListItem(player,function(x){return x&&x.vastTracker&&_this12.trackRemotely(x,"CLOSE")})}.bind(this))}},{key:"currentPlayListItem",value:function(player){var cb=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,currentIndex=player.playlist.currentItem();if(!(currentIndex<0)){player=player.playlist()[currentIndex],currentIndex=this.contains(player.sources);if(currentIndex)return cb?cb(currentIndex):currentIndex}}},{key:"setPoster",value:function(player,thumbnail){return void 0===thumbnail||"number"==typeof thumbnail||"boolean"==typeof thumbnail?player.poster(""):"string"==typeof thumbnail?player.poster(thumbnail):thumbnail.src?player.poster(thumbnail.src):thumbnail.length?this.setPoster(player,thumbnail[0]):player.poster("")}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),vidCo}();exports.vidCo=require},{"../browser/cookies.js":48,"../browser/queryString":51,"../browser/version":53,"../dom/htmlEntities":58,"../dom/isMobile":59,"../dom/viewport":60,"../log/log":62,"vast-client":40}],89:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.vidCoVidAdViewabilityController=void 0;require("../timer/timer");var _log=require("../log/log");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}require=function(){function vidCoVidAdViewabilityController(){var firstVidAdMilliseconds=0<arguments.length&&void 0!==arguments[0]?arguments[0]:6e3,minMillisecondsBetweenVidAds=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6e4,vidCoTimer=2<arguments.length?arguments[2]:void 0,vidCo90Timer=3<arguments.length?arguments[3]:void 0,vidCoRunningTimer=4<arguments.length?arguments[4]:void 0,vidAdRunningTimer=5<arguments.length?arguments[5]:void 0,playerState=6<arguments.length?arguments[6]:void 0,options=7<arguments.length?arguments[7]:void 0,isMuted=8<arguments.length?arguments[8]:void 0,isPaused=9<arguments.length?arguments[9]:void 0,play=10<arguments.length?arguments[10]:void 0,pause=11<arguments.length?arguments[11]:void 0,launchAnAd=12<arguments.length?arguments[12]:void 0,avaConfigured=13<arguments.length?arguments[13]:void 0,instance=this,Constructor=vidCoVidAdViewabilityController;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");this.firstVidAdMilliseconds=firstVidAdMilliseconds,this.minMillisecondsBetweenVidAds=minMillisecondsBetweenVidAds,this.vidCoViewabilityTimer=vidCoTimer,this.vidCo90ViewabilityTimer=vidCo90Timer,this.vidCoRunningTimer=vidCoRunningTimer,this.vidAdRunningTimer=vidAdRunningTimer,this.playerState=playerState,this.options=options,this.avaConfigured=avaConfigured,this.isMuted=isMuted,this.isPaused=isPaused,this.play=play,this.pause=pause,this.launchAd=launchAnAd,this.vidCoFirst6Seconds90ViewDone=!1,this.vidCoFirst6SecondsHandlerInstalled=!1,this.vidCoViewabilityTimer.observers.push(this.vidCoViewabilityChange.bind(this)),this.vidCo90ViewabilityTimer.observers.push(this.vidCo90ViewabilityChange.bind(this)),this.timer=setInterval(this.timeIntervalCheck.bind(this),1e3)}var Constructor,protoProps,staticProps;return Constructor=vidCoVidAdViewabilityController,(protoProps=[{key:"dispose",value:function(){this.timer&&clearInterval(this.timer),this.timer=0}},{key:"vidCoViewabilityChange",value:function(vidCoTimer){this.avaConfigured?vidCoTimer.on&&this.playerState.autoPlay&&!this.playerState.hasPlayedAtLeastOnce&&this.isPaused()&&((0,_log.cLog)("VidCoTimer.on && autoplay && !hasPlayedAtLeastOnce && isPaused"),this.play()):(vidCoTimer.on?this.playerState.shouldBePlaying&&this.isPaused()&&((this.playerState.shouldBePlaying=!1,_log.cLog)("this.play",this.play),this.play(),(0,_log.cLog)("this.play done")):!this.isPaused()&&this.isMuted()&&(this.playerState.shouldBePlaying=!0,(0,_log.cLog)("this.pause",this.pause),this.pause(),(0,_log.cLog)("this.pause done")),(0,_log.cLog)("vidCoViewabilityChange done"))}},{key:"vidCo90ViewabilityChange",value:function(){this.playerState.adManager.adManagerPrepared&&!this.playerState.adManager.wantingToPlayAnAd&&!this.vidCoFirst6Seconds90ViewDone&&this.vidCo90ViewabilityTimer.on&&this.vidCo90ViewabilityTimer.getTimeOn()>this.firstVidAdMilliseconds&&this.vidCoRunningTimer.on&&this.vidCoRunningTimer.getTimeOn()>this.firstVidAdMilliseconds&&(this.vidCoFirst6Seconds90ViewDone=!0,this.playerState.adManager.tsLastAdLaunched||((0,_log.cLog)("VidCo90 Launch Ad"),this.launchAd()))}},{key:"timeIntervalCheck",value:function(){if(this.vidAdRunningTimer.on)this.playerState.playingVidAd=!0,this.playerState.playingVidCo=!1;else{this.playerState.playingVidAd=!1;var paused=this.isPaused();if(this.playerState.playingVidCo=!paused,!this.vidCoFirst6Seconds90ViewDone)return this.vidCo90ViewabilityChange();this.vidCoRunningTimer.getTimeOn()<this.minMillisecondsBetweenVidAds||this.vidAdRunningTimer.getTimeOn()>this.vidCoRunningTimer.getTimeOn()||!this.vidCo90ViewabilityTimer.on||paused||!this.playerState.adManager.adManagerPrepared||!(paused=this.playerState.adManager.tsLastAdLaunched)||performance.now()-paused<5e3||((0,_log.cLog)("Launch Ad"),this.options.adBreakOnlyPrerolls?this.playerState.adManager.setupAdsOnNextPreroll():this.launchAd(),this.vidCoRunningTimer.resetTime(),this.vidAdRunningTimer.resetTime())}}},{key:"isPrerollMandatory",value:function(){return!!this.options.viewability.forceFirstPrerollEvenIfMissingVidAdViewability||!(!this.options.adBreakOnlyPrerolls||150<this.options.viewability.firstVidAdMilliseconds||!this.vidCo90ViewabilityTimer.on||!this.playerState.autoPlay||this.playerState.hasPlayedAtLeastOnce||!this.isPaused())}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),vidCoVidAdViewabilityController}();exports.vidCoVidAdViewabilityController=require},{"../log/log":62,"../timer/timer":79}],90:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Viewability=void 0;var _vidCoVidAdViewabilityController=require("./vidCoVidAdViewabilityController"),_timer=require("../timer/timer"),_documentVisibility=require("../timer/documentVisibility"),_intersection=require("../observer/intersection"),_paused=require("../player/paused"),_log=require("../log/log");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _defineProperty(obj,key,value){(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}function _toPropertyKey(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}require=function(){function Viewability(){if(!(this instanceof Viewability))throw new TypeError("Cannot call a class as a function");_defineProperty(this,"firstVidAdMilliseconds",6e3),_defineProperty(this,"minMillisecondsBetweenVidAds",6e4),this.pollForceViewability=void 0,this.intersectionObserver=void 0,this.statusViewableVidCo={threshold:.6,viewable:void 0,tsLastTransition:void 0,tsPreviousTransition:void 0,observer:[]},this.statusViewableVidCo90={threshold:.9,viewable:void 0,tsLastTransition:void 0,tsPreviousTransition:void 0,observer:[]},this.statusViewableVidAd={threshold:.9,viewable:void 0,tsLastTransition:void 0,tsPreviousTransition:void 0,observer:[]},this.statuses=[this.statusViewableVidCo,this.statusViewableVidCo90,this.statusViewableVidAd]}var Constructor,protoProps,staticProps;return Constructor=Viewability,(protoProps=[{key:"setupViewabilityControls",value:function(playerStorage){var _this=this;playerStorage.statusViewableVidCo=this.statusViewableVidCo,playerStorage.pollForceViewability=function(x){return _this.pollForceViewability=x},playerStorage.setForceViewabilityCheck=function(){return _this.statuses.forEach(function(s){return s.observer.forEach(function(o){return o(s)})})}}},{key:"install",value:function(domElementToObserve,disposeCallbacks,player,options,playerState,viewabilityThresholdVidCo,viewabilityThresholdVidAd){var _this2=this,firstVidAdMilliseconds=7<arguments.length&&void 0!==arguments[7]?arguments[7]:6e3,minMillisecondsBetweenVidAds=8<arguments.length&&void 0!==arguments[8]?arguments[8]:6e4,vidCoTimer=(this.domElementToObserve=domElementToObserve,this.disposeCallbacks=disposeCallbacks,this.player=player,this.options=options,this.playerState=playerState,this.viewabilityThresholdVidCo=viewabilityThresholdVidCo,this.viewabilityThresholdVidAd=viewabilityThresholdVidAd,this.firstVidAdMilliseconds=firstVidAdMilliseconds,this.minMillisecondsBetweenVidAds=minMillisecondsBetweenVidAds,_documentVisibility.DocumentVisibility.setup(),viewabilityThresholdVidCo&&(this.statusViewableVidCo.threshold=viewabilityThresholdVidCo),viewabilityThresholdVidAd&&(this.statusViewableVidCo90.threshold=viewabilityThresholdVidAd),viewabilityThresholdVidAd&&(this.statusViewableVidAd.threshold=viewabilityThresholdVidAd),new _timer.Timer(void 0)),vidCo90Timer=new _timer.Timer(void 0),vidCoRunningTimer=new _timer.Timer(void 0),vidAdRunningTimer=new _timer.Timer(void 0),myThis=this,timeAdjust=(this.statusViewableVidCo.observer.push(function(state){state.viewable||"function"==typeof myThis.pollForceViewability&&myThis.pollForceViewability()?vidCoTimer.switchOn():vidCoTimer.switchOff()}),this.statusViewableVidCo90.observer.push(function(state){state.viewable||"function"==typeof myThis.pollForceViewability&&myThis.pollForceViewability()?vidCo90Timer.switchOn():vidCo90Timer.switchOff()}),_documentVisibility.DocumentVisibility.startVisibilityObservers.push(function(){vidCoTimer.unpause(),vidCo90Timer.unpause()}),_documentVisibility.DocumentVisibility.stopVisibilityObservers.push(function(){vidCoTimer.pause(),vidCo90Timer.pause()}),player.on(["playing","play"],function(e){vidCoTimer.unpause(),vidCo90Timer.unpause(),vidCoRunningTimer.switchOn(),vidAdRunningTimer.switchOff(),(0,_log.cLog)("viewability",e.type)}),player.on("ended",function(e){vidCoTimer.pause(),vidCo90Timer.pause(),vidCoRunningTimer.switchOff(),vidAdRunningTimer.switchOff(),(0,_log.cLog)("viewability",e.type)}),player.on(["adsplaying","adplaying"],function(e){vidCoTimer.pause(),vidCo90Timer.pause(),vidCoRunningTimer.switchOff(),vidAdRunningTimer.switchOn(),(0,_log.cLog)("viewability",e.type)}),player.on(["adended","adserror"],function(e){vidCoTimer.unpause(),vidCo90Timer.unpause(),vidCoRunningTimer.switchOff(),vidAdRunningTimer.switchOff(),(0,_log.cLog)("viewability",e.type)}),!1),intervalID=setInterval(function(){void 0!==player.ads&&"function"==typeof player.ads.isInAdMode&&((0,_paused.isPlayingAnAd)(player)?(vidCoTimer.pause(),vidCo90Timer.pause(),vidCoRunningTimer.switchOff(),vidAdRunningTimer.switchOn(),(0,_log.cLog)("viewability inAdMode"),timeAdjust||void 0===player.ads.snapshot||((0,_log.cLog)("timeAdjust",player.ads.snapshot,player.ads.snapshot.currentTime),timeAdjust=!0,5<player.ads.snapshot.currentTime?player.ads.snapshot.currentTime-=5:player.ads.snapshot.currentTime=0)):(vidCoTimer.unpause(),vidCo90Timer.unpause(),player.paused()?vidCoRunningTimer.switchOff():vidCoRunningTimer.switchOn(),vidAdRunningTimer.switchOff(),timeAdjust=!1))},1e3),controller=(disposeCallbacks.push(function(x){return clearInterval(intervalID)}),new _vidCoVidAdViewabilityController.vidCoVidAdViewabilityController(firstVidAdMilliseconds,minMillisecondsBetweenVidAds,vidCoTimer,vidCo90Timer,vidCoRunningTimer,vidAdRunningTimer,playerState,options,function(){return player.muted()},function(){return player.paused()},function(){return player.play()},function(){return player.pause()},function(){playerState.adManager.showRequestedAd()},!!options.ava));disposeCallbacks.push(function(x){return controller.dispose()}),this.intersectionObserver=new _intersection.Intersection(this.statuses),this.intersectionObserver.setup(domElementToObserve),disposeCallbacks.push(function(x){return _this2.intersectionObserver.dispose()}),playerState.viewabilityState.viewabilityController=controller}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Viewability}();exports.Viewability=require},{"../log/log":62,"../observer/intersection":63,"../player/paused":70,"../timer/documentVisibility":77,"../timer/timer":79,"./vidCoVidAdViewabilityController":89}],91:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.install=function(recipient,options,id,rootDocument,isPaused,vidCoVidAdViewabilityController){recipient.viewabilityState=new viewabilityState(recipient,options,id,rootDocument,isPaused,vidCoVidAdViewabilityController)},exports.viewabilityState=void 0;var _visible=require("../observer/visible");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,function(arg){arg=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0===prim)return("string"===hint?String:Number)(input);prim=prim.call(input,hint||"default");if("object"!==_typeof(prim))return prim;throw new TypeError("@@toPrimitive must return a primitive value.")}(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}(descriptor.key),descriptor)}}var viewabilityState=function(){function viewabilityState(playerState,options,id,rootDocument,isPaused,viewabilityController){if(!(this instanceof viewabilityState))throw new TypeError("Cannot call a class as a function");this.playerState=playerState,this.options=options,this.id=id,this.rootDocument=rootDocument,this.isPaused=isPaused,this.viewabilityController=viewabilityController}var Constructor,protoProps,staticProps;return Constructor=viewabilityState,(protoProps=[{key:"isPrerollMandatory",value:function(){return!!this.options.viewability.forceFirstPrerollEvenIfMissingVidAdViewability||!(!this.options.adBreakOnlyPrerolls||150<this.options.viewability.firstVidAdMilliseconds||!(this.viewabilityController?this.viewabilityController.vidCo90ViewabilityTimer.on:(0,_visible.isVidAfInViewport)(this.id,this.rootDocument))||!this.playerState.autoPlay||this.playerState.hasPlayedAtLeastOnce||!this.isPaused())}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),viewabilityState}();exports.viewabilityState=viewabilityState},{"../observer/visible":64}]},{},[65]);
